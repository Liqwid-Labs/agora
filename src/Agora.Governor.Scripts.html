<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Module     : Agora.Governor.Scripts
Maintainer : connor@mlabs.city
Description: Plutus scripts for Governors.

Plutus scripts for Governors.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agora.Governor.Scripts</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-9"></span><span>  </span><span class="annot"><span class="hs-comment">-- * GST</span></span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><span class="hs-comment">-- $gst</span></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Scripts</span></span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#governorPolicy"><span class="hs-identifier">governorPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#governorValidator"><span class="hs-identifier">governorValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Bridges</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#governorSTSymbolFromGovernor"><span class="hs-identifier">governorSTSymbolFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier">governorSTAssetClassFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalSTAssetClassFromGovernor"><span class="hs-identifier">proposalSTAssetClassFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeSTSymbolFromGovernor"><span class="hs-identifier">stakeSTSymbolFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeFromGovernor"><span class="hs-identifier">stakeFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeValidatorHashFromGovernor"><span class="hs-identifier">stakeValidatorHashFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalFromGovernor"><span class="hs-identifier">proposalFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalValidatorHashFromGovernor"><span class="hs-identifier">proposalValidatorHashFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalSTSymbolFromGovernor"><span class="hs-identifier">proposalSTSymbolFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeSTAssetClassFromGovernor"><span class="hs-identifier">stakeSTAssetClassFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#governorValidatorHash"><span class="hs-identifier">governorValidatorHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#authorityTokenFromGovernor"><span class="hs-identifier">authorityTokenFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Agora.Governor.Scripts.html#authorityTokenSymbolFromGovernor"><span class="hs-identifier">authorityTokenSymbolFromGovernor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.AuthorityToken.html"><span class="hs-identifier">Agora.AuthorityToken</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Agora.AuthorityToken.html#AuthorityToken"><span class="hs-identifier">AuthorityToken</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Agora.AuthorityToken.html#authorityTokenPolicy"><span class="hs-identifier">authorityTokenPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Agora.AuthorityToken.html#authorityTokensValidIn"><span class="hs-identifier">authorityTokensValidIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Agora.AuthorityToken.html#singleAuthorityTokenBurned"><span class="hs-identifier">singleAuthorityTokenBurned</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Governor.html"><span class="hs-identifier">Agora.Governor</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier">Governor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Governor.html#gstOutRef"><span class="hs-identifier">gstOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Governor.html#gtClassRef"><span class="hs-identifier">gtClassRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Governor.html#maximumCosigners"><span class="hs-identifier">maximumCosigners</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Agora.Governor.html#PGovernorDatum"><span class="hs-identifier">PGovernorDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Governor.html#PGovernorDatum"><span class="hs-identifier">PGovernorDatum</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Agora.Governor.html#PGovernorRedeemer"><span class="hs-identifier">PGovernorRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Governor.html#PCreateProposal"><span class="hs-identifier">PCreateProposal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Governor.html#PMintGATs"><span class="hs-identifier">PMintGATs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Governor.html#PMutateGovernor"><span class="hs-identifier">PMutateGovernor</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Agora.Governor.html#governorDatumValid"><span class="hs-identifier">governorDatumValid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Agora.Governor.html#pgetNextProposalId"><span class="hs-identifier">pgetNextProposalId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.html"><span class="hs-identifier">Agora.Proposal</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier">PProposalDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalId"><span class="hs-identifier">PProposalId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalStatus"><span class="hs-identifier">PProposalStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PFinished"><span class="hs-identifier">PFinished</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PResultTag"><span class="hs-identifier">PResultTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier">Proposal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#ProposalStatus"><span class="hs-identifier">ProposalStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#Draft"><span class="hs-identifier">Draft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#Locked"><span class="hs-identifier">Locked</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#pemptyVotesFor"><span class="hs-identifier">pemptyVotesFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#pneutralOption"><span class="hs-identifier">pneutralOption</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#proposalDatumValid"><span class="hs-identifier">proposalDatumValid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#pwinner"><span class="hs-identifier">pwinner</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.Scripts.html"><span class="hs-identifier">Agora.Proposal.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier">proposalPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier">proposalValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.Time.html"><span class="hs-identifier">Agora.Proposal.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.Time.html#createProposalStartingTime"><span class="hs-identifier">createProposalStartingTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.SafeMoney.html"><span class="hs-identifier">Agora.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier">GTTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Stake.html"><span class="hs-identifier">Agora.Stake</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier">PProposalLock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier">PStakeDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier">Stake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Stake.Scripts.html"><span class="hs-identifier">Agora.Stake.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier">stakePolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Agora.Stake.Scripts.html#stakeValidator"><span class="hs-identifier">stakeValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Utils.html"><span class="hs-identifier">Agora.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#findOutputsToAddress"><span class="hs-identifier">findOutputsToAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#hasOnlyOneTokenOfCurrencySymbol"><span class="hs-identifier">hasOnlyOneTokenOfCurrencySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustBePDJust"><span class="hs-identifier">mustBePDJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier">mustBePJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier">mustFindDatum'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#scriptHashFromAddress"><span class="hs-identifier">scriptHashFromAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#validatorHashToAddress"><span class="hs-identifier">validatorHashToAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#validatorHashToTokenName"><span class="hs-identifier">validatorHashToTokenName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Record</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PCurrencySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PDatumHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMinting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PSpending</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidatorHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mintingPolicySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mkMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mkValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">validatorHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClassValueOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Map</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pkeys</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">plookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">plookup'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">Plutarch.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">PDiscrete</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">pvalueDiscrete'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.TryFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.ScriptContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pfindTxInByTxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisUTXOSpent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">ptryFindDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">ptxSignedBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pvalueSpent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-string">&quot;liqwid-plutarch-extra&quot;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">psymbolValueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisDJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.TermCont</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PlutusLedgerApi.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">CurrencySymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">MintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PlutusLedgerApi.V1.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">ValidatorHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PlutusLedgerApi.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">{- $gst
   Governance state token, aka. GST, is an NFT that identifies a UTXO that
    carries the state datum of the Governance script.

   This token is minted by a one-shot monetary policy 'governorPolicy',
    meaning that the token has guaranteed uniqueness.

   The 'governorValidator' ensures that exactly one GST stays
    at the address of itself forever.
-}</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">{- | Policy for minting GSTs.

   This policy perform the following checks:

    - The UTXO referenced in the parameter is spent in the transaction.
    - Exactly one GST is minted.
    - Ensure the token name is empty.
    - Said UTXO should carry a valid 'Agora.Governor.GovernorDatum'.

  NOTE: It's user's responsibility to make sure the token is sent to the corresponding governor validator.
        We /can't/ really check this in the policy, otherwise we create a cyclic reference issue.

  @since 0.1.0
-}</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Agora.Governor.Scripts.html#governorPolicy"><span class="hs-identifier hs-type">governorPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMintingPolicy</span></a></span><span>
</span><span id="line-161"></span><span id="governorPolicy"><span class="annot"><span class="annottext">governorPolicy :: Governor -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Governor.Scripts.html#governorPolicy"><span class="hs-identifier hs-var hs-var">governorPolicy</span></a></span></span><span> </span><span id="local-6989586621679559914"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679559914"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PMintingPolicy)
-&gt; (Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Term s PData
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679559912"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679559912"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679559910"><span class="annot"><span class="annottext">oref :: Term s PTxOutRef
</span><a href="#local-6989586621679559910"><span class="hs-identifier hs-var hs-var">oref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PLifted PTxOutRef -&gt; Term s PTxOutRef
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679559914"><span class="hs-identifier hs-var">gov</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gstOutRef</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679559907"><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679559907"><span class="hs-identifier hs-var">ownSymbol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose)
-&gt; Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PScriptContext :--&gt; PAsData PScriptPurpose)
-&gt; Term s PScriptContext -&gt; Term s (PAsData PScriptPurpose)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679559912"><span class="hs-identifier hs-var">ctx'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679559903"><span class="annot"><span class="annottext">ownAssetClass :: Term s PAssetClass
</span><a href="#local-6989586621679559903"><span class="hs-identifier hs-var hs-var">ownAssetClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClass</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTokenName :--&gt; PAssetClass)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679559907"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTokenName :--&gt; PAssetClass)
-&gt; Term s PTokenName -&gt; Term s PAssetClass
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName -&gt; Term s PTokenName
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName
TokenName
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621679559902"><span class="annot"><span class="annottext">txInfo :: Term s PTxInfo
</span><a href="#local-6989586621679559902"><span class="hs-identifier hs-var hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxInfo) -&gt; Term s PTxInfo)
-&gt; Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PScriptContext :--&gt; PAsData PTxInfo)
-&gt; Term s PScriptContext -&gt; Term s (PAsData PTxInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679559912"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679559901"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679559901"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PTxInfo)
       (Bindings
          (PFields PTxInfo)
          ((':)
             @Symbol
             &quot;mint&quot;
             ((':)
                @Symbol
                &quot;inputs&quot;
                ((':)
                   @Symbol
                   &quot;outputs&quot;
                   ((':)
                      @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PTxInfo)
        (Bindings
           (PFields PTxInfo)
           ((':)
              @Symbol
              &quot;mint&quot;
              ((':)
                 @Symbol
                 &quot;inputs&quot;
                 ((':)
                    @Symbol
                    &quot;outputs&quot;
                    ((':)
                       @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PTxInfo)
            (Bindings
               (PFields PTxInfo)
               ((':)
                  @Symbol
                  &quot;mint&quot;
                  ((':)
                     @Symbol
                     &quot;inputs&quot;
                     ((':)
                        @Symbol
                        &quot;outputs&quot;
                        ((':)
                           @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PTxInfo)
          (Bindings
             (PFields PTxInfo)
             ((':)
                @Symbol
                &quot;mint&quot;
                ((':)
                   @Symbol
                   &quot;inputs&quot;
                   ((':)
                      @Symbol
                      &quot;outputs&quot;
                      ((':)
                         @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;validRange&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679559902"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Referenced utxo should be spent&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">Term
  s (PTxOutRef :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
forall (s :: S).
Term
  s (PTxOutRef :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisUTXOSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PTxOutRef :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
-&gt; Term s PTxOutRef
-&gt; Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679559910"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679559901"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Exactly one token should be minted&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679559907"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'NoGuarantees) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679559901"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span class="hs-cpp">
        #&amp;&amp; passetClassValueOf # txInfoF.mint # ownAssetClass #== 1
</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679559895"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679559895"><span class="hs-identifier hs-var">govOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; TermCont @POpaque s (Term s (PAsData PTxOut)))
-&gt; Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span class="hs-cpp">
          # &quot;Governor output not found&quot;
</span><span class="hs-cpp">            #$ pfind
</span><span class="hs-cpp">          # plam
</span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>                </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ownSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-special">)</span><span class="hs-cpp">
          # pfromData txInfoF.outputs
</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679559889"><span class="annot"><span class="annottext">datumHash :: Term s (PMaybeData PDatumHash)
</span><a href="#local-6989586621679559889"><span class="hs-identifier hs-var hs-var">datumHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PTxOut :--&gt; PMaybeData PDatumHash)
-&gt; Term s PTxOut -&gt; Term s (PMaybeData PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut) -&gt; Term s PTxOut
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679559895"><span class="hs-identifier hs-var">govOutput</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span id="local-6989586621679559888"><span class="annot"><span class="annottext">datum :: Term s PGovernorDatum
</span><a href="#local-6989586621679559888"><span class="hs-identifier hs-var hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Governor.html#PGovernorDatum"><span class="hs-identifier hs-type">PGovernorDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PGovernorDatum))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PGovernorDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash)
</span><a href="#local-6989586621679559889"><span class="hs-identifier hs-var">datumHash</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PGovernorDatum)
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s PGovernorDatum
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;datums&quot; ((':) @Symbol &quot;validRange&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679559901"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque) -&gt; Term s PBool -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PGovernorDatum :--&gt; PBool)
forall (s :: S). Term s (PGovernorDatum :--&gt; PBool)
</span><a href="Agora.Governor.html#governorDatumValid"><span class="hs-identifier hs-var">governorDatumValid</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PGovernorDatum :--&gt; PBool)
-&gt; Term s PGovernorDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679559888"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">{- | Validator for Governors.

     == Common checks

     The validator always ensures:

       - The UTXO which holds the GST must be spent.
       - The GST always stays at the validator's address.
       - The new state UTXO has a valid datum of type 'Agora.Governor.GovernorDatum'.

     == Creating a Proposal

     When the redeemer is 'Agora.Governor.CreateProposal', the script will check:

     - For governor's state datum:

         * 'Agora.Governor.nextProposalId' is advanced.
         * Nothing is changed other that that.

     - Exactly one stake (the &quot;input stake&quot;) must be provided in the input:
         * At least 'Agora.Stake.stackedAmount' of GT must be spent in the transaction.
         * The transaction must be signed by the stake owner.

     - Exactly one new proposal state token is minted.
     - An UTXO which holds the newly minted proposal state token is sent to the proposal validator.
       This UTXO must have a valid datum of type 'Agora.Proposal.ProposalDatum', the datum must:

         * Copy its id and thresholds from the governor's state.
         * Have status set to 'Proposal.Draft'.
         * Have zero votes.
         * Have exactly one cosigner - the stake owner

     - An UTXO which holds the stake state token is sent back to the stake validator.
       This UTXO must have a valid datum of type 'Agora.Stake.StakeDatum':

         * The 'Agora.Stake.stakedAmount' and 'Agora.Stake.owner' should not be changed,
            comparing to the input stake.
         * The new proposal locks must be appended to the 'Agora.Stake.lockedBy'.

     == Minting GATs

     When the redeemer is 'Agora.Governor.MintGATs', the script will check:

     - Governor's state is not changed.
     - Exactly only one proposal is in the inputs. Let's call this the /input proposal/.
     - The proposal is in the 'Proposal.Executable' state.

     NOTE: The input proposal is found by looking for the UTXO with a proposal state token in the inputs.

     === Effect Group Selection

     Currently a proposal can have two or more than two options to vote on,
       meaning that it can contains two or more effect groups,
       according to [#39](https://github.com/Liqwid-Labs/agora/issues/39).

     Either way, the shapes of 'Proposal.votes' and 'Proposal.effects' should be the same.
       This is checked by 'Proposal.proposalDatumValid'.

     The script will look at the the 'Proposal.votes' to determine which group has the highest votes,
       said group shoud be executed.

     During the process, minimum votes requirement will also be enforced.

     Next, the script will:

     - Ensure that for every effect in the said effect group,
       exactly one valid GAT is minted and sent to the effect.
     - The amount of GAT minted in the transaction should be equal to the number of effects.
     - A new UTXO is sent to the proposal validator, this UTXO should:

         * Include the one proposal state token.
         * Have a valid datum of type 'Proposal.ProposalDatum'.
           This datum should be as same as the one of the input proposal,
           except its status should be 'Proposal.Finished'.

     == Changing the State

     Redeemer 'Agora.Governor.MutateGovernor' allows the state datum to be changed by an external effect.

     In this case, the script will check

     - Exactly one GAT is burnt in the transaction.
     - Said GAT is tagged by the effect.

     @since 0.1.0
-}</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Agora.Governor.Scripts.html#governorValidator"><span class="hs-identifier hs-type">governorValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidator</span></a></span><span>
</span><span id="line-281"></span><span id="governorValidator"><span class="annot"><span class="annottext">governorValidator :: Governor -&gt; ClosedTerm PValidator
</span><a href="Agora.Governor.Scripts.html#governorValidator"><span class="hs-identifier hs-var hs-var">governorValidator</span></a></span></span><span> </span><span id="local-6989586621679558737"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData
 -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData
  -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PValidator)
-&gt; (Term s PData
    -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679558736"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679558736"><span class="hs-identifier hs-var">datum'</span></a></span></span><span> </span><span id="local-6989586621679558735"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679558735"><span class="hs-identifier hs-var">redeemer'</span></a></span></span><span> </span><span id="local-6989586621679558734"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679558734"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PGovernorRedeemer) -&gt; Term s PGovernorRedeemer
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679558733"><span class="annot"><span class="annottext">Term s PGovernorRedeemer
</span><a href="#local-6989586621679558733"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((Term s (PAsData PGovernorRedeemer),
   Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData PGovernorRedeemer),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">((((Term s (PAsData PGovernorRedeemer),
    Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (Term s (PAsData PGovernorRedeemer),
       Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s)))
-&gt; (((Term s (PAsData PGovernorRedeemer),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData PGovernorRedeemer),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
-&gt; ((Term s (PAsData PGovernorRedeemer),
     Reduce @Type (PTryFromExcess PData (PAsData PGovernorRedeemer) s))
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall (b :: PType) (a :: PType) (s :: S) (r :: PType).
PTryFrom a b =&gt;
Term s a
-&gt; ((Term s b, Reduce @Type (PTryFromExcess a b s)) -&gt; Term s r)
-&gt; Term s r
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptryFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679558735"><span class="hs-identifier hs-var">redeemer'</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span id="local-6989586621679558731"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558731"><span class="hs-identifier hs-var">ctxF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PScriptContext)
       (Bindings
          (PFields PScriptContext)
          ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PScriptContext)
        (Bindings
           (PFields PScriptContext)
           ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PScriptContext)
            (Bindings
               (PFields PScriptContext)
               ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PScriptContext)
          (Bindings
             (PFields PScriptContext)
             ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679558734"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621679558730"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679558730"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo))
-&gt; Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxInfo) -&gt; Term s PTxInfo)
-&gt; Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558731"><span class="hs-identifier hs-var">ctxF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679558729"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PTxInfo)
       (Bindings
          (PFields PTxInfo)
          ((':)
             @Symbol
             &quot;mint&quot;
             ((':)
                @Symbol
                &quot;inputs&quot;
                ((':)
                   @Symbol
                   &quot;outputs&quot;
                   ((':)
                      @Symbol
                      &quot;datums&quot;
                      ((':)
                         @Symbol
                         &quot;signatories&quot;
                         ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol
                          &quot;datums&quot;
                          ((':)
                             @Symbol
                             &quot;signatories&quot;
                             ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PTxInfo)
        (Bindings
           (PFields PTxInfo)
           ((':)
              @Symbol
              &quot;mint&quot;
              ((':)
                 @Symbol
                 &quot;inputs&quot;
                 ((':)
                    @Symbol
                    &quot;outputs&quot;
                    ((':)
                       @Symbol
                       &quot;datums&quot;
                       ((':)
                          @Symbol
                          &quot;signatories&quot;
                          ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PTxInfo)
            (Bindings
               (PFields PTxInfo)
               ((':)
                  @Symbol
                  &quot;mint&quot;
                  ((':)
                     @Symbol
                     &quot;inputs&quot;
                     ((':)
                        @Symbol
                        &quot;outputs&quot;
                        ((':)
                           @Symbol
                           &quot;datums&quot;
                           ((':)
                              @Symbol
                              &quot;signatories&quot;
                              ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PTxInfo)
          (Bindings
             (PFields PTxInfo)
             ((':)
                @Symbol
                &quot;mint&quot;
                ((':)
                   @Symbol
                   &quot;inputs&quot;
                   ((':)
                      @Symbol
                      &quot;outputs&quot;
                      ((':)
                         @Symbol
                         &quot;datums&quot;
                         ((':)
                            @Symbol
                            &quot;signatories&quot;
                            ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol
                          &quot;datums&quot;
                          ((':)
                             @Symbol
                             &quot;signatories&quot;
                             ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;signatories&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;validRange&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679558730"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PSpending</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PTxOutRef) -&gt; Term s PTxOutRef
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOutRef) -&gt; Term s PTxOutRef)
-&gt; (Term
      s
      (PDataRecord
         ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
    -&gt; Term s (PAsData PTxOutRef))
-&gt; Term
     s
     (PDataRecord
        ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
-&gt; Term s PTxOutRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679558728"><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679558728"><span class="hs-identifier hs-var">ownInputRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558731"><span class="hs-identifier hs-var">ctxF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679558727"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679558727"><span class="hs-identifier hs-var">ownInput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">Term s PTxInInfo -&gt; TermCont @POpaque s (Term s PTxInInfo)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInInfo -&gt; TermCont @POpaque s (Term s PTxInInfo))
-&gt; Term s PTxInInfo -&gt; TermCont @POpaque s (Term s PTxInInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybe PTxInInfo :--&gt; PTxInInfo))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybe PTxInInfo :--&gt; PTxInInfo))
-&gt; Term s (PString @S) -&gt; Term s (PMaybe PTxInInfo :--&gt; PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Own input not found&quot;</span></span><span class="hs-cpp">
          #$ pfindTxInByTxOutRef # ownInputRef # txInfoF.inputs
</span><span>    </span><span id="local-6989586621679558726"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558726"><span class="hs-identifier hs-var">ownInputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679558727"><span class="hs-identifier hs-var">ownInput</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558725"><span class="annot"><span class="annottext">ownAddress :: Term s PAddress
</span><a href="#local-6989586621679558725"><span class="hs-identifier hs-var hs-var">ownAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PAddress) -&gt; Term s PAddress
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PAddress) -&gt; Term s PAddress)
-&gt; Term s (PAsData PAddress) -&gt; Term s PAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558726"><span class="hs-identifier hs-var">ownInputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PGovernorDatum) -&gt; Term s PGovernorDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679558724"><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558724"><span class="hs-identifier hs-var">oldGovernorDatum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agora.Governor.html#PGovernorDatum"><span class="hs-identifier hs-type">PGovernorDatum</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((Term s (PAsData PGovernorDatum),
   Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData PGovernorDatum),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">((((Term s (PAsData PGovernorDatum),
    Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (Term s (PAsData PGovernorDatum),
       Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s)))
-&gt; (((Term s (PAsData PGovernorDatum),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData PGovernorDatum),
      Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
-&gt; ((Term s (PAsData PGovernorDatum),
     Reduce @Type (PTryFromExcess PData (PAsData PGovernorDatum) s))
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall (b :: PType) (a :: PType) (s :: S) (r :: PType).
PTryFrom a b =&gt;
Term s a
-&gt; ((Term s b, Reduce @Type (PTryFromExcess a b s)) -&gt; Term s r)
-&gt; Term s r
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptryFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679558736"><span class="hs-identifier hs-var">datum'</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679558723"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-300"></span><span>      </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
       ((':)
          @(Symbol, Type)
          '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
          ((':)
             @(Symbol, Type)
             '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
             ((':)
                @(Symbol, Type)
                '(&quot;createProposalTimeRangeMaxWidth&quot;,
                  Term s (PAsData PMaxTimeRangeWidth))
                ('[] @(Symbol, Type))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
           ((':)
              @(Symbol, Type)
              '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
              ((':)
                 @(Symbol, Type)
                 '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;createProposalTimeRangeMaxWidth&quot;,
                      Term s (PAsData PMaxTimeRangeWidth))
                    ('[] @(Symbol, Type)))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
        ((':)
           @(Symbol, Type)
           '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
              ((':)
                 @(Symbol, Type)
                 '(&quot;createProposalTimeRangeMaxWidth&quot;,
                   Term s (PAsData PMaxTimeRangeWidth))
                 ('[] @(Symbol, Type))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
            ((':)
               @(Symbol, Type)
               '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
               ((':)
                  @(Symbol, Type)
                  '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;createProposalTimeRangeMaxWidth&quot;,
                       Term s (PAsData PMaxTimeRangeWidth))
                     ('[] @(Symbol, Type))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
          ((':)
             @(Symbol, Type)
             '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
             ((':)
                @(Symbol, Type)
                '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
                ((':)
                   @(Symbol, Type)
                   '(&quot;createProposalTimeRangeMaxWidth&quot;,
                     Term s (PAsData PMaxTimeRangeWidth))
                   ('[] @(Symbol, Type))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
           ((':)
              @(Symbol, Type)
              '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
              ((':)
                 @(Symbol, Type)
                 '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;createProposalTimeRangeMaxWidth&quot;,
                      Term s (PAsData PMaxTimeRangeWidth))
                    ('[] @(Symbol, Type)))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span>
</span><span id="line-302"></span><span>          </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalThresholds&quot;</span></span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;nextProposalId&quot;</span></span><span>
</span><span id="line-304"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalTimings&quot;</span></span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;createProposalTimeRangeMaxWidth&quot;</span></span><span>
</span><span id="line-306"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558724"><span class="hs-identifier hs-var">oldGovernorDatum</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- Check that GST will be returned to the governor.</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558722"><span class="annot"><span class="annottext">ownInputGSTAmount :: Term s (PInteger @S)
</span><a href="#local-6989586621679558722"><span class="hs-identifier hs-var hs-var">ownInputGSTAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558721"><span class="hs-identifier hs-var">pgstSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'Positive) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558726"><span class="hs-identifier hs-var">ownInputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Own input should have exactly one state token&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679558722"><span class="hs-identifier hs-var">ownInputGSTAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621679558720"><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558720"><span class="hs-identifier hs-var">ownOutputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PBuiltinList (PAsData PTxOut))
 -&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut))))
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PTxOut)
   :--&gt; (PAddress :--&gt; PBuiltinList (PAsData PTxOut)))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PTxOut)
   :--&gt; (PAddress :--&gt; PBuiltinList (PAsData PTxOut)))
</span><a href="Agora.Utils.html#findOutputsToAddress"><span class="hs-identifier hs-var">findOutputsToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PTxOut)
   :--&gt; (PAddress :--&gt; PBuiltinList (PAsData PTxOut)))
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; Term s (PAddress :--&gt; PBuiltinList (PAsData PTxOut))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">outputs</span><span> </span><span class="annot"><span class="annottext">Term s (PAddress :--&gt; PBuiltinList (PAsData PTxOut))
-&gt; Term s PAddress -&gt; Term s (PBuiltinList (PAsData PTxOut))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PAddress
</span><a href="#local-6989586621679558725"><span class="hs-identifier hs-var">ownAddress</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Exactly one utxo should be sent to the governor&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-316"></span><span>      </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PTxOut)) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558720"><span class="hs-identifier hs-var">ownOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679558718"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
     ((':)
        @(Symbol, Type)
        '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679558718"><span class="hs-identifier hs-var">ownOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
       ((':)
          @(Symbol, Type)
          '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
          ('[] @(Symbol, Type))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
           ((':)
              @(Symbol, Type)
              '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
        ((':)
           @(Symbol, Type)
           '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
           ('[] @(Symbol, Type))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
            ((':)
               @(Symbol, Type)
               '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
          ((':)
             @(Symbol, Type)
             '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
             ('[] @(Symbol, Type))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
           ((':)
              @(Symbol, Type)
              '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; (HRecOf
       (PAsData PTxOut)
       ((':) @Symbol &quot;value&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
       s
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PTxOut)
-&gt; (HRecOf
      (PAsData PTxOut)
      ((':) @Symbol &quot;value&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
      s
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PListLike list, PElemConstraint list a) =&gt;
Term s (list a :--&gt; a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phead</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PAsData PTxOut)
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558720"><span class="hs-identifier hs-var">ownOutputs</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558716"><span class="annot"><span class="annottext">ownOuputGSTAmount :: Term s (PInteger @S)
</span><a href="#local-6989586621679558716"><span class="hs-identifier hs-var hs-var">ownOuputGSTAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558721"><span class="hs-identifier hs-var">pgstSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'Positive) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
     ((':)
        @(Symbol, Type)
        '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679558718"><span class="hs-identifier hs-var">ownOutput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;State token should stay at governor's address&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679558716"><span class="hs-identifier hs-var">ownOuputGSTAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-comment">-- Check that own output have datum of type 'GovernorDatum'.</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558715"><span class="annot"><span class="annottext">outputGovernorStateDatumHash :: Term s PDatumHash
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var hs-var">outputGovernorStateDatumHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PString @S :--&gt; (PMaybeData a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePDJust"><span class="hs-identifier hs-var">mustBePDJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybeData PDatumHash :--&gt; PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Governor output doesn't have datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash :--&gt; PDatumHash)
-&gt; Term s (PMaybeData PDatumHash) -&gt; Term s PDatumHash
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;value&quot;, Term s (PAsData (PValue 'Sorted 'Positive)))
     ((':)
        @(Symbol, Type)
        '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679558718"><span class="hs-identifier hs-var">ownOutput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679558714"><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558714"><span class="hs-identifier hs-var">newGovernorDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">Term s PGovernorDatum
-&gt; TermCont @POpaque s (Term s PGovernorDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PGovernorDatum
 -&gt; TermCont @POpaque s (Term s PGovernorDatum))
-&gt; Term s PGovernorDatum
-&gt; TermCont @POpaque s (Term s PGovernorDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">Term s (PAsData PGovernorDatum) -&gt; Term s PGovernorDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PGovernorDatum) -&gt; Term s PGovernorDatum)
-&gt; Term s (PAsData PGovernorDatum) -&gt; Term s PGovernorDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-329"></span><span>          </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PGovernorDatum) :--&gt; PAsData PGovernorDatum))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PGovernorDatum) :--&gt; PAsData PGovernorDatum))
-&gt; Term s (PString @S)
-&gt; Term
     s (PMaybe (PAsData PGovernorDatum) :--&gt; PAsData PGovernorDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Ouput governor state datum not found&quot;</span></span><span class="hs-cpp">
            #$ ptryFindDatum # outputGovernorStateDatumHash # txInfoF.datums
</span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;New datum is not valid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PGovernorDatum :--&gt; PBool)
forall (s :: S). Term s (PGovernorDatum :--&gt; PBool)
</span><a href="Agora.Governor.html#governorDatumValid"><span class="hs-identifier hs-var">governorDatumValid</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PGovernorDatum :--&gt; PBool)
-&gt; Term s PGovernorDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558714"><span class="hs-identifier hs-var">newGovernorDatum</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><span class="annottext">Term s PGovernorRedeemer
-&gt; (PGovernorRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorRedeemer
</span><a href="#local-6989586621679558733"><span class="hs-identifier hs-var">redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PGovernorRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PGovernorRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><a href="Agora.Governor.html#PCreateProposal"><span class="hs-identifier hs-type">PCreateProposal</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>          </span><span class="hs-comment">-- Check that the transaction advances proposal id.</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558712"><span class="annot"><span class="annottext">expectedNextProposalId :: Term s PProposalId
</span><a href="#local-6989586621679558712"><span class="hs-identifier hs-var hs-var">expectedNextProposalId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalId :--&gt; PProposalId)
forall (s :: S). Term s (PProposalId :--&gt; PProposalId)
</span><a href="Agora.Governor.html#pgetNextProposalId"><span class="hs-identifier hs-var">pgetNextProposalId</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PProposalId :--&gt; PProposalId)
-&gt; Term s PProposalId -&gt; Term s PProposalId
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">nextProposalId</span><span>
</span><span id="line-339"></span><span>              </span><span id="local-6989586621679558711"><span class="annot"><span class="annottext">expectedNewDatum :: Term s PGovernorDatum
</span><a href="#local-6989586621679558711"><span class="hs-identifier hs-var hs-var">expectedNewDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalThresholds&quot; ':= PProposalThresholds)
         ((':)
            @PLabeledType
            (&quot;nextProposalId&quot; ':= PProposalId)
            ((':)
               @PLabeledType
               (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
               ((':)
                  @PLabeledType
                  (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
                  ('[] @PLabeledType))))))
 -&gt; PGovernorDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalThresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;nextProposalId&quot; ':= PProposalId)
           ((':)
              @PLabeledType
              (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
                 ('[] @PLabeledType)))))
-&gt; Term s PGovernorDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-341"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalThresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;nextProposalId&quot; ':= PProposalId)
           ((':)
              @PLabeledType
              (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
                 ('[] @PLabeledType))))))
-&gt; PGovernorDatum s'
</span><a href="Agora.Governor.html#PGovernorDatum"><span class="hs-identifier hs-var">PGovernorDatum</span></a></span><span>
</span><span id="line-342"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalThresholds&quot;
</span><span class="">#proposalThresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalThresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;nextProposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;proposalThresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;nextProposalId&quot; ':= PProposalId)
           ((':)
              @PLabeledType
              (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalThresholds</span><span>
</span><span id="line-343"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;nextProposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;proposalThresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;nextProposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;nextProposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalThresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;nextProposalId&quot; ':= PProposalId)
           ((':)
              @PLabeledType
              (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;nextProposalId&quot;
</span><span class="">#nextProposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;nextProposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;nextProposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalId -&gt; Term s (PAsData PProposalId)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalId
</span><a href="#local-6989586621679558712"><span class="hs-identifier hs-var">expectedNextProposalId</span></a></span><span>
</span><span id="line-344"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;nextProposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;nextProposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTimings&quot;
</span><span class="">#proposalTimings</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTimings&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalTimings</span><span>
</span><span id="line-345"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalTimings&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;createProposalTimeRangeMaxWidth&quot;
</span><span class="">#createProposalTimeRangeMaxWidth</span></span><span>
</span><span id="line-346"></span><span>                        </span><span class="annot"><span class="annottext">FieldName &quot;createProposalTimeRangeMaxWidth&quot;
-&gt; Term s (PAsData PMaxTimeRangeWidth)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;createProposalTimeRangeMaxWidth&quot; ':= PMaxTimeRangeWidth)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">createProposalTimeRangeMaxWidth</span><span>
</span><span id="line-347"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Unexpected governor state datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-349"></span><span>            </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558714"><span class="hs-identifier hs-var">newGovernorDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum -&gt; Term s PGovernorDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558711"><span class="hs-identifier hs-var">expectedNewDatum</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>          </span><span class="hs-comment">-- Check that exactly one proposal token is being minted.</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Exactly one proposal token must be minted&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span class="annot"><span class="annottext">Term
  s (PCurrencySymbol :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PBool))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PBool))
</span><a href="Agora.Utils.html#hasOnlyOneTokenOfCurrencySymbol"><span class="hs-identifier hs-var">hasOnlyOneTokenOfCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PCurrencySymbol :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PBool))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'NoGuarantees :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558706"><span class="hs-identifier hs-var">ppstSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'NoGuarantees :--&gt; PBool)
-&gt; Term s (PValue 'Sorted 'NoGuarantees) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>          </span><span class="hs-comment">-- Check that a stake is spent to create the propsal,</span><span>
</span><span id="line-357"></span><span>          </span><span class="hs-comment">--   and the value it contains meets the requirement.</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>          </span><span id="local-6989586621679558705"><span class="annot"><span class="annottext">Term s (PAsData PTxInInfo)
</span><a href="#local-6989586621679558705"><span class="hs-identifier hs-var">stakeInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-360"></span><span>            </span><span class="annot"><span class="annottext">Term s (PAsData PTxInInfo)
-&gt; TermCont @POpaque s (Term s (PAsData PTxInInfo))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxInInfo)
 -&gt; TermCont @POpaque s (Term s (PAsData PTxInInfo)))
-&gt; Term s (PAsData PTxInInfo)
-&gt; TermCont @POpaque s (Term s (PAsData PTxInInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-361"></span><span>              </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PTxInInfo) :--&gt; PAsData PTxInInfo))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PTxInInfo) :--&gt; PAsData PTxInInfo))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PTxInInfo) :--&gt; PAsData PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake input not found&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe (PAsData PTxInInfo) :--&gt; PAsData PTxInInfo)
-&gt; Term s (PMaybe (PAsData PTxInInfo))
-&gt; Term s (PAsData PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxInInfo :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxInInfo)
         :--&gt; PMaybe (PAsData PTxInInfo)))
forall (l :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike l a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (l a :--&gt; PMaybe a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfind</span></a></span><span class="hs-cpp">
                # phoistAcyclic
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">plam</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-364"></span><span>                      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;resolved&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">txOut'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>                        </span><span class="hs-identifier">txOut</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut'</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-368"></span><span>                          </span><span class="hs-identifier">txOut</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">pstakeValidatorAddress</span><span class="hs-cpp">
                            #&amp;&amp; psymbolValueOf # psstSymbol # txOut.value #== 1
</span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pfromData txInfoF.inputs
</span><span>
</span><span id="line-373"></span><span>          </span><span id="local-6989586621679558660"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558660"><span class="hs-identifier hs-var">stakeInputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; (HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PTxOut)
-&gt; (HRec
      (BoundTerms
         (PFields (PAsData PTxOut))
         (Bindings
            (PFields (PAsData PTxOut))
            ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInInfo :--&gt; PAsData PTxOut)
-&gt; Term s (PAsData PTxInInfo) -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInInfo)
</span><a href="#local-6989586621679558705"><span class="hs-identifier hs-var">stakeInput</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake input doesn't have datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash :--&gt; PBool)
forall (a :: PType) (s :: S). Term s (PMaybeData a :--&gt; PBool)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisDJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash :--&gt; PBool)
-&gt; Term s (PMaybeData PDatumHash) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558660"><span class="hs-identifier hs-var">stakeInputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558659"><span class="annot"><span class="annottext">stakeInputDatum :: Term s PStakeDatum
</span><a href="#local-6989586621679558659"><span class="hs-identifier hs-var hs-var">stakeInputDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PStakeDatum))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558660"><span class="hs-identifier hs-var">stakeInputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PStakeDatum)
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s PStakeDatum
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>          </span><span id="local-6989586621679558658"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
       ((':)
          @(Symbol, Type)
          '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
          ((':)
             @(Symbol, Type)
             '(&quot;lockedBy&quot;,
               Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
             ('[] @(Symbol, Type)))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ((':)
                 @(Symbol, Type)
                 '(&quot;lockedBy&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                 ('[] @(Symbol, Type))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
        ((':)
           @(Symbol, Type)
           '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
           ((':)
              @(Symbol, Type)
              '(&quot;lockedBy&quot;,
                Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
              ('[] @(Symbol, Type)))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
            ((':)
               @(Symbol, Type)
               '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
               ((':)
                  @(Symbol, Type)
                  '(&quot;lockedBy&quot;,
                    Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                  ('[] @(Symbol, Type)))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
          ((':)
             @(Symbol, Type)
             '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
             ((':)
                @(Symbol, Type)
                '(&quot;lockedBy&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                ('[] @(Symbol, Type)))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ((':)
                 @(Symbol, Type)
                 '(&quot;lockedBy&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                 ('[] @(Symbol, Type))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679558659"><span class="hs-identifier hs-var">stakeInputDatum</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Required amount of stake GTs should be presented&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-384"></span><span>            </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
forall (s :: S) {w :: KeyGuarantees} {w :: AmountGuarantees}.
Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
</span><a href="#local-6989586621679558657"><span class="hs-identifier hs-var">pgtValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PDiscrete @Type GTTag)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558660"><span class="hs-identifier hs-var">stakeInputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>          </span><span class="hs-comment">-- TODO: Is this required?</span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Tx should be signed by the stake owner&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">signatories</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; Term s (PAsData PPubKeyHash) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-comment">-- Check that the newly minted PST is sent to the proposal validator,</span><span>
</span><span id="line-391"></span><span>          </span><span class="hs-comment">--   and the datum it carries is legal.</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>          </span><span id="local-6989586621679558656"><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558656"><span class="hs-identifier hs-var">outputsToProposalValidatorWithStateToken</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-394"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PBuiltinList (PAsData PTxOut))
 -&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut))))
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-395"></span><span>              </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxOut :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxOut)
         :--&gt; PBuiltinList (PAsData PTxOut)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfilter</span></a></span><span class="hs-cpp">
                # phoistAcyclic
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">plam</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-398"></span><span>                      </span><span class="hs-glyph">\</span><span class="hs-identifier">txOut'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>                        </span><span class="hs-identifier">txOut</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut'</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-402"></span><span>                          </span><span class="hs-identifier">txOut</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">pproposalValidatorAddress</span><span class="hs-cpp">
                            #&amp;&amp; psymbolValueOf # ppstSymbol # txOut.value #== 1
</span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pfromData txInfoF.outputs
</span><span>
</span><span id="line-407"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Exactly one UTXO with proposal state token should be sent to the proposal validator&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PTxOut)) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558656"><span class="hs-identifier hs-var">outputsToProposalValidatorWithStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>          </span><span id="local-6989586621679558621"><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash)
</span><a href="#local-6989586621679558621"><span class="hs-identifier hs-var">outputDatumHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash)
-&gt; TermCont @POpaque s (Term s (PMaybeData PDatumHash))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMaybeData PDatumHash)
 -&gt; TermCont @POpaque s (Term s (PMaybeData PDatumHash)))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; TermCont @POpaque s (Term s (PMaybeData PDatumHash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut :--&gt; PMaybeData PDatumHash)
-&gt; Term s (PAsData PTxOut) -&gt; Term s (PMaybeData PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PListLike list, PElemConstraint list a) =&gt;
Term s (list a :--&gt; a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phead</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PAsData PTxOut)
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558656"><span class="hs-identifier hs-var">outputsToProposalValidatorWithStateToken</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>          </span><span id="local-6989586621679558620"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558620"><span class="hs-identifier hs-var">proposalOutputDatum'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalDatum
 -&gt; TermCont @POpaque s (Term s PProposalDatum))
-&gt; Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-414"></span><span>              </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-cpp">
                # outputDatumHash
</span><span class="hs-cpp">                # txInfoF.datums
</span><span>
</span><span id="line-418"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal datum must be valid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">Term s (PProposalDatum :--&gt; PBool)
forall (s :: S). Term s (PProposalDatum :--&gt; PBool)
</span><a href="#local-6989586621679558619"><span class="hs-identifier hs-var">proposalDatumValid'</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PProposalDatum :--&gt; PBool)
-&gt; Term s PProposalDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558620"><span class="hs-identifier hs-var">proposalOutputDatum'</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>          </span><span id="local-6989586621679558618"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-422"></span><span>            </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
       ((':)
          @(Symbol, Type)
          '(&quot;effects&quot;,
            Term
              s
              (PAsData
                 (PMap
                    'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
          ((':)
             @(Symbol, Type)
             '(&quot;cosigners&quot;,
               Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
             ((':)
                @(Symbol, Type)
                '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                ('[] @(Symbol, Type))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;cosigners&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ('[] @(Symbol, Type)))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;effects&quot;,
             Term
               s
               (PAsData
                  (PMap
                     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                 ('[] @(Symbol, Type))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
            ((':)
               @(Symbol, Type)
               '(&quot;effects&quot;,
                 Term
                   s
                   (PAsData
                      (PMap
                         'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
               ((':)
                  @(Symbol, Type)
                  '(&quot;cosigners&quot;,
                    Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                     ('[] @(Symbol, Type))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
          ((':)
             @(Symbol, Type)
             '(&quot;effects&quot;,
               Term
                 s
                 (PAsData
                    (PMap
                       'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
             ((':)
                @(Symbol, Type)
                '(&quot;cosigners&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                ((':)
                   @(Symbol, Type)
                   '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                   ('[] @(Symbol, Type))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;cosigners&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ('[] @(Symbol, Type)))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-423"></span><span>              </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span>
</span><span id="line-424"></span><span>                </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;effects&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cosigners&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalId&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;votes&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558620"><span class="hs-identifier hs-var">proposalOutputDatum'</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal should have only one cosigner&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-428"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Votes should be empty at this point</span><span>
</span><span id="line-431"></span><span>              </span><span id="local-6989586621679558617"><span class="annot"><span class="annottext">expectedVotes :: Term s PProposalVotes
</span><a href="#local-6989586621679558617"><span class="hs-identifier hs-var hs-var">expectedVotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PProposalVotes)
forall (s :: S) (a :: PType).
PIsData a =&gt;
Term s (PMap 'Unsorted PResultTag a :--&gt; PProposalVotes)
</span><a href="Agora.Proposal.html#pemptyVotesFor"><span class="hs-identifier hs-var">pemptyVotesFor</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PProposalVotes)
-&gt; Term
     s
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
-&gt; Term s PProposalVotes
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; Term
     s
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-432"></span><span>              </span><span id="local-6989586621679558616"><span class="annot"><span class="annottext">expectedStartingTime :: Term s PProposalStartingTime
</span><a href="#local-6989586621679558616"><span class="hs-identifier hs-var hs-var">expectedStartingTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>                </span><span class="annot"><span class="annottext">Term
  s
  (PMaxTimeRangeWidth
   :--&gt; (PPOSIXTimeRange :--&gt; PProposalStartingTime))
forall (s :: S).
Term
  s
  (PMaxTimeRangeWidth
   :--&gt; (PPOSIXTimeRange :--&gt; PProposalStartingTime))
</span><a href="Agora.Proposal.Time.html#createProposalStartingTime"><span class="hs-identifier hs-var">createProposalStartingTime</span></a></span><span class="hs-cpp">
                  # oldGovernorDatumF.createProposalTimeRangeMaxWidth
</span><span class="hs-cpp">                  # txInfoF.validRange
</span><span>              </span><span class="hs-comment">-- Id, thresholds and timings should be copied from the old governor state datum.</span><span>
</span><span id="line-437"></span><span>              </span><span id="local-6989586621679558615"><span class="annot"><span class="annottext">expectedProposalOut :: Term s PProposalDatum
</span><a href="#local-6989586621679558615"><span class="hs-identifier hs-var hs-var">expectedProposalOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-439"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-440"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">nextProposalId</span><span>
</span><span id="line-441"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-442"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Draft"><span class="hs-identifier hs-var">Draft</span></a></span><span>
</span><span id="line-443"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-444"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalThresholds</span><span>
</span><span id="line-445"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes -&gt; Term s (PAsData PProposalVotes)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes
</span><a href="#local-6989586621679558617"><span class="hs-identifier hs-var">expectedVotes</span></a></span><span>
</span><span id="line-446"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalThresholds&quot;, Term s (PAsData PProposalThresholds))
     ((':)
        @(Symbol, Type)
        '(&quot;nextProposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;proposalTimings&quot;, Term s (PAsData PProposalTimingConfig))
           ((':)
              @(Symbol, Type)
              '(&quot;createProposalTimeRangeMaxWidth&quot;,
                Term s (PAsData PMaxTimeRangeWidth))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558723"><span class="hs-identifier hs-var">oldGovernorDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalTimings</span><span>
</span><span id="line-447"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalStartingTime
-&gt; Term s (PAsData PProposalStartingTime)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalStartingTime
</span><a href="#local-6989586621679558616"><span class="hs-identifier hs-var">expectedStartingTime</span></a></span><span>
</span><span id="line-448"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Datum correct&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558615"><span class="hs-identifier hs-var">expectedProposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558620"><span class="hs-identifier hs-var">proposalOutputDatum'</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558612"><span class="annot"><span class="annottext">cosigner :: Term s (PAsData PPubKeyHash)
</span><a href="#local-6989586621679558612"><span class="hs-identifier hs-var hs-var">cosigner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PAsData PPubKeyHash)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PListLike list, PElemConstraint list a) =&gt;
Term s (list a :--&gt; a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phead</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PAsData PPubKeyHash)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData PPubKeyHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Cosigner should be the stake owner&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-455"></span><span>            </span><span class="annot"><span class="annottext">Term s PPubKeyHash -&gt; Term s (PAsData PPubKeyHash)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash)
-&gt; Term s (PAsData PPubKeyHash) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash)
</span><a href="#local-6989586621679558612"><span class="hs-identifier hs-var">cosigner</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>          </span><span class="hs-comment">-- Check the output stake has been proposly updated.</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>          </span><span id="local-6989586621679558611"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679558611"><span class="hs-identifier hs-var">stakeOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-460"></span><span>            </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; TermCont @POpaque s (Term s (PAsData PTxOut)))
-&gt; Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-461"></span><span>              </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span class="hs-cpp">
                # &quot;Stake output not found&quot;
</span><span class="hs-cpp">                  #$ pfind
</span><span class="hs-cpp">                # phoistAcyclic
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">plam</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-466"></span><span>                      </span><span class="hs-glyph">\</span><span class="hs-identifier">txOut'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>                        </span><span class="hs-identifier">txOut</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut'</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-470"></span><span>                          </span><span class="hs-identifier">txOut</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">pstakeValidatorAddress</span><span class="hs-cpp">
                            #&amp;&amp; psymbolValueOf # psstSymbol # txOut.value #== 1
</span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pfromData txInfoF.outputs
</span><span>
</span><span id="line-475"></span><span>          </span><span id="local-6989586621679558578"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558578"><span class="hs-identifier hs-var">stakeOutputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; (HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PTxOut)
-&gt; (HRec
      (BoundTerms
         (PFields (PAsData PTxOut))
         (Bindings
            (PFields (PAsData PTxOut))
            ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679558611"><span class="hs-identifier hs-var">stakeOutput</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Staked GTs should be sent back to stake validator&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
forall (s :: S) {w :: KeyGuarantees} {w :: AmountGuarantees}.
Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
</span><a href="#local-6989586621679558657"><span class="hs-identifier hs-var">pgtValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PDiscrete @Type GTTag)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558578"><span class="hs-identifier hs-var">stakeOutputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558577"><span class="annot"><span class="annottext">stakeOutputDatumHash :: Term s PDatumHash
</span><a href="#local-6989586621679558577"><span class="hs-identifier hs-var hs-var">stakeOutputDatumHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PString @S :--&gt; (PMaybeData a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePDJust"><span class="hs-identifier hs-var">mustBePDJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybeData PDatumHash :--&gt; PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake output should have datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybeData PDatumHash :--&gt; PDatumHash)
-&gt; Term s (PMaybeData PDatumHash) -&gt; Term s PDatumHash
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558578"><span class="hs-identifier hs-var">stakeOutputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>              </span><span id="local-6989586621679558576"><span class="annot"><span class="annottext">stakeOutputDatum :: Term s (PAsData PStakeDatum)
</span><a href="#local-6989586621679558576"><span class="hs-identifier hs-var hs-var">stakeOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-483"></span><span>                </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PStakeDatum) :--&gt; PAsData PStakeDatum))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PString @S
   :--&gt; (PMaybe (PAsData PStakeDatum) :--&gt; PAsData PStakeDatum))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PStakeDatum) :--&gt; PAsData PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake output not found&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe (PAsData PStakeDatum) :--&gt; PAsData PStakeDatum)
-&gt; Term s (PMaybe (PAsData PStakeDatum))
-&gt; Term s (PAsData PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PMaybe (PAsData PStakeDatum)))
forall (a :: PType) (s :: S).
PTryFrom PData a =&gt;
Term
  s
  (PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PMaybe a))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">ptryFindDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PMaybe (PAsData PStakeDatum)))
-&gt; Term s PDatumHash
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PMaybe (PAsData PStakeDatum))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PDatumHash
</span><a href="#local-6989586621679558577"><span class="hs-identifier hs-var">stakeOutputDatumHash</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PMaybe (PAsData PStakeDatum))
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s (PMaybe (PAsData PStakeDatum))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>          </span><span class="hs-comment">-- The stake should be locked by the newly created proposal.</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558575"><span class="annot"><span class="annottext">possibleVoteResults :: Term s (PBuiltinList (PAsData PResultTag))
</span><a href="#local-6989586621679558575"><span class="hs-identifier hs-var hs-var">possibleVoteResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap 'Unsorted PResultTag (PInteger @S)
   :--&gt; PBuiltinList (PAsData PResultTag))
forall (k :: PType) (v :: PType) (keys :: KeyGuarantees) (s :: S).
Term s (PMap keys k v :--&gt; PBuiltinList (PAsData k))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pkeys</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap 'Unsorted PResultTag (PInteger @S)
   :--&gt; PBuiltinList (PAsData PResultTag))
-&gt; Term s (PMap 'Unsorted PResultTag (PInteger @S))
-&gt; Term s (PBuiltinList (PAsData PResultTag))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes
-&gt; forall (b :: PType). Term s (PInner PProposalVotes b)
forall (s :: S) (a :: PType).
Term s a -&gt; forall (b :: PType). Term s (PInner a b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pto</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalVotes
 -&gt; forall (b :: PType). Term s (PInner PProposalVotes b))
-&gt; Term s PProposalVotes
-&gt; forall (b :: PType). Term s (PInner PProposalVotes b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalVotes) -&gt; Term s PProposalVotes
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;cosigners&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679558618"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>              </span><span class="annot"><a href="#local-6989586621679558573"><span class="hs-identifier hs-type">mkProposalLock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalId"><span class="hs-identifier hs-type">PProposalId</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Proposal.html#PResultTag"><span class="hs-identifier hs-type">PResultTag</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>              </span><span id="local-6989586621679558573"><span class="annot"><span class="annottext">mkProposalLock :: Term
  w
  (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
</span><a href="#local-6989586621679558573"><span class="hs-identifier hs-var hs-var">mkProposalLock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>                </span><span class="annot"><span class="annottext">ClosedTerm
  (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
-&gt; Term
     w
     (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm
   (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
 -&gt; Term
      w
      (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock)))
-&gt; ClosedTerm
     (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
-&gt; Term
     w
     (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-492"></span><span>                  </span><span class="annot"><span class="annottext">(Term s PProposalId
 -&gt; Term s (PAsData PResultTag) -&gt; Term s (PAsData PProposalLock))
-&gt; Term
     s
     (PProposalId :--&gt; (PAsData PResultTag :--&gt; PAsData PProposalLock))
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span>
</span><span id="line-493"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679558558"><span class="annot"><span class="annottext">Term s PProposalId
</span><a href="#local-6989586621679558558"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679558557"><span class="annot"><span class="annottext">Term s (PAsData PResultTag)
</span><a href="#local-6989586621679558557"><span class="hs-identifier hs-var">rt'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>                        </span><span class="annot"><span class="annottext">Term s PProposalLock -&gt; Term s (PAsData PProposalLock)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalLock -&gt; Term s (PAsData PProposalLock))
-&gt; Term s PProposalLock -&gt; Term s (PAsData PProposalLock)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-495"></span><span>                          </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;vote&quot; ':= PResultTag)
         ((':)
            @PLabeledType
            (&quot;proposalTag&quot; ':= PProposalId)
            ('[] @PLabeledType))))
 -&gt; PProposalLock s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
-&gt; Term s PProposalLock
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-496"></span><span>                            </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType
           (&quot;proposalTag&quot; ':= PProposalId)
           ('[] @PLabeledType))))
-&gt; PProposalLock s'
</span><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-var">PProposalLock</span></a></span><span>
</span><span id="line-497"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;vote&quot;
</span><span class="">#vote</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;vote&quot;
-&gt; Term s (PAsData PResultTag)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PResultTag)
</span><a href="#local-6989586621679558557"><span class="hs-identifier hs-var">rt'</span></a></span><span> </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;vote&quot; ':= PResultTag)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTag&quot;
</span><span class="">#proposalTag</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTag&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalId -&gt; Term s (PAsData PProposalId)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalId
</span><a href="#local-6989586621679558558"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-498"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>              </span><span class="hs-comment">-- Append new locks to existing locks</span><span>
</span><span id="line-502"></span><span>              </span><span id="local-6989586621679558555"><span class="annot"><span class="annottext">expectedProposalLocks :: Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679558555"><span class="hs-identifier hs-var hs-var">expectedProposalLocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-503"></span><span>                </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PBuiltinList (PAsData PProposalLock)
         :--&gt; PBuiltinList (PAsData PProposalLock)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconcat</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PBuiltinList (PAsData PProposalLock)
         :--&gt; PBuiltinList (PAsData PProposalLock)))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term
     s
     (PBuiltinList (PAsData PProposalLock)
      :--&gt; PBuiltinList (PAsData PProposalLock))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lockedBy</span><span class="hs-cpp">
                  #$ pmap # (mkProposalLock # proposalOutputDatum.proposalId) # possibleVoteResults
</span><span>
</span><span id="line-506"></span><span>              </span><span id="local-6989586621679558552"><span class="annot"><span class="annottext">expectedStakeOutputDatum :: Term s (PAsData PStakeDatum)
</span><a href="#local-6989586621679558552"><span class="hs-identifier hs-var hs-var">expectedStakeOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-507"></span><span>                </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum))
-&gt; Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-508"></span><span>                  </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-509"></span><span>                    </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-510"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-511"></span><span>                        </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679558658"><span class="hs-identifier hs-var">stakeInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-512"></span><span>                        </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679558555"><span class="hs-identifier hs-var">expectedProposalLocks</span></a></span><span>
</span><span id="line-513"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Unexpected stake output datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum)
</span><a href="#local-6989586621679558552"><span class="hs-identifier hs-var">expectedStakeOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum)
-&gt; Term s (PAsData PStakeDatum) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum)
</span><a href="#local-6989586621679558576"><span class="hs-identifier hs-var">stakeOutputDatum</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PUnit @S) -&gt; Term s POpaque)
-&gt; Term s (PUnit @S) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><a href="Agora.Governor.html#PMintGATs"><span class="hs-identifier hs-type">PMintGATs</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Governor state should not be changed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558714"><span class="hs-identifier hs-var">newGovernorDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum -&gt; Term s PGovernorDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PGovernorDatum
</span><a href="#local-6989586621679558724"><span class="hs-identifier hs-var">oldGovernorDatum</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-comment">-- Filter out proposal inputs and ouputs using PST and the address of proposal validator.</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;The governor can only process one proposal at a time&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-527"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558706"><span class="hs-identifier hs-var">ppstSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'Positive) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
forall (s :: S).
Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>          </span><span id="local-6989586621679558550"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields
        (PAsData
           (PUnLabel
              (IndexList
                 @PLabeledType
                 (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                 (PFields PTxInInfo)))))
     (Bindings
        (PFields
           (PAsData
              (PUnLabel
                 (IndexList
                    @PLabeledType
                    (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                    (PFields PTxInInfo)))))
        ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
     s)
</span><a href="#local-6989586621679558550"><span class="hs-identifier hs-var">proposalInputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields
          (PAsData
             (PUnLabel
                (IndexList
                   @PLabeledType
                   (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                   (PFields PTxInInfo)))))
       (Bindings
          (PFields
             (PAsData
                (PUnLabel
                   (IndexList
                      @PLabeledType
                      (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                      (PFields PTxInInfo)))))
          ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields
              (PAsData
                 (PUnLabel
                    (IndexList
                       @PLabeledType
                       (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                       (PFields PTxInInfo)))))
           (Bindings
              (PFields
                 (PAsData
                    (PUnLabel
                       (IndexList
                          @PLabeledType
                          (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                          (PFields PTxInInfo)))))
              ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields
           (PAsData
              (PUnLabel
                 (IndexList
                    @PLabeledType
                    (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                    (PFields PTxInInfo)))))
        (Bindings
           (PFields
              (PAsData
                 (PUnLabel
                    (IndexList
                       @PLabeledType
                       (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                       (PFields PTxInInfo)))))
           ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields
               (PAsData
                  (PUnLabel
                     (IndexList
                        @PLabeledType
                        (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                        (PFields PTxInInfo)))))
            (Bindings
               (PFields
                  (PAsData
                     (PUnLabel
                        (IndexList
                           @PLabeledType
                           (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                           (PFields PTxInInfo)))))
               ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields
             (PAsData
                (PUnLabel
                   (IndexList
                      @PLabeledType
                      (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                      (PFields PTxInInfo)))))
          (Bindings
             (PFields
                (PAsData
                   (PUnLabel
                      (IndexList
                         @PLabeledType
                         (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                         (PFields PTxInInfo)))))
             ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields
              (PAsData
                 (PUnLabel
                    (IndexList
                       @PLabeledType
                       (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                       (PFields PTxInInfo)))))
           (Bindings
              (PFields
                 (PAsData
                    (PUnLabel
                       (IndexList
                          @PLabeledType
                          (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                          (PFields PTxInInfo)))))
              ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-531"></span><span>              </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PAsData
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
            (PFields PTxInInfo))))
 -&gt; (HRec
       (BoundTerms
          (PFields
             (PAsData
                (PUnLabel
                   (IndexList
                      @PLabeledType
                      (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                      (PFields PTxInInfo)))))
          (Bindings
             (PFields
                (PAsData
                   (PUnLabel
                      (IndexList
                         @PLabeledType
                         (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                         (PFields PTxInInfo)))))
             ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
              (PFields PTxInInfo))))
-&gt; (HRec
      (BoundTerms
         (PFields
            (PAsData
               (PUnLabel
                  (IndexList
                     @PLabeledType
                     (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                     (PFields PTxInInfo)))))
         (Bindings
            (PFields
               (PAsData
                  (PUnLabel
                     (IndexList
                        @PLabeledType
                        (PLabelIndex &quot;resolved&quot; (PFields PTxInInfo))
                        (PFields PTxInInfo)))))
            ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-532"></span><span>                </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span class="hs-cpp">
                  #$ pfromData
</span><span>                  </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mustBePJust</span><span class="hs-cpp">
                    # &quot;Proposal input not found&quot;
</span><span class="hs-cpp">                      #$ pfind
</span><span class="hs-cpp">                    # plam
</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;resolved&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">txOut</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>                          </span><span class="hs-identifier">txOutF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>                          </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-542"></span><span>                            </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ppstSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOutF</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span class="hs-cpp">
                              #&amp;&amp; txOutF.address #== pdata pproposalValidatorAddress
</span><span>                      </span><span class="hs-special">)</span><span class="hs-cpp">
                    # pfromData txInfoF.inputs
</span><span>
</span><span id="line-547"></span><span>          </span><span id="local-6989586621679558547"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
     s)
</span><a href="#local-6989586621679558547"><span class="hs-identifier hs-var">proposalOutputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-548"></span><span>            </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-549"></span><span>              </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; (HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PTxOut)
-&gt; (HRec
      (BoundTerms
         (PFields (PAsData PTxOut))
         (Bindings
            (PFields (PAsData PTxOut))
            ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-550"></span><span>                </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal output not found&quot;</span></span><span class="hs-cpp">
                  #$ pfind
</span><span class="hs-cpp">                    # plam
</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">txOut</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-554"></span><span>                          </span><span class="hs-identifier">txOutF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut</span><span>
</span><span id="line-555"></span><span>                          </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-556"></span><span>                            </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ppstSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOutF</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span class="hs-cpp">
                              #&amp;&amp; txOutF.address #== pdata pproposalValidatorAddress
</span><span>                      </span><span class="hs-special">)</span><span class="hs-cpp">
                    # pfromData txInfoF.outputs
</span><span>
</span><span id="line-561"></span><span>          </span><span id="local-6989586621679558544"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558544"><span class="hs-identifier hs-var">proposalInputDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalDatum
 -&gt; TermCont @POpaque s (Term s PProposalDatum))
-&gt; Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-563"></span><span>              </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-cpp">
                # proposalInputF.datumHash
</span><span class="hs-cpp">                # txInfoF.datums
</span><span>          </span><span id="local-6989586621679558543"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558543"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-567"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalDatum
 -&gt; TermCont @POpaque s (Term s PProposalDatum))
-&gt; Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-568"></span><span>              </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-cpp">
                # proposalOutputF.datumHash
</span><span class="hs-cpp">                # txInfoF.datums
</span><span>
</span><span id="line-572"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal datum must be valid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-573"></span><span>            </span><span class="annot"><span class="annottext">Term s (PProposalDatum :--&gt; PBool)
forall (s :: S). Term s (PProposalDatum :--&gt; PBool)
</span><a href="#local-6989586621679558619"><span class="hs-identifier hs-var">proposalDatumValid'</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PProposalDatum :--&gt; PBool)
-&gt; Term s PProposalDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558544"><span class="hs-identifier hs-var">proposalInputDatum</span></a></span><span class="hs-cpp">
              #&amp;&amp; proposalDatumValid' # proposalOutputDatum
</span><span>
</span><span id="line-576"></span><span>          </span><span id="local-6989586621679558542"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-577"></span><span>            </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
       ((':)
          @(Symbol, Type)
          '(&quot;effects&quot;,
            Term
              s
              (PAsData
                 (PMap
                    'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
          ((':)
             @(Symbol, Type)
             '(&quot;status&quot;, Term s (PAsData PProposalStatus))
             ((':)
                @(Symbol, Type)
                '(&quot;cosigners&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                ((':)
                   @(Symbol, Type)
                   '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                      ((':)
                         @(Symbol, Type)
                         '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                         ((':)
                            @(Symbol, Type)
                            '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                            ('[] @(Symbol, Type))))))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;cosigners&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                             ((':)
                                @(Symbol, Type)
                                '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                ('[] @(Symbol, Type)))))))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;effects&quot;,
             Term
               s
               (PAsData
                  (PMap
                     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;status&quot;, Term s (PAsData PProposalStatus))
              ((':)
                 @(Symbol, Type)
                 '(&quot;cosigners&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                             ('[] @(Symbol, Type))))))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
            ((':)
               @(Symbol, Type)
               '(&quot;effects&quot;,
                 Term
                   s
                   (PAsData
                      (PMap
                         'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
               ((':)
                  @(Symbol, Type)
                  '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;cosigners&quot;,
                       Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                     ((':)
                        @(Symbol, Type)
                        '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                        ((':)
                           @(Symbol, Type)
                           '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                           ((':)
                              @(Symbol, Type)
                              '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                              ((':)
                                 @(Symbol, Type)
                                 '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                 ('[] @(Symbol, Type))))))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
          ((':)
             @(Symbol, Type)
             '(&quot;effects&quot;,
               Term
                 s
                 (PAsData
                    (PMap
                       'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
             ((':)
                @(Symbol, Type)
                '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                ((':)
                   @(Symbol, Type)
                   '(&quot;cosigners&quot;,
                     Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                      ((':)
                         @(Symbol, Type)
                         '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                         ((':)
                            @(Symbol, Type)
                            '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                            ((':)
                               @(Symbol, Type)
                               '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                               ('[] @(Symbol, Type))))))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;cosigners&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                             ((':)
                                @(Symbol, Type)
                                '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                ('[] @(Symbol, Type)))))))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-578"></span><span>              </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;proposalId&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;effects&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;status&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cosigners&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;thresholds&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;votes&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;timingConfig&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;startingTime&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span>                </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558544"><span class="hs-identifier hs-var">proposalInputDatum</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-comment">-- Check that the proposal state is advanced so that a proposal cannot be executed twice.</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal must be in locked(executable) state in order to execute effects&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-584"></span><span>            </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Locked"><span class="hs-identifier hs-var">Locked</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558541"><span class="annot"><span class="annottext">expectedOutputProposalDatum :: Term s PProposalDatum
</span><a href="#local-6989586621679558541"><span class="hs-identifier hs-var hs-var">expectedOutputProposalDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-587"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-588"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-589"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-590"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-591"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PProposalStatus s -&gt; Term s PProposalStatus
forall (a :: PType) (s :: S). PCon a =&gt; a s -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pcon</span></a></span><span> </span><span class="annot"><span class="annottext">(PProposalStatus s -&gt; Term s PProposalStatus)
-&gt; PProposalStatus s -&gt; Term s PProposalStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType)) -&gt; PProposalStatus s
forall (s :: S).
Term s (PDataRecord ('[] @PLabeledType)) -&gt; PProposalStatus s
</span><a href="Agora.Proposal.html#PFinished"><span class="hs-identifier hs-var">PFinished</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
forall (s :: S). Term s (PDataRecord ('[] @PLabeledType))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdnil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-593"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-594"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-595"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span>
</span><span id="line-596"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span>
</span><span id="line-597"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Unexpected output proposal datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-600"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s (PAsData PProposalDatum)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558543"><span class="hs-identifier hs-var">proposalOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalDatum)
-&gt; Term s (PAsData PProposalDatum) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s (PAsData PProposalDatum)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679558541"><span class="hs-identifier hs-var">expectedOutputProposalDatum</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>          </span><span class="hs-comment">-- TODO: anything else to check here?</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-comment">-- Find the highest votes and the corresponding tag.</span><span>
</span><span id="line-605"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558538"><span class="annot"><span class="annottext">quorum :: Term
  s
  (PInner
     (PInner
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds))))
        (Any @PType))
     (Any @PType))
</span><a href="#local-6989586621679558538"><span class="hs-identifier hs-var hs-var">quorum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PInner
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
           (PFields (PAsData PProposalThresholds))))
     (Any @PType))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PInner
           (PUnLabel
              (IndexList
                 @PLabeledType
                 (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
                 (PFields (PAsData PProposalThresholds))))
           (Any @PType))
        b)
forall (s :: S) (a :: PType).
Term s a -&gt; forall (b :: PType). Term s (PInner a b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pto</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PInner
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
            (PFields (PAsData PProposalThresholds))))
      (Any @PType))
 -&gt; forall (b :: PType).
    Term
      s
      (PInner
         (PInner
            (PUnLabel
               (IndexList
                  @PLabeledType
                  (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
                  (PFields (PAsData PProposalThresholds))))
            (Any @PType))
         b))
-&gt; Term
     s
     (PInner
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds))))
        (Any @PType))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PInner
           (PUnLabel
              (IndexList
                 @PLabeledType
                 (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
                 (PFields (PAsData PProposalThresholds))))
           (Any @PType))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PUnLabel
     (IndexList
        @PLabeledType
        (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
        (PFields (PAsData PProposalThresholds))))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds))))
        b)
forall (s :: S) (a :: PType).
Term s a -&gt; forall (b :: PType). Term s (PInner a b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pto</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PUnLabel
      (IndexList
         @PLabeledType
         (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
         (PFields (PAsData PProposalThresholds))))
 -&gt; forall (b :: PType).
    Term
      s
      (PInner
         (PUnLabel
            (IndexList
               @PLabeledType
               (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
               (PFields (PAsData PProposalThresholds))))
         b))
-&gt; Term
     s
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
           (PFields (PAsData PProposalThresholds))))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds))))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
           (PFields (PAsData PProposalThresholds)))))
-&gt; Term
     s
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
           (PFields (PAsData PProposalThresholds))))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PAsData
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
            (PFields (PAsData PProposalThresholds)))))
 -&gt; Term
      s
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
            (PFields (PAsData PProposalThresholds)))))
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds)))))
-&gt; Term
     s
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
           (PFields (PAsData PProposalThresholds))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;execute&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PProposalThresholds
   :--&gt; PAsData
          (PUnLabel
             (IndexList
                @PLabeledType
                (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
                (PFields (PAsData PProposalThresholds)))))
-&gt; Term s (PAsData PProposalThresholds)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds)))))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-606"></span><span>              </span><span id="local-6989586621679558537"><span class="annot"><span class="annottext">neutralOption :: Term s PResultTag
</span><a href="#local-6989586621679558537"><span class="hs-identifier hs-var hs-var">neutralOption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PResultTag)
forall (s :: S).
Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PResultTag)
</span><a href="Agora.Proposal.html#pneutralOption"><span class="hs-identifier hs-var">pneutralOption</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PResultTag)
-&gt; Term
     s
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
-&gt; Term s PResultTag
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-607"></span><span>              </span><span id="local-6989586621679558536"><span class="annot"><span class="annottext">finalResultTag :: Term s PResultTag
</span><a href="#local-6989586621679558536"><span class="hs-identifier hs-var hs-var">finalResultTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalVotes
   :--&gt; (PInteger @S :--&gt; (PResultTag :--&gt; PResultTag)))
forall (s :: S).
Term
  s
  (PProposalVotes
   :--&gt; (PInteger @S :--&gt; (PResultTag :--&gt; PResultTag)))
</span><a href="Agora.Proposal.html#pwinner"><span class="hs-identifier hs-var">pwinner</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalVotes
   :--&gt; (PInteger @S :--&gt; (PResultTag :--&gt; PResultTag)))
-&gt; Term s PProposalVotes
-&gt; Term s (PInteger @S :--&gt; (PResultTag :--&gt; PResultTag))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S :--&gt; (PResultTag :--&gt; PResultTag))
-&gt; Term s (PInteger @S) -&gt; Term s (PResultTag :--&gt; PResultTag)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
Term
  s
  (PInner
     (PInner
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;execute&quot; (PFields (PAsData PProposalThresholds)))
              (PFields (PAsData PProposalThresholds))))
        (Any @PType))
     (Any @PType))
</span><a href="#local-6989586621679558538"><span class="hs-identifier hs-var">quorum</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PResultTag :--&gt; PResultTag)
-&gt; Term s PResultTag -&gt; Term s PResultTag
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679558537"><span class="hs-identifier hs-var">neutralOption</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>          </span><span class="hs-comment">-- The effects of the winner outcome.</span><span>
</span><span id="line-610"></span><span>          </span><span id="local-6989586621679558535"><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PValidatorHash PDatumHash)
</span><a href="#local-6989586621679558535"><span class="hs-identifier hs-var">effectGroup</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PValidatorHash PDatumHash)
-&gt; TermCont
     @POpaque s (Term s (PMap 'Unsorted PValidatorHash PDatumHash))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMap 'Unsorted PValidatorHash PDatumHash)
 -&gt; TermCont
      @POpaque s (Term s (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; Term s (PMap 'Unsorted PValidatorHash PDatumHash)
-&gt; TermCont
     @POpaque s (Term s (PMap 'Unsorted PValidatorHash PDatumHash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
         :--&gt; PMap 'Unsorted PValidatorHash PDatumHash))
forall (k :: PType) (v :: PType) (keys :: KeyGuarantees) (s :: S).
(PIsData v, PIsData k, PEq k) =&gt;
Term s (k :--&gt; (PMap keys k v :--&gt; v))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">plookup'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
         :--&gt; PMap 'Unsorted PValidatorHash PDatumHash))
-&gt; Term s PResultTag
-&gt; Term
     s
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
      :--&gt; PMap 'Unsorted PValidatorHash PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679558536"><span class="hs-identifier hs-var">finalResultTag</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap
     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)
   :--&gt; PMap 'Unsorted PValidatorHash PDatumHash)
-&gt; Term
     s
     (PMap
        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
-&gt; Term s (PMap 'Unsorted PValidatorHash PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679558542"><span class="hs-identifier hs-var">proposalInputDatumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>          </span><span id="local-6989586621679558534"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679558534"><span class="hs-identifier hs-var">gatCount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList
     (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash))
   :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList
     (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash))
   :--&gt; PInteger @S)
-&gt; Term
     s
     (PBuiltinList
        (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
-&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList
     (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PBuiltinList
           (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
        b)
forall (s :: S) (a :: PType).
Term s a -&gt; forall (b :: PType). Term s (PInner a b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pto</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PBuiltinList
      (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
 -&gt; forall (b :: PType).
    Term
      s
      (PInner
         (PBuiltinList
            (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
         b))
-&gt; Term
     s
     (PBuiltinList
        (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
-&gt; forall (b :: PType).
   Term
     s
     (PInner
        (PBuiltinList
           (PBuiltinPair (PAsData PValidatorHash) (PAsData PDatumHash)))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PValidatorHash PDatumHash)
-&gt; forall (b :: PType).
   Term s (PInner (PMap 'Unsorted PValidatorHash PDatumHash) b)
forall (s :: S) (a :: PType).
Term s a -&gt; forall (b :: PType). Term s (PInner a b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pto</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PValidatorHash PDatumHash)
</span><a href="#local-6989586621679558535"><span class="hs-identifier hs-var">effectGroup</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Required amount of GATs should be minted&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-615"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558533"><span class="hs-identifier hs-var">patSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'NoGuarantees) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679558534"><span class="hs-identifier hs-var">gatCount</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>          </span><span class="hs-comment">-- Ensure that every GAT goes to one of the effects in the winner effect group.</span><span>
</span><span id="line-618"></span><span>          </span><span id="local-6989586621679558532"><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558532"><span class="hs-identifier hs-var">outputsWithGAT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-619"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PBuiltinList (PAsData PTxOut))
 -&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut))))
-&gt; Term s (PBuiltinList (PAsData PTxOut))
-&gt; TermCont @POpaque s (Term s (PBuiltinList (PAsData PTxOut)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-620"></span><span>              </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxOut :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxOut)
         :--&gt; PBuiltinList (PAsData PTxOut)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfilter</span></a></span><span class="hs-cpp">
                # phoistAcyclic
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">plam</span><span>
</span><span id="line-623"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-624"></span><span>                          </span><span class="hs-number">0</span><span> </span><span class="hs-operator">#&lt;</span><span> </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">patSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span>
</span><span id="line-625"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pfromData txInfoF.outputs
</span><span>
</span><span id="line-629"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Output GATs is more than minted GATs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-630"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PTxOut)) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxOut))
</span><a href="#local-6989586621679558532"><span class="hs-identifier hs-var">outputsWithGAT</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679558534"><span class="hs-identifier hs-var">gatCount</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558514"><span class="annot"><a href="#local-6989586621679558513"><span class="hs-identifier hs-type">gatOutputValidator'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558514"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidatorHash</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDatumHash</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxOut</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBool</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-633"></span><span>              </span><span id="local-6989586621679558513"><span class="annot"><span class="annottext">gatOutputValidator' :: Term
  s
  (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
</span><a href="#local-6989586621679558513"><span class="hs-identifier hs-var hs-var">gatOutputValidator'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-634"></span><span>                </span><span class="annot"><span class="annottext">ClosedTerm
  (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
-&gt; Term
     s
     (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm
   (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
 -&gt; Term
      s
      (PMap w PValidatorHash PDatumHash
       :--&gt; (PAsData PTxOut :--&gt; PBool)))
-&gt; ClosedTerm
     (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
-&gt; Term
     s
     (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-635"></span><span>                  </span><span class="annot"><span class="annottext">(Term s (PMap w PValidatorHash PDatumHash)
 -&gt; Term s (PAsData PTxOut) -&gt; Term s PBool)
-&gt; Term
     s
     (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span>
</span><span id="line-636"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679558461"><span class="annot"><span class="annottext">Term s (PMap w PValidatorHash PDatumHash)
</span><a href="#local-6989586621679558461"><span class="hs-identifier hs-var">effects</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PTxOut) -&gt; Term s PTxOut
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679558460"><span class="annot"><span class="annottext">Term s PTxOut
</span><a href="#local-6989586621679558460"><span class="hs-identifier hs-var">output'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @PBool s (Term s PBool) -&gt; Term s PBool)
-&gt; TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>                        </span><span id="local-6989586621679558459"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;address&quot;, Term s (PAsData PAddress))
     ((':)
        @(Symbol, Type)
        '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679558459"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;address&quot;, Term s (PAsData PAddress))
       ((':)
          @(Symbol, Type)
          '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
          ('[] @(Symbol, Type))))
  -&gt; Term s PBool)
 -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;address&quot;, Term s (PAsData PAddress))
           ((':)
              @(Symbol, Type)
              '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;address&quot;, Term s (PAsData PAddress))
        ((':)
           @(Symbol, Type)
           '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
           ('[] @(Symbol, Type))))
   -&gt; Term s PBool)
  -&gt; Term s PBool)
 -&gt; TermCont
      @PBool
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;address&quot;, Term s (PAsData PAddress))
            ((':)
               @(Symbol, Type)
               '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;address&quot;, Term s (PAsData PAddress))
          ((':)
             @(Symbol, Type)
             '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
             ('[] @(Symbol, Type))))
     -&gt; Term s PBool)
    -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;address&quot;, Term s (PAsData PAddress))
           ((':)
              @(Symbol, Type)
              '(&quot;datumHash&quot;, Term s (PAsData (PMaybeData PDatumHash)))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s PTxOut
 -&gt; (HRecOf
       PTxOut
       ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
       s
     -&gt; Term s PBool)
 -&gt; Term s PBool)
-&gt; Term s PTxOut
-&gt; (HRecOf
      PTxOut
      ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))
      s
    -&gt; Term s PBool)
-&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOut
</span><a href="#local-6989586621679558460"><span class="hs-identifier hs-var">output'</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558458"><span class="annot"><span class="annottext">scriptHash :: Term s PValidatorHash
</span><a href="#local-6989586621679558458"><span class="hs-identifier hs-var hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-640"></span><span>                              </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe PValidatorHash :--&gt; PValidatorHash))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe PValidatorHash :--&gt; PValidatorHash))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe PValidatorHash :--&gt; PValidatorHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;GAT receiver is not a script&quot;</span></span><span class="hs-cpp">
                                #$ scriptHashFromAddress # output.address
</span><span>                            </span><span id="local-6989586621679558457"><span class="annot"><span class="annottext">datumHash :: Term s PDatumHash
</span><a href="#local-6989586621679558457"><span class="hs-identifier hs-var hs-var">datumHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-643"></span><span>                              </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PString @S :--&gt; (PMaybeData a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePDJust"><span class="hs-identifier hs-var">mustBePDJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybeData PDatumHash :--&gt; PDatumHash))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybeData PDatumHash :--&gt; PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Output to effect should have datum&quot;</span></span><span class="hs-cpp">
                                #$ output.datumHash
</span><span>
</span><span id="line-646"></span><span>                            </span><span id="local-6989586621679558456"><span class="annot"><span class="annottext">expectedDatumHash :: Term s PDatumHash
</span><a href="#local-6989586621679558456"><span class="hs-identifier hs-var hs-var">expectedDatumHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>                              </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybe PDatumHash :--&gt; PDatumHash))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S :--&gt; (PMaybe PDatumHash :--&gt; PDatumHash))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe PDatumHash :--&gt; PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Receiver is not in the effect list&quot;</span></span><span class="hs-cpp">
                                #$ plookup # scriptHash # effects
</span><span>
</span><span id="line-650"></span><span>                        </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @PBool s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-651"></span><span>                          </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldr1</span></a></span><span>
</span><span id="line-652"></span><span>                            </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-653"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;GAT must be tagged by the effect hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTxOut :--&gt; PBool))
forall (s :: S). Term s (PCurrencySymbol :--&gt; (PTxOut :--&gt; PBool))
</span><a href="Agora.AuthorityToken.html#authorityTokensValidIn"><span class="hs-identifier hs-var">authorityTokensValidIn</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTxOut :--&gt; PBool))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTxOut :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558533"><span class="hs-identifier hs-var">patSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxOut :--&gt; PBool) -&gt; Term s PTxOut -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOut
</span><a href="#local-6989586621679558460"><span class="hs-identifier hs-var">output'</span></a></span><span>
</span><span id="line-654"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Unexpected datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PDatumHash
</span><a href="#local-6989586621679558457"><span class="hs-identifier hs-var">datumHash</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PDatumHash -&gt; Term s PDatumHash -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PDatumHash
</span><a href="#local-6989586621679558456"><span class="hs-identifier hs-var">expectedDatumHash</span></a></span><span>
</span><span id="line-655"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-656"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>              </span><span id="local-6989586621679558453"><span class="annot"><span class="annottext">gatOutputValidator :: Term s (PAsData PTxOut :--&gt; PBool)
</span><a href="#local-6989586621679558453"><span class="hs-identifier hs-var hs-var">gatOutputValidator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap 'Unsorted PValidatorHash PDatumHash
   :--&gt; (PAsData PTxOut :--&gt; PBool))
forall (s :: S) {w :: KeyGuarantees}.
Term
  s
  (PMap w PValidatorHash PDatumHash :--&gt; (PAsData PTxOut :--&gt; PBool))
</span><a href="#local-6989586621679558513"><span class="hs-identifier hs-var">gatOutputValidator'</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap 'Unsorted PValidatorHash PDatumHash
   :--&gt; (PAsData PTxOut :--&gt; PBool))
-&gt; Term s (PMap 'Unsorted PValidatorHash PDatumHash)
-&gt; Term s (PAsData PTxOut :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PValidatorHash PDatumHash)
</span><a href="#local-6989586621679558535"><span class="hs-identifier hs-var">effectGroup</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque) -&gt; Term s PBool -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-662"></span><span>              </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxOut :--&gt; (PBool :--&gt; PBool))
   :--&gt; (PBool :--&gt; (PBuiltinList (PAsData PTxOut) :--&gt; PBool)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S) (b :: PType).
PIsListLike list a =&gt;
Term s ((a :--&gt; (b :--&gt; b)) :--&gt; (b :--&gt; (list a :--&gt; b)))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfoldr</span></a></span><span class="hs-cpp">
                # plam
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">txOut</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-665"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOut</span><span>
</span><span id="line-666"></span><span>                          </span><span class="hs-identifier">atValue</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">patSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span>
</span><span id="line-667"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">pif</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">atValue</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-668"></span><span>                            </span><span class="hs-identifier">pif</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">atValue</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">#&amp;&amp;</span><span> </span><span class="hs-identifier">gatOutputValidator</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOut</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pconstant</span><span> </span><span class="hs-identifier">False</span><span>
</span><span id="line-669"></span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pconstant True
</span><span class="hs-cpp">                # pfromData txInfoF.outputs
</span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><a href="Agora.Governor.html#PMutateGovernor"><span class="hs-identifier hs-type">PMutateGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>          </span><span class="hs-comment">-- Check that a GAT is burnt.</span><span>
</span><span id="line-677"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque) -&gt; Term s PBool -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
-&gt; Term s (PAsData PTxInfo)
-&gt; Term s (PValue 'Sorted 'NoGuarantees)
-&gt; Term s PBool
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term s PCurrencySymbol
-&gt; Term s (PAsData PTxInfo)
-&gt; Term s (PValue keys amounts)
-&gt; Term s PBool
</span><a href="Agora.AuthorityToken.html#singleAuthorityTokenBurned"><span class="hs-identifier hs-var">singleAuthorityTokenBurned</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558533"><span class="hs-identifier hs-var">patSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679558731"><span class="hs-identifier hs-var">ctxF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol
                    &quot;datums&quot;
                    ((':)
                       @Symbol
                       &quot;signatories&quot;
                       ((':) @Symbol &quot;validRange&quot; ('[] @Symbol))))))))
     s)
</span><a href="#local-6989586621679558729"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-679"></span><span>    </span><span class="hs-comment">-- Get th amount of governance tokens in a value.</span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679558446"><span class="annot"><a href="#local-6989586621679558657"><span class="hs-identifier hs-type">pgtValueOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558446"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValue</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier hs-type">PDiscrete</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679558657"><span class="annot"><span class="annottext">pgtValueOf :: Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
</span><a href="#local-6989586621679558657"><span class="hs-identifier hs-var hs-var">pgtValueOf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm (PValue w w :--&gt; PDiscrete @Type GTTag)
-&gt; Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm (PValue w w :--&gt; PDiscrete @Type GTTag)
 -&gt; Term s (PValue w w :--&gt; PDiscrete @Type GTTag))
-&gt; ClosedTerm (PValue w w :--&gt; PDiscrete @Type GTTag)
-&gt; Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass
-&gt; Term s (PValue w w :--&gt; PDiscrete @Type GTTag)
forall k (tag :: k) (keys :: KeyGuarantees)
       (amounts :: AmountGuarantees) (s :: S).
Tagged @k tag AssetClass
-&gt; Term s (PValue keys amounts :--&gt; PDiscrete @k tag)
</span><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier hs-var">pvalueDiscrete'</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span>    </span><span class="hs-comment">-- The currency symbol of authority token.</span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621679558442"><span class="annot"><a href="#local-6989586621679558533"><span class="hs-identifier hs-type">patSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558442"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PCurrencySymbol</span></a></span></span><span>
</span><span id="line-685"></span><span>    </span><span id="local-6989586621679558533"><span class="annot"><span class="annottext">patSymbol :: forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558533"><span class="hs-identifier hs-var hs-var">patSymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PCurrencySymbol) -&gt; Term s PCurrencySymbol
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PCurrencySymbol)
 -&gt; Term s PCurrencySymbol)
-&gt; (forall (s :: S). Term s PCurrencySymbol)
-&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol)
-&gt; PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#authorityTokenSymbolFromGovernor"><span class="hs-identifier hs-var">authorityTokenSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-comment">-- The currency symbol of the proposal state token.</span><span>
</span><span id="line-688"></span><span>    </span><span id="local-6989586621679558437"><span class="annot"><a href="#local-6989586621679558706"><span class="hs-identifier hs-type">ppstSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558437"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PCurrencySymbol</span></a></span></span><span>
</span><span id="line-689"></span><span>    </span><span id="local-6989586621679558706"><span class="annot"><span class="annottext">ppstSymbol :: forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558706"><span class="hs-identifier hs-var hs-var">ppstSymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679558433"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679558433"><span class="hs-identifier hs-var">sym</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#proposalSTAssetClassFromGovernor"><span class="hs-identifier hs-var">proposalSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-691"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PCurrencySymbol) -&gt; Term s PCurrencySymbol
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PCurrencySymbol)
 -&gt; Term s PCurrencySymbol)
-&gt; (forall (s :: S). Term s PCurrencySymbol)
-&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679558433"><span class="hs-identifier hs-var">sym</span></a></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-comment">-- Is a proposal state datum valid?</span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679560274"><span class="annot"><a href="#local-6989586621679558619"><span class="hs-identifier hs-type">proposalDatumValid'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679560274"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBool</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-695"></span><span>    </span><span id="local-6989586621679558619"><span class="annot"><span class="annottext">proposalDatumValid' :: forall (s :: S). Term s (PProposalDatum :--&gt; PBool)
</span><a href="#local-6989586621679558619"><span class="hs-identifier hs-var hs-var">proposalDatumValid'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558429"><span class="annot"><span class="annottext">params :: Proposal
</span><a href="#local-6989586621679558429"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; Proposal
</span><a href="Agora.Governor.Scripts.html#proposalFromGovernor"><span class="hs-identifier hs-var">proposalFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-697"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s (PProposalDatum :--&gt; PBool))
-&gt; Term s (PProposalDatum :--&gt; PBool)
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s (PProposalDatum :--&gt; PBool))
 -&gt; Term s (PProposalDatum :--&gt; PBool))
-&gt; (forall (s :: S). Term s (PProposalDatum :--&gt; PBool))
-&gt; Term s (PProposalDatum :--&gt; PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal -&gt; Term s (PProposalDatum :--&gt; PBool)
forall (s :: S). Proposal -&gt; Term s (PProposalDatum :--&gt; PBool)
</span><a href="Agora.Proposal.html#proposalDatumValid"><span class="hs-identifier hs-var">proposalDatumValid</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679558429"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>    </span><span class="hs-comment">-- The address of the proposal validator.</span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621679558428"><span class="annot"><a href="#local-6989586621679558622"><span class="hs-identifier hs-type">pproposalValidatorAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558428"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAddress</span></a></span></span><span>
</span><span id="line-701"></span><span>    </span><span id="local-6989586621679558622"><span class="annot"><span class="annottext">pproposalValidatorAddress :: forall (s :: S). Term s PAddress
</span><a href="#local-6989586621679558622"><span class="hs-identifier hs-var hs-var">pproposalValidatorAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558425"><span class="annot"><span class="annottext">vh :: ValidatorHash
</span><a href="#local-6989586621679558425"><span class="hs-identifier hs-var hs-var">vh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#proposalValidatorHashFromGovernor"><span class="hs-identifier hs-var">proposalValidatorHashFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-703"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PAddress) -&gt; Term s PAddress
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PAddress) -&gt; Term s PAddress)
-&gt; (forall (s :: S). Term s PAddress) -&gt; Term s PAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PAddress -&gt; Term s PAddress
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PAddress -&gt; Term s PAddress)
-&gt; PLifted PAddress -&gt; Term s PAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Address
</span><a href="Agora.Utils.html#validatorHashToAddress"><span class="hs-identifier hs-var">validatorHashToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679558425"><span class="hs-identifier hs-var">vh</span></a></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-comment">-- The address of the stake validator.</span><span>
</span><span id="line-706"></span><span>    </span><span id="local-6989586621679560285"><span class="annot"><a href="#local-6989586621679558662"><span class="hs-identifier hs-type">pstakeValidatorAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679560285"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAddress</span></a></span></span><span>
</span><span id="line-707"></span><span>    </span><span id="local-6989586621679558662"><span class="annot"><span class="annottext">pstakeValidatorAddress :: forall (s :: S). Term s PAddress
</span><a href="#local-6989586621679558662"><span class="hs-identifier hs-var hs-var">pstakeValidatorAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-708"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558420"><span class="annot"><span class="annottext">vh :: ValidatorHash
</span><a href="#local-6989586621679558420"><span class="hs-identifier hs-var hs-var">vh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#stakeValidatorHashFromGovernor"><span class="hs-identifier hs-var">stakeValidatorHashFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-709"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PAddress) -&gt; Term s PAddress
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PAddress) -&gt; Term s PAddress)
-&gt; (forall (s :: S). Term s PAddress) -&gt; Term s PAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PAddress -&gt; Term s PAddress
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PAddress -&gt; Term s PAddress)
-&gt; PLifted PAddress -&gt; Term s PAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Address
</span><a href="Agora.Utils.html#validatorHashToAddress"><span class="hs-identifier hs-var">validatorHashToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679558420"><span class="hs-identifier hs-var">vh</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>    </span><span class="hs-comment">-- The currency symbol of the stake state token.</span><span>
</span><span id="line-712"></span><span>    </span><span id="local-6989586621679558418"><span class="annot"><a href="#local-6989586621679558661"><span class="hs-identifier hs-type">psstSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679558418"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PCurrencySymbol</span></a></span></span><span>
</span><span id="line-713"></span><span>    </span><span id="local-6989586621679558661"><span class="annot"><span class="annottext">psstSymbol :: forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558661"><span class="hs-identifier hs-var hs-var">psstSymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558415"><span class="annot"><span class="annottext">sym :: CurrencySymbol
</span><a href="#local-6989586621679558415"><span class="hs-identifier hs-var hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#stakeSTSymbolFromGovernor"><span class="hs-identifier hs-var">stakeSTSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-715"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PCurrencySymbol) -&gt; Term s PCurrencySymbol
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PCurrencySymbol)
 -&gt; Term s PCurrencySymbol)
-&gt; (forall (s :: S). Term s PCurrencySymbol)
-&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679558415"><span class="hs-identifier hs-var">sym</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-comment">-- The currency symbol of the governor state token.</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621679560322"><span class="annot"><a href="#local-6989586621679558721"><span class="hs-identifier hs-type">pgstSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679560322"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PCurrencySymbol</span></a></span></span><span>
</span><span id="line-719"></span><span>    </span><span id="local-6989586621679558721"><span class="annot"><span class="annottext">pgstSymbol :: forall (s :: S). Term s PCurrencySymbol
</span><a href="#local-6989586621679558721"><span class="hs-identifier hs-var hs-var">pgstSymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-720"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558411"><span class="annot"><span class="annottext">sym :: CurrencySymbol
</span><a href="#local-6989586621679558411"><span class="hs-identifier hs-var hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#governorSTSymbolFromGovernor"><span class="hs-identifier hs-var">governorSTSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558737"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-721"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s PCurrencySymbol) -&gt; Term s PCurrencySymbol
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s PCurrencySymbol)
 -&gt; Term s PCurrencySymbol)
-&gt; (forall (s :: S). Term s PCurrencySymbol)
-&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679558411"><span class="hs-identifier hs-var">sym</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="hs-comment">{- | Get the 'CurrencySymbol' of GST.

     @since 0.1.0
-}</span><span>
</span><span id="line-729"></span><span class="annot"><a href="Agora.Governor.Scripts.html#governorSTSymbolFromGovernor"><span class="hs-identifier hs-type">governorSTSymbolFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-730"></span><span id="governorSTSymbolFromGovernor"><span class="annot"><span class="annottext">governorSTSymbolFromGovernor :: Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#governorSTSymbolFromGovernor"><span class="hs-identifier hs-var hs-var">governorSTSymbolFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558409"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558409"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679558408"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><a href="#local-6989586621679558408"><span class="hs-identifier hs-type">policy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">MintingPolicy</span></a></span><span>
</span><span id="line-733"></span><span>    </span><span id="local-6989586621679558408"><span class="annot"><span class="annottext">policy :: MintingPolicy
</span><a href="#local-6989586621679558408"><span class="hs-identifier hs-var hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PMintingPolicy -&gt; MintingPolicy)
-&gt; ClosedTerm PMintingPolicy -&gt; MintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Governor -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Governor.Scripts.html#governorPolicy"><span class="hs-identifier hs-var">governorPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558409"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">{- | Get the 'AssetClass' of GST.

     @since 0.1.0
-}</span><span>
</span><span id="line-739"></span><span class="annot"><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier hs-type">governorSTAssetClassFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span>
</span><span id="line-740"></span><span id="governorSTAssetClassFromGovernor"><span class="annot"><span class="annottext">governorSTAssetClassFromGovernor :: Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier hs-var hs-var">governorSTAssetClassFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558407"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558407"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-var">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679558406"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-742"></span><span>    </span><span class="annot"><a href="#local-6989586621679558406"><span class="hs-identifier hs-type">symbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-743"></span><span>    </span><span id="local-6989586621679558406"><span class="annot"><span class="annottext">symbol :: CurrencySymbol
</span><a href="#local-6989586621679558406"><span class="hs-identifier hs-var hs-var">symbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#governorSTSymbolFromGovernor"><span class="hs-identifier hs-var">governorSTSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558407"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="hs-comment">{- | Get the 'CurrencySymbol' of the proposal state token.

     @since 0.1.0
-}</span><span>
</span><span id="line-749"></span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalSTSymbolFromGovernor"><span class="hs-identifier hs-type">proposalSTSymbolFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-750"></span><span id="proposalSTSymbolFromGovernor"><span class="annot"><span class="annottext">proposalSTSymbolFromGovernor :: Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#proposalSTSymbolFromGovernor"><span class="hs-identifier hs-var hs-var">proposalSTSymbolFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558405"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558405"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679558404"><span class="hs-identifier hs-var">symbol</span></a></span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-752"></span><span>    </span><span id="local-6989586621679558403"><span class="annot"><span class="annottext">gstAC :: AssetClass
</span><a href="#local-6989586621679558403"><span class="hs-identifier hs-var hs-var">gstAC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier hs-var">governorSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558405"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span id="local-6989586621679558402"><span class="annot"><span class="annottext">policy :: MintingPolicy
</span><a href="#local-6989586621679558402"><span class="hs-identifier hs-var hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PMintingPolicy -&gt; MintingPolicy)
-&gt; ClosedTerm PMintingPolicy -&gt; MintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-var">proposalPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679558403"><span class="hs-identifier hs-var">gstAC</span></a></span><span>
</span><span id="line-754"></span><span>    </span><span id="local-6989586621679558404"><span class="annot"><span class="annottext">symbol :: CurrencySymbol
</span><a href="#local-6989586621679558404"><span class="hs-identifier hs-var hs-var">symbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679558402"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="hs-comment">{- | Get the 'AssetClass' of the proposal state token.

     @since 0.1.0
-}</span><span>
</span><span id="line-760"></span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalSTAssetClassFromGovernor"><span class="hs-identifier hs-type">proposalSTAssetClassFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span>
</span><span id="line-761"></span><span id="proposalSTAssetClassFromGovernor"><span class="annot"><span class="annottext">proposalSTAssetClassFromGovernor :: Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#proposalSTAssetClassFromGovernor"><span class="hs-identifier hs-var hs-var">proposalSTAssetClassFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558401"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558401"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-var">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679558400"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-763"></span><span>    </span><span id="local-6989586621679558400"><span class="annot"><span class="annottext">symbol :: CurrencySymbol
</span><a href="#local-6989586621679558400"><span class="hs-identifier hs-var hs-var">symbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#proposalSTSymbolFromGovernor"><span class="hs-identifier hs-var">proposalSTSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558401"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-comment">{- | Get the 'CurrencySymbol' of the stake token/

     @since 0.1.0
-}</span><span>
</span><span id="line-769"></span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeSTSymbolFromGovernor"><span class="hs-identifier hs-type">stakeSTSymbolFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-770"></span><span id="stakeSTSymbolFromGovernor"><span class="annot"><span class="annottext">stakeSTSymbolFromGovernor :: Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#stakeSTSymbolFromGovernor"><span class="hs-identifier hs-var hs-var">stakeSTSymbolFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558399"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558399"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679558398"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-772"></span><span>    </span><span id="local-6989586621679558398"><span class="annot"><span class="annottext">policy :: MintingPolicy
</span><a href="#local-6989586621679558398"><span class="hs-identifier hs-var hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PMintingPolicy -&gt; MintingPolicy)
-&gt; ClosedTerm PMintingPolicy -&gt; MintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier hs-var">stakePolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558399"><span class="hs-identifier hs-var">gov</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="hs-comment">{- | Get the 'AssetClass' of the stake token.

   Note that the token is tagged with the hash of the stake validator.
   See 'Agora.Stake.Script.stakePolicy'.

    @since 0.1.0
-}</span><span>
</span><span id="line-781"></span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeSTAssetClassFromGovernor"><span class="hs-identifier hs-type">stakeSTAssetClassFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span>
</span><span id="line-782"></span><span id="stakeSTAssetClassFromGovernor"><span class="annot"><span class="annottext">stakeSTAssetClassFromGovernor :: Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#stakeSTAssetClassFromGovernor"><span class="hs-identifier hs-var hs-var">stakeSTAssetClassFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558396"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558396"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-var">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679558395"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679558394"><span class="hs-identifier hs-var">tokenName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-784"></span><span>    </span><span id="local-6989586621679558395"><span class="annot"><span class="annottext">symbol :: CurrencySymbol
</span><a href="#local-6989586621679558395"><span class="hs-identifier hs-var hs-var">symbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#stakeSTSymbolFromGovernor"><span class="hs-identifier hs-var">stakeSTSymbolFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558396"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-comment">-- Tag with the address where the token is being sent to.</span><span>
</span><span id="line-787"></span><span>    </span><span id="local-6989586621679558394"><span class="annot"><span class="annottext">tokenName :: TokenName
</span><a href="#local-6989586621679558394"><span class="hs-identifier hs-var hs-var">tokenName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; TokenName
</span><a href="Agora.Utils.html#validatorHashToTokenName"><span class="hs-identifier hs-var">validatorHashToTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidatorHash -&gt; TokenName) -&gt; ValidatorHash -&gt; TokenName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#stakeValidatorHashFromGovernor"><span class="hs-identifier hs-var">stakeValidatorHashFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558396"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="hs-comment">{- | Get the 'Stake' parameter, given the 'Governor' parameter.

     @since 0.1.0
-}</span><span>
</span><span id="line-793"></span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeFromGovernor"><span class="hs-identifier hs-type">stakeFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span>
</span><span id="line-794"></span><span id="stakeFromGovernor"><span class="annot"><span class="annottext">stakeFromGovernor :: Governor -&gt; Stake
</span><a href="Agora.Governor.Scripts.html#stakeFromGovernor"><span class="hs-identifier hs-var hs-var">stakeFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558393"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558393"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-795"></span><span>  </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass -&gt; AssetClass -&gt; Stake
</span><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558393"><span class="hs-identifier hs-var">gov</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span> </span><span class="annot"><span class="annottext">(AssetClass -&gt; Stake) -&gt; AssetClass -&gt; Stake
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#proposalSTAssetClassFromGovernor"><span class="hs-identifier hs-var">proposalSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558393"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span class="hs-comment">{- | Get the hash of 'Agora.Stake.Script.stakePolicy'.

     @since 0.1.0
-}</span><span>
</span><span id="line-802"></span><span class="annot"><a href="Agora.Governor.Scripts.html#stakeValidatorHashFromGovernor"><span class="hs-identifier hs-type">stakeValidatorHashFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">ValidatorHash</span></a></span><span>
</span><span id="line-803"></span><span id="stakeValidatorHashFromGovernor"><span class="annot"><span class="annottext">stakeValidatorHashFromGovernor :: Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#stakeValidatorHashFromGovernor"><span class="hs-identifier hs-var hs-var">stakeValidatorHashFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558391"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558391"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validator -&gt; ValidatorHash
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">validatorHash</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679558390"><span class="hs-identifier hs-var">validator</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-805"></span><span>    </span><span id="local-6989586621679558389"><span class="annot"><span class="annottext">params :: Stake
</span><a href="#local-6989586621679558389"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; Stake
</span><a href="Agora.Governor.Scripts.html#stakeFromGovernor"><span class="hs-identifier hs-var">stakeFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558391"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span id="local-6989586621679558390"><span class="annot"><span class="annottext">validator :: Validator
</span><a href="#local-6989586621679558390"><span class="hs-identifier hs-var hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PValidator -&gt; Validator
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkValidator</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PValidator -&gt; Validator)
-&gt; ClosedTerm PValidator -&gt; Validator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stake -&gt; ClosedTerm PValidator
</span><a href="Agora.Stake.Scripts.html#stakeValidator"><span class="hs-identifier hs-var">stakeValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679558389"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span class="hs-comment">{- | Get the 'Proposal' parameter, given the 'Governor' parameter.

     @since 0.1.0
-}</span><span>
</span><span id="line-812"></span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalFromGovernor"><span class="hs-identifier hs-type">proposalFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier hs-type">Proposal</span></a></span><span>
</span><span id="line-813"></span><span id="proposalFromGovernor"><span class="annot"><span class="annottext">proposalFromGovernor :: Governor -&gt; Proposal
</span><a href="Agora.Governor.Scripts.html#proposalFromGovernor"><span class="hs-identifier hs-var hs-var">proposalFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558388"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558388"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; AssetClass -&gt; Integer -&gt; Proposal
</span><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier hs-var">Proposal</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679558386"><span class="hs-identifier hs-var">gstAC</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679558385"><span class="hs-identifier hs-var">sstAC</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679558384"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-815"></span><span>    </span><span id="local-6989586621679558386"><span class="annot"><span class="annottext">gstAC :: AssetClass
</span><a href="#local-6989586621679558386"><span class="hs-identifier hs-var hs-var">gstAC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier hs-var">governorSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558388"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-816"></span><span>    </span><span id="local-6989586621679558384"><span class="annot"><span class="annottext">mc :: Integer
</span><a href="#local-6989586621679558384"><span class="hs-identifier hs-var hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558388"><span class="hs-identifier hs-var">gov</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maximumCosigners</span><span>
</span><span id="line-817"></span><span>    </span><span id="local-6989586621679558385"><span class="annot"><span class="annottext">sstAC :: AssetClass
</span><a href="#local-6989586621679558385"><span class="hs-identifier hs-var hs-var">sstAC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#stakeSTAssetClassFromGovernor"><span class="hs-identifier hs-var">stakeSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558388"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="hs-comment">{- | Get the hash of 'Agora.Proposal.proposalPolicy'.

     @since 0.1.0
-}</span><span>
</span><span id="line-823"></span><span class="annot"><a href="Agora.Governor.Scripts.html#proposalValidatorHashFromGovernor"><span class="hs-identifier hs-type">proposalValidatorHashFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">ValidatorHash</span></a></span><span>
</span><span id="line-824"></span><span id="proposalValidatorHashFromGovernor"><span class="annot"><span class="annottext">proposalValidatorHashFromGovernor :: Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#proposalValidatorHashFromGovernor"><span class="hs-identifier hs-var hs-var">proposalValidatorHashFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558383"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558383"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validator -&gt; ValidatorHash
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">validatorHash</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679558382"><span class="hs-identifier hs-var">validator</span></a></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-826"></span><span>    </span><span id="local-6989586621679558381"><span class="annot"><span class="annottext">params :: Proposal
</span><a href="#local-6989586621679558381"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; Proposal
</span><a href="Agora.Governor.Scripts.html#proposalFromGovernor"><span class="hs-identifier hs-var">proposalFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558383"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span id="local-6989586621679558382"><span class="annot"><span class="annottext">validator :: Validator
</span><a href="#local-6989586621679558382"><span class="hs-identifier hs-var hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PValidator -&gt; Validator
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkValidator</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PValidator -&gt; Validator)
-&gt; ClosedTerm PValidator -&gt; Validator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal -&gt; ClosedTerm PValidator
</span><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier hs-var">proposalValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679558381"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="hs-comment">{- | Get the hash of 'Agora.Proposal.proposalValidator'.

     @since 0.1.0
-}</span><span>
</span><span id="line-833"></span><span class="annot"><a href="Agora.Governor.Scripts.html#governorValidatorHash"><span class="hs-identifier hs-type">governorValidatorHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">ValidatorHash</span></a></span><span>
</span><span id="line-834"></span><span id="governorValidatorHash"><span class="annot"><span class="annottext">governorValidatorHash :: Governor -&gt; ValidatorHash
</span><a href="Agora.Governor.Scripts.html#governorValidatorHash"><span class="hs-identifier hs-var hs-var">governorValidatorHash</span></a></span></span><span> </span><span id="local-6989586621679558380"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558380"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validator -&gt; ValidatorHash
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">validatorHash</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679558379"><span class="hs-identifier hs-var">validator</span></a></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-836"></span><span>    </span><span id="local-6989586621679558379"><span class="annot"><span class="annottext">validator :: Validator
</span><a href="#local-6989586621679558379"><span class="hs-identifier hs-var hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PValidator -&gt; Validator
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkValidator</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PValidator -&gt; Validator)
-&gt; ClosedTerm PValidator -&gt; Validator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Governor -&gt; ClosedTerm PValidator
</span><a href="Agora.Governor.Scripts.html#governorValidator"><span class="hs-identifier hs-var">governorValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558380"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-comment">{- | Get the 'AuthorityToken' parameter given the 'Governor' parameter.

     @since 0.1.0
-}</span><span>
</span><span id="line-842"></span><span class="annot"><a href="Agora.Governor.Scripts.html#authorityTokenFromGovernor"><span class="hs-identifier hs-type">authorityTokenFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agora.AuthorityToken.html#AuthorityToken"><span class="hs-identifier hs-type">AuthorityToken</span></a></span><span>
</span><span id="line-843"></span><span id="authorityTokenFromGovernor"><span class="annot"><span class="annottext">authorityTokenFromGovernor :: Governor -&gt; AuthorityToken
</span><a href="Agora.Governor.Scripts.html#authorityTokenFromGovernor"><span class="hs-identifier hs-var hs-var">authorityTokenFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558378"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558378"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; AuthorityToken
</span><a href="Agora.AuthorityToken.html#AuthorityToken"><span class="hs-identifier hs-var">AuthorityToken</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetClass -&gt; AuthorityToken) -&gt; AssetClass -&gt; AuthorityToken
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AssetClass
</span><a href="Agora.Governor.Scripts.html#governorSTAssetClassFromGovernor"><span class="hs-identifier hs-var">governorSTAssetClassFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558378"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-comment">{- | Get the 'CurrencySymbol' of the authority token.

     @since 0.1.0
-}</span><span>
</span><span id="line-849"></span><span class="annot"><a href="Agora.Governor.Scripts.html#authorityTokenSymbolFromGovernor"><span class="hs-identifier hs-type">authorityTokenSymbolFromGovernor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Governor.html#Governor"><span class="hs-identifier hs-type">Governor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-850"></span><span id="authorityTokenSymbolFromGovernor"><span class="annot"><span class="annottext">authorityTokenSymbolFromGovernor :: Governor -&gt; CurrencySymbol
</span><a href="Agora.Governor.Scripts.html#authorityTokenSymbolFromGovernor"><span class="hs-identifier hs-var hs-var">authorityTokenSymbolFromGovernor</span></a></span></span><span> </span><span id="local-6989586621679558376"><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558376"><span class="hs-identifier hs-var">gov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679558375"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-852"></span><span>    </span><span id="local-6989586621679558375"><span class="annot"><span class="annottext">policy :: MintingPolicy
</span><a href="#local-6989586621679558375"><span class="hs-identifier hs-var hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(ClosedTerm PMintingPolicy -&gt; MintingPolicy)
-&gt; ClosedTerm PMintingPolicy -&gt; MintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AuthorityToken -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.AuthorityToken.html#authorityTokenPolicy"><span class="hs-identifier hs-var">authorityTokenPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">AuthorityToken
</span><a href="#local-6989586621679558374"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-853"></span><span>    </span><span id="local-6989586621679558374"><span class="annot"><span class="annottext">params :: AuthorityToken
</span><a href="#local-6989586621679558374"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Governor -&gt; AuthorityToken
</span><a href="Agora.Governor.Scripts.html#authorityTokenFromGovernor"><span class="hs-identifier hs-var">authorityTokenFromGovernor</span></a></span><span> </span><span class="annot"><span class="annottext">Governor
</span><a href="#local-6989586621679558376"><span class="hs-identifier hs-var">gov</span></a></span><span>
</span><span id="line-854"></span></pre></body></html>