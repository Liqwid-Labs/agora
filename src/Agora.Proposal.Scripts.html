<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Module     : Agora.Proposal.Scripts
Maintainer : emi@haskell.fyi
Description: Plutus Scripts for Proposals.

Plutus Scripts for Proposals.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agora.Proposal.Scripts</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-9"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier">proposalValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier">proposalPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.html"><span class="hs-identifier">Agora.Proposal</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier">PProposalDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier">PProposalDatum</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalRedeemer"><span class="hs-identifier">PProposalRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalStatus"><span class="hs-identifier">PProposalStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalVotes"><span class="hs-identifier">PProposalVotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalVotes"><span class="hs-identifier">PProposalVotes</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier">Proposal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#governorSTAssetClass"><span class="hs-identifier">governorSTAssetClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#stakeSTAssetClass"><span class="hs-identifier">stakeSTAssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#ProposalStatus"><span class="hs-identifier">ProposalStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#pretractVotes"><span class="hs-identifier">pretractVotes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.Time.html"><span class="hs-identifier">Agora.Proposal.Time</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Time.html#currentProposalTime"><span class="hs-identifier">currentProposalTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Time.html#isDraftPeriod"><span class="hs-identifier">isDraftPeriod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Time.html#isExecutionPeriod"><span class="hs-identifier">isExecutionPeriod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Time.html#isLockingPeriod"><span class="hs-identifier">isLockingPeriod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Time.html#isVotingPeriod"><span class="hs-identifier">isVotingPeriod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Stake.html"><span class="hs-identifier">Agora.Stake</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier">PProposalLock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier">PStakeDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PStakeUsage"><span class="hs-identifier">PStakeUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#findStakeOwnedBy"><span class="hs-identifier">findStakeOwnedBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#pgetStakeUsage"><span class="hs-identifier">pgetStakeUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Utils.html"><span class="hs-identifier">Agora.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#getMintingPolicySymbol"><span class="hs-identifier">getMintingPolicySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier">mustBePJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier">mustFindDatum'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptContext</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMinting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PSpending</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClassValueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.ScriptContext</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pfindTxInByTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisTokenSpent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">ptxSignedBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pvalueSpent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-string">&quot;liqwid-plutarch-extra&quot;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">psymbolValueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Comonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pextract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisUniqBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">plookup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pupdate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Record</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">mkRecordConstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator">(.&amp;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.TermCont</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pguardC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pletC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pletFieldsC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pmatchC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">ptryFromC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">Plutarch.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">PDiscrete</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PlutusLedgerApi.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">{- | Policy for Proposals.

   == What this policy does

   === For minting:

   - Governor is happy with mint.

     * The governor must do most of the checking for the validity of the
       transaction. For example, the governor must check that the datum
       is correct, and that the ST is correctly paid to the right validator.

   - Exactly 1 token is minted.

   === For burning:

   - This policy cannot be burned.
-}</span><span>
</span><span id="line-89"></span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-type">proposalPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- | The assetclass of GST, see 'Agora.Governor.Scripts.governorPolicy'.</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMintingPolicy</span></a></span><span>
</span><span id="line-93"></span><span id="proposalPolicy"><span class="annot"><span class="annottext">proposalPolicy :: AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-var hs-var">proposalPolicy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679547114"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679547114"><span class="hs-identifier hs-var">govCs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679547113"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679547113"><span class="hs-identifier hs-var">govTn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PMintingPolicy)
-&gt; (Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679547111"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679547111"><span class="hs-identifier hs-var">_redeemer</span></a></span></span><span> </span><span id="local-6989586621679547110"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679547110"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PScriptContext</span></a></span><span> </span><span id="local-6989586621679547108"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679547108"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext -&gt; TermCont @POpaque s (PScriptContext s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679547110"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679547107"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547107"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
       ((':)
          @(Symbol, Type)
          '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
          ('[] @(Symbol, Type))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
           ((':)
              @(Symbol, Type)
              '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
        ((':)
           @(Symbol, Type)
           '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
           ('[] @(Symbol, Type))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
            ((':)
               @(Symbol, Type)
               '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
          ((':)
             @(Symbol, Type)
             '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
             ('[] @(Symbol, Type))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
           ((':)
              @(Symbol, Type)
              '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679547108"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxInfo</span></a></span><span> </span><span id="local-6989586621679547104"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue 'Sorted 'Positive)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue 'Sorted 'NoGuarantees)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679547104"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (PTxInfo s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; TermCont @POpaque s (PTxInfo s))
-&gt; Term s PTxInfo -&gt; TermCont @POpaque s (PTxInfo s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547107"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679547102"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547102"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
       ((':)
          @(Symbol, Type)
          '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
          ('[] @(Symbol, Type))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ('[] @(Symbol, Type))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
            ((':)
               @(Symbol, Type)
               '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
          ((':)
             @(Symbol, Type)
             '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
             ('[] @(Symbol, Type))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue 'Sorted 'Positive)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue 'Sorted 'NoGuarantees)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679547104"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679547101"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679547101"><span class="hs-identifier hs-var">_ownSymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547107"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679547100"><span class="annot"><span class="annottext">inputs :: Term s (PBuiltinList (PAsData PTxInInfo))
</span><a href="#local-6989586621679547100"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547102"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621679547099"><span class="annot"><span class="annottext">mintedValue :: Term s (PValue 'Sorted 'NoGuarantees)
</span><a href="#local-6989586621679547099"><span class="hs-identifier hs-var hs-var">mintedValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PValue 'Sorted 'NoGuarantees))
-&gt; Term s (PValue 'Sorted 'NoGuarantees)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547102"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679547098"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679547098"><span class="hs-identifier hs-var">ownSymbol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679547107"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679547097"><span class="annot"><span class="annottext">mintedProposalST :: Term s (PInteger @S)
</span><a href="#local-6989586621679547097"><span class="hs-identifier hs-var hs-var">mintedProposalST</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">Term
  s
  (PValue 'Sorted 'NoGuarantees :--&gt; (PAssetClass :--&gt; PInteger @S))
forall (s :: S) (keys :: KeyGuarantees)
       (amounts :: AmountGuarantees).
Term s (PValue keys amounts :--&gt; (PAssetClass :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClassValueOf</span></a></span><span class="hs-cpp">
            # mintedValue
</span><span class="hs-cpp">            # (passetClass # (pfield @&quot;_0&quot; # ownSymbol') # pconstant &quot;&quot;)
</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Governance state-thread token must move&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
forall {s :: S}.
Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisTokenSpent</span></a></span><span class="hs-cpp">
        # (passetClass # pconstant govCs # pconstant govTn)
</span><span class="hs-cpp">        # inputs
</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Minted exactly one proposal ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679547097"><span class="hs-identifier hs-var">mintedProposalST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">{- | The validator for Proposals.

The documentation for various of the redeemers lives at 'Agora.Proposal.ProposalRedeemer'.

== What this validator does

=== Voting/unlocking

When voting and unlocking, the proposal must witness a state transition
occuring in the relevant Stake. This transition must place a lock on
the stake that is tagged with the right 'Agora.Proposal.ResultTag', and 'Agora.Proposal.ProposalId'.

=== Periods

Most redeemers are time-sensitive.

A list of all time-sensitive redeemers and their requirements:

- 'Agora.Proposal.Vote' can only be used when both the status is in 'Agora.Proposal.VotingReady',
  and 'Agora.Proposal.Time.isVotingPeriod' is true.
- 'Agora.Proposal.Cosign' can only be used when both the status is in 'Agora.Proposal.Draft',
  and 'Agora.Proposal.Time.isDraftPeriod' is true.
- 'Agora.Proposal.AdvanceProposal' can only be used when the status can be advanced
  (see 'Agora.Proposal.AdvanceProposal' docs).
- 'Agora.Proposal.Unlock' is always valid.
-}</span><span>
</span><span id="line-146"></span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier hs-type">proposalValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier hs-type">Proposal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidator</span></a></span><span>
</span><span id="line-147"></span><span id="proposalValidator"><span class="annot"><span class="annottext">proposalValidator :: Proposal -&gt; ClosedTerm PValidator
</span><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier hs-var hs-var">proposalValidator</span></a></span></span><span> </span><span id="local-6989586621679545916"><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679545916"><span class="hs-identifier hs-var">proposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData
 -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData
  -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PValidator)
-&gt; (Term s PData
    -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679545915"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679545915"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679545914"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679545914"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span id="local-6989586621679545913"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679545913"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PScriptContext</span></a></span><span> </span><span id="local-6989586621679545912"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679545912"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext -&gt; TermCont @POpaque s (PScriptContext s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679545913"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679545911"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679545911"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
       ((':)
          @(Symbol, Type)
          '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
          ('[] @(Symbol, Type))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
           ((':)
              @(Symbol, Type)
              '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
        ((':)
           @(Symbol, Type)
           '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
           ('[] @(Symbol, Type))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
            ((':)
               @(Symbol, Type)
               '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
          ((':)
             @(Symbol, Type)
             '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
             ('[] @(Symbol, Type))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
           ((':)
              @(Symbol, Type)
              '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679545912"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679545910"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679545910"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo))
-&gt; Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679545911"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxInfo</span></a></span><span> </span><span id="local-6989586621679545909"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue 'Sorted 'Positive)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue 'Sorted 'NoGuarantees)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679545909"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (PTxInfo s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679545910"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679545908"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
       ((':)
          @(Symbol, Type)
          '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
          ((':)
             @(Symbol, Type)
             '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
             ((':)
                @(Symbol, Type)
                '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                ((':)
                   @(Symbol, Type)
                   '(&quot;signatories&quot;,
                     Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;datums&quot;,
                        Term
                          s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                      ('[] @(Symbol, Type))))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;signatories&quot;,
                         Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;datums&quot;,
                            Term
                              s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                          ('[] @(Symbol, Type)))))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
        ((':)
           @(Symbol, Type)
           '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
           ((':)
              @(Symbol, Type)
              '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
              ((':)
                 @(Symbol, Type)
                 '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;signatories&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;datums&quot;,
                         Term
                           s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                       ('[] @(Symbol, Type))))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
            ((':)
               @(Symbol, Type)
               '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
               ((':)
                  @(Symbol, Type)
                  '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                     ((':)
                        @(Symbol, Type)
                        '(&quot;signatories&quot;,
                          Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                        ((':)
                           @(Symbol, Type)
                           '(&quot;datums&quot;,
                             Term
                               s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                           ('[] @(Symbol, Type))))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
          ((':)
             @(Symbol, Type)
             '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
             ((':)
                @(Symbol, Type)
                '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                ((':)
                   @(Symbol, Type)
                   '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;signatories&quot;,
                        Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                      ((':)
                         @(Symbol, Type)
                         '(&quot;datums&quot;,
                           Term
                             s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                         ('[] @(Symbol, Type))))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;signatories&quot;,
                         Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;datums&quot;,
                            Term
                              s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                          ('[] @(Symbol, Type)))))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span>
</span><span id="line-156"></span><span>          </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;signatories&quot;</span></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;validRange&quot;</span></span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>          </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue 'Sorted 'Positive)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue 'Sorted 'NoGuarantees)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679545909"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PSpending</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679545907"><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679545907"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679545911"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PJust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679545905"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679545905"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe PTxInInfo)
-&gt; TermCont @POpaque s (PMaybe PTxInInfo s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMaybe PTxInInfo)
 -&gt; TermCont @POpaque s (PMaybe PTxInInfo s))
-&gt; Term s (PMaybe PTxInInfo)
-&gt; TermCont @POpaque s (PMaybe PTxInInfo s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
forall (s :: S).
Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pfindTxInByTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
-&gt; Term s PTxOutRef
-&gt; Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679545907"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679545904"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679545904"><span class="hs-identifier hs-var">txOutF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; (HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PTxOut)
-&gt; (HRec
      (BoundTerms
         (PFields (PAsData PTxOut))
         (Bindings
            (PFields (PAsData PTxOut))
            ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679545905"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalDatum) -&gt; Term s PProposalDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679545903"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545903"><span class="hs-identifier hs-var">proposalDatum</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><span class="annottext">forall (b :: PType) (r :: PType) (a :: PType) (s :: S).
PTryFrom a b =&gt;
Term s a
-&gt; TermCont @r s (Term s b, Reduce @Type (PTryFromExcess a b s))
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">ptryFromC</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679545915"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalRedeemer) -&gt; Term s PProposalRedeemer
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679545902"><span class="annot"><span class="annottext">Term s PProposalRedeemer
</span><a href="#local-6989586621679545902"><span class="hs-identifier hs-var">proposalRedeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduce @Type (PTryFromExcess PData (PAsData PProposalRedeemer) s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">forall (b :: PType) (r :: PType) (a :: PType) (s :: S).
PTryFrom a b =&gt;
Term s a
-&gt; TermCont @r s (Term s b, Reduce @Type (PTryFromExcess a b s))
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">ptryFromC</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Proposal.html#PProposalRedeemer"><span class="hs-identifier hs-type">PProposalRedeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679545914"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679545901"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
       ((':)
          @(Symbol, Type)
          '(&quot;effects&quot;,
            Term
              s
              (PAsData
                 (PMap
                    'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
          ((':)
             @(Symbol, Type)
             '(&quot;status&quot;, Term s (PAsData PProposalStatus))
             ((':)
                @(Symbol, Type)
                '(&quot;cosigners&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                ((':)
                   @(Symbol, Type)
                   '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                      ((':)
                         @(Symbol, Type)
                         '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                         ((':)
                            @(Symbol, Type)
                            '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                            ('[] @(Symbol, Type))))))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;cosigners&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                             ((':)
                                @(Symbol, Type)
                                '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                ('[] @(Symbol, Type)))))))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
        ((':)
           @(Symbol, Type)
           '(&quot;effects&quot;,
             Term
               s
               (PAsData
                  (PMap
                     'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;status&quot;, Term s (PAsData PProposalStatus))
              ((':)
                 @(Symbol, Type)
                 '(&quot;cosigners&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                             ('[] @(Symbol, Type))))))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
            ((':)
               @(Symbol, Type)
               '(&quot;effects&quot;,
                 Term
                   s
                   (PAsData
                      (PMap
                         'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
               ((':)
                  @(Symbol, Type)
                  '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;cosigners&quot;,
                       Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                     ((':)
                        @(Symbol, Type)
                        '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                        ((':)
                           @(Symbol, Type)
                           '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                           ((':)
                              @(Symbol, Type)
                              '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                              ((':)
                                 @(Symbol, Type)
                                 '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                 ('[] @(Symbol, Type))))))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
          ((':)
             @(Symbol, Type)
             '(&quot;effects&quot;,
               Term
                 s
                 (PAsData
                    (PMap
                       'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
             ((':)
                @(Symbol, Type)
                '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                ((':)
                   @(Symbol, Type)
                   '(&quot;cosigners&quot;,
                     Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                      ((':)
                         @(Symbol, Type)
                         '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                         ((':)
                            @(Symbol, Type)
                            '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                            ((':)
                               @(Symbol, Type)
                               '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                               ('[] @(Symbol, Type))))))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
           ((':)
              @(Symbol, Type)
              '(&quot;effects&quot;,
                Term
                  s
                  (PAsData
                     (PMap
                        'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;status&quot;, Term s (PAsData PProposalStatus))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;cosigners&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                          ((':)
                             @(Symbol, Type)
                             '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                             ((':)
                                @(Symbol, Type)
                                '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                                ('[] @(Symbol, Type)))))))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalId&quot;</span></span><span>
</span><span id="line-178"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;effects&quot;</span></span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;status&quot;</span></span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cosigners&quot;</span></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;thresholds&quot;</span></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;votes&quot;</span></span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;timingConfig&quot;</span></span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;startingTime&quot;</span></span><span>
</span><span id="line-185"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545903"><span class="hs-identifier hs-var">proposalDatum</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679545900"><span class="annot"><span class="annottext">Term s (PAsData PAddress)
</span><a href="#local-6989586621679545900"><span class="hs-identifier hs-var">ownAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PAddress)
-&gt; TermCont @POpaque s (Term s (PAsData PAddress))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PAddress)
 -&gt; TermCont @POpaque s (Term s (PAsData PAddress)))
-&gt; Term s (PAsData PAddress)
-&gt; TermCont @POpaque s (Term s (PAsData PAddress))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;value&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679545904"><span class="hs-identifier hs-var">txOutF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545899"><span class="annot"><span class="annottext">stCurrencySymbol :: Term s PCurrencySymbol
</span><a href="#local-6989586621679545899"><span class="hs-identifier hs-var hs-var">stCurrencySymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>          </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol)
-&gt; PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; CurrencySymbol
</span><a href="Agora.Utils.html#getMintingPolicySymbol"><span class="hs-identifier hs-var">getMintingPolicySymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-var">proposalPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679545916"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">governorSTAssetClass</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679545897"><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679545897"><span class="hs-identifier hs-var">valueSpent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PValue 'Sorted 'Positive)
 -&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive)))
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
forall (s :: S).
Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679545896"><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
</span><a href="#local-6989586621679545896"><span class="hs-identifier hs-var">signedBy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; TermCont @POpaque s (Term s (PAsData PPubKeyHash :--&gt; PBool))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PPubKeyHash :--&gt; PBool)
 -&gt; TermCont @POpaque s (Term s (PAsData PPubKeyHash :--&gt; PBool)))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; TermCont @POpaque s (Term s (PAsData PPubKeyHash :--&gt; PBool))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">signatories</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679545895"><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime -&gt; TermCont @POpaque s (Term s PProposalTime)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalTime
 -&gt; TermCont @POpaque s (Term s PProposalTime))
-&gt; Term s PProposalTime
-&gt; TermCont @POpaque s (Term s PProposalTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PPOSIXTimeRange :--&gt; PProposalTime)
forall (s :: S). Term s (PPOSIXTimeRange :--&gt; PProposalTime)
</span><a href="Agora.Proposal.Time.html#currentProposalTime"><span class="hs-identifier hs-var">currentProposalTime</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PPOSIXTimeRange :--&gt; PProposalTime)
-&gt; Term s PPOSIXTimeRange -&gt; Term s PProposalTime
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">validRange</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- Own output is an output that</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">--  * is sent to the address of the proposal validator</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">--  * has an PST</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">--  * has the same proposal id as the proposal input</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- We match the proposal id here so that we can support multiple</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">--  proposal inputs in one thansaction.</span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679545894"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679545894"><span class="hs-identifier hs-var">ownOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; TermCont @POpaque s (Term s (PAsData PTxOut)))
-&gt; Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Own output should be present&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
-&gt; Term s (PMaybe (PAsData PTxOut)) -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxOut :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxOut) :--&gt; PMaybe (PAsData PTxOut)))
forall (l :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike l a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (l a :--&gt; PMaybe a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfind</span></a></span><span class="hs-cpp">
          # plam
</span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">input</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>                </span><span class="hs-identifier">inputF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;datumHash&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">input</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>                </span><span class="hs-comment">-- TODO: this is highly inefficient: O(n) for every output,</span><span>
</span><span id="line-213"></span><span>                </span><span class="hs-comment">--       Maybe we can cache the sorted datum map?</span><span>
</span><span id="line-214"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">datum</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-215"></span><span>                      </span><span class="hs-identifier">mustFindDatum'</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier">PProposalDatum</span><span class="hs-cpp">
                        # inputF.datumHash
</span><span class="hs-cpp">                        # txInfoF.datums
</span><span>
</span><span id="line-219"></span><span>                    </span><span class="hs-identifier">proposalId</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;proposalId&quot;</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">datum</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>                </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-222"></span><span>                  </span><span class="hs-identifier">inputF</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">ownAddress</span><span class="hs-cpp">
                    #&amp;&amp; psymbolValueOf # stCurrencySymbol # inputF.value #== 1
</span><span class="hs-cpp">                    #&amp;&amp; proposalId #== proposalF.proposalId
</span><span>            </span><span class="hs-special">)</span><span class="hs-cpp">
          # pfromData txInfoF.outputs
</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679545886"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PProposalDatum
 -&gt; TermCont @POpaque s (Term s PProposalDatum))
-&gt; Term s PProposalDatum
-&gt; TermCont @POpaque s (Term s PProposalDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-cpp">
          # (pfield @&quot;datumHash&quot; # ownOutput)
</span><span class="hs-cpp">          # txInfoF.datums
</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679545885"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545885"><span class="hs-identifier hs-var">proposalUnchanged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545903"><span class="hs-identifier hs-var">proposalDatum</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- Find the stake input and stake output by SST.</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679545884"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679545884"><span class="hs-identifier hs-var">stakeSym</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679545883"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679545883"><span class="hs-identifier hs-var">stakeTn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679545916"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakeSTAssetClass</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679545882"><span class="annot"><span class="annottext">Term s PAssetClass
</span><a href="#local-6989586621679545882"><span class="hs-identifier hs-var">stakeSTAssetClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">Term s PAssetClass -&gt; TermCont @POpaque s (Term s PAssetClass)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PAssetClass -&gt; TermCont @POpaque s (Term s PAssetClass))
-&gt; Term s PAssetClass -&gt; TermCont @POpaque s (Term s PAssetClass)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClass</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTokenName :--&gt; PAssetClass)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679545884"><span class="hs-identifier hs-var">stakeSym</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTokenName :--&gt; PAssetClass)
-&gt; Term s PTokenName -&gt; Term s PAssetClass
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName -&gt; Term s PTokenName
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName
TokenName
</span><a href="#local-6989586621679545883"><span class="hs-identifier hs-var">stakeTn</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679545881"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679545881"><span class="hs-identifier hs-var">spentStakeST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PValue 'Sorted 'Positive :--&gt; (PAssetClass :--&gt; PInteger @S))
forall (s :: S) (keys :: KeyGuarantees)
       (amounts :: AmountGuarantees).
Term s (PValue keys amounts :--&gt; (PAssetClass :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClassValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PValue 'Sorted 'Positive :--&gt; (PAssetClass :--&gt; PInteger @S))
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PAssetClass :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679545897"><span class="hs-identifier hs-var">valueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAssetClass :--&gt; PInteger @S)
-&gt; Term s PAssetClass -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PAssetClass
</span><a href="#local-6989586621679545882"><span class="hs-identifier hs-var">stakeSTAssetClass</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545880"><span class="annot"><span class="annottext">stakeInput :: Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;resolved&quot; (PFields (PAsData PTxInInfo)))
           (PFields (PAsData PTxInInfo)))))
</span><a href="#local-6989586621679545880"><span class="hs-identifier hs-var hs-var">stakeInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span class="hs-cpp">
            #$ mustBePJust
</span><span class="hs-cpp">            # &quot;Stake input should be present&quot;
</span><span class="hs-cpp">              #$ pfind
</span><span class="hs-cpp">            # plam
</span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;resolved&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-251"></span><span>                  </span><span class="hs-identifier">passetClassValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">stakeSTAssetClass</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-special">)</span><span class="hs-cpp">
            # pfromData txInfoF.inputs
</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679545877"><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545877"><span class="hs-identifier hs-var">stakeIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum))
-&gt; Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PStakeDatum))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;resolved&quot; (PFields (PAsData PTxInInfo)))
           (PFields (PAsData PTxInInfo))))
   :--&gt; PMaybeData PDatumHash)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;resolved&quot; (PFields (PAsData PTxInInfo)))
              (PFields (PAsData PTxInInfo)))))
-&gt; Term s (PMaybeData PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;resolved&quot; (PFields (PAsData PTxInInfo)))
           (PFields (PAsData PTxInInfo)))))
</span><a href="#local-6989586621679545880"><span class="hs-identifier hs-var">stakeInput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PStakeDatum)
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s PStakeDatum
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679545876"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; TermCont @b s (HRec (BoundTerms ps bs s))
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletFieldsC</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545877"><span class="hs-identifier hs-var">stakeIn</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545875"><span class="annot"><span class="annottext">stakeOutput :: Term s (PAsData PTxOut)
</span><a href="#local-6989586621679545875"><span class="hs-identifier hs-var hs-var">stakeOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake output should be present&quot;</span></span><span class="hs-cpp">
            #$ pfind
</span><span class="hs-cpp">            # plam
</span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>                  </span><span class="hs-identifier">passetClassValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">stakeSTAssetClass</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-264"></span><span>              </span><span class="hs-special">)</span><span class="hs-cpp">
            # pfromData txInfoF.outputs
</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679545873"><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545873"><span class="hs-identifier hs-var">stakeOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum))
-&gt; Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PStakeDatum))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut :--&gt; PMaybeData PDatumHash)
-&gt; Term s (PAsData PTxOut) -&gt; Term s (PMaybeData PDatumHash)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679545875"><span class="hs-identifier hs-var">stakeOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PStakeDatum)
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s PStakeDatum
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;validRange&quot;, Term s (PAsData PPOSIXTimeRange))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679545908"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679545872"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545872"><span class="hs-identifier hs-var">stakeUnchanged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545877"><span class="hs-identifier hs-var">stakeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545873"><span class="hs-identifier hs-var">stakeOut</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="annottext">Term s PProposalRedeemer
-&gt; (PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalRedeemer
</span><a href="#local-6989586621679545902"><span class="hs-identifier hs-var">proposalRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><a href="Agora.Proposal.html#PVote"><span class="hs-identifier hs-type">PVote</span></a></span><span> </span><span id="local-6989586621679545869"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679545869"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Input proposal must be in VotingReady state&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s PProposalStatus -&gt; Term s PProposalStatus -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PProposalStatus -&gt; Term s PProposalStatus
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PProposalStatus
ProposalStatus
</span><a href="Agora.Proposal.html#VotingReady"><span class="hs-identifier hs-var">VotingReady</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal time should be wthin the voting period&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-280"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
forall (s :: S).
Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
</span><a href="Agora.Proposal.Time.html#isVotingPeriod"><span class="hs-identifier hs-var">isVotingPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
-&gt; Term s PProposalTimingConfig
-&gt; Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
-&gt; Term s PProposalStartingTime
-&gt; Term s (PProposalTime :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalTime :--&gt; PBool)
-&gt; Term s PProposalTime -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>          </span><span class="hs-comment">-- Ensure the transaction is voting to a valid 'ResultTag'(outcome).</span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><a href="Agora.Proposal.html#PProposalVotes"><span class="hs-identifier hs-type">PProposalVotes</span></a></span><span> </span><span id="local-6989586621679545867"><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PResultTag (PInteger @S))
</span><a href="#local-6989586621679545867"><span class="hs-identifier hs-var">voteMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes -&gt; TermCont @POpaque s (PProposalVotes s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-284"></span><span>          </span><span id="local-6989586621679545866"><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545866"><span class="hs-identifier hs-var">voteFor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag))
-&gt; Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PResultTag) -&gt; Term s PResultTag
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PResultTag) -&gt; Term s PResultTag)
-&gt; Term s (PAsData PResultTag) -&gt; Term s PResultTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resultTag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType))
   :--&gt; PAsData PResultTag)
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
-&gt; Term s (PAsData PResultTag)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679545869"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Vote option should be valid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="annot"><span class="annottext">Term s (PMaybe (PInteger @S) :--&gt; PBool)
forall (a :: PType) (s :: S). Term s (PMaybe a :--&gt; PBool)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe (PInteger @S) :--&gt; PBool)
-&gt; Term s (PMaybe (PInteger @S)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PMap 'Unsorted PResultTag (PInteger @S)
         :--&gt; PMaybe (PInteger @S)))
forall (k :: PType) (v :: PType) (keys :: KeyGuarantees) (s :: S).
(PIsData v, PIsData k, PEq k) =&gt;
Term s (k :--&gt; (PMap keys k v :--&gt; PMaybe v))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">plookup</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PMap 'Unsorted PResultTag (PInteger @S)
         :--&gt; PMaybe (PInteger @S)))
-&gt; Term s PResultTag
-&gt; Term
     s
     (PMap 'Unsorted PResultTag (PInteger @S) :--&gt; PMaybe (PInteger @S))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545866"><span class="hs-identifier hs-var">voteFor</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMap 'Unsorted PResultTag (PInteger @S) :--&gt; PMaybe (PInteger @S))
-&gt; Term s (PMap 'Unsorted PResultTag (PInteger @S))
-&gt; Term s (PMaybe (PInteger @S))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PResultTag (PInteger @S))
</span><a href="#local-6989586621679545867"><span class="hs-identifier hs-var">voteMap</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-comment">-- Ensure that no lock with the current proposal id has been put on the stake.</span><span>
</span><span id="line-290"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Same stake shouldn't vote on the same proposal twice&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PProposalLock :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PProposalLock) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pany</span></a></span><span class="hs-cpp">
              # plam
</span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;proposalTag&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pid</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>                    </span><span class="hs-identifier">pid</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-special">)</span><span class="hs-cpp">
              # pfromData stakeInF.lockedBy
</span><span>
</span><span id="line-298"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- The amount of new votes should be the 'stakedAmount'.</span><span>
</span><span id="line-299"></span><span>              </span><span class="hs-comment">-- Update the vote counter of the proposal, and leave other stuff as is.</span><span>
</span><span id="line-300"></span><span>              </span><span id="local-6989586621679545862"><span class="annot"><span class="annottext">expectedNewVotes :: Term s PProposalVotes
</span><a href="#local-6989586621679545862"><span class="hs-identifier hs-var hs-var">expectedNewVotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes
-&gt; (PProposalVotes s -&gt; Term s PProposalVotes)
-&gt; Term s PProposalVotes
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalVotes) -&gt; Term s PProposalVotes
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PProposalVotes s -&gt; Term s PProposalVotes)
 -&gt; Term s PProposalVotes)
-&gt; (PProposalVotes s -&gt; Term s PProposalVotes)
-&gt; Term s PProposalVotes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalVotes"><span class="hs-identifier hs-type">PProposalVotes</span></a></span><span> </span><span id="local-6989586621679545861"><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PResultTag (PInteger @S))
</span><a href="#local-6989586621679545861"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>                </span><span class="annot"><span class="annottext">PProposalVotes s -&gt; Term s PProposalVotes
forall (a :: PType) (s :: S). PCon a =&gt; a s -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pcon</span></a></span><span> </span><span class="annot"><span class="annottext">(PProposalVotes s -&gt; Term s PProposalVotes)
-&gt; PProposalVotes s -&gt; Term s PProposalVotes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-302"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PMap 'Unsorted PResultTag (PInteger @S))
-&gt; PProposalVotes s
forall (s :: S).
Term s (PMap 'Unsorted PResultTag (PInteger @S))
-&gt; PProposalVotes s
</span><a href="Agora.Proposal.html#PProposalVotes"><span class="hs-identifier hs-var">PProposalVotes</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMap 'Unsorted PResultTag (PInteger @S))
 -&gt; PProposalVotes s)
-&gt; Term s (PMap 'Unsorted PResultTag (PInteger @S))
-&gt; PProposalVotes s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-303"></span><span>                    </span><span class="annot"><span class="annottext">Term
  s
  ((PInteger @S :--&gt; PMaybe (PInteger @S))
   :--&gt; (PResultTag
         :--&gt; (PMap 'Unsorted PResultTag (PInteger @S)
               :--&gt; PMap 'Unsorted PResultTag (PInteger @S))))
forall (k :: PType) (v :: PType) (keys :: KeyGuarantees) (s :: S).
(PIsData k, PIsData v) =&gt;
Term
  s
  ((v :--&gt; PMaybe v)
   :--&gt; (k :--&gt; (PMap keys k v :--&gt; PMap keys k v)))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pupdate</span></a></span><span class="hs-cpp">
                      # plam
</span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">votes</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>                            </span><span class="hs-identifier">PDiscrete</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">pmatchC</span><span> </span><span class="hs-identifier">stakeInF</span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-307"></span><span>                            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">PJust</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">votes</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pextract</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>                        </span><span class="hs-special">)</span><span class="hs-cpp">
                      # voteFor
</span><span class="hs-cpp">                      # m
</span><span>              </span><span id="local-6989586621679545855"><span class="annot"><span class="annottext">expectedProposalOut :: Term s PProposalDatum
</span><a href="#local-6989586621679545855"><span class="hs-identifier hs-var hs-var">expectedProposalOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-312"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-313"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-314"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-315"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-316"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span>
</span><span id="line-317"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-318"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-319"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes -&gt; Term s (PAsData PProposalVotes)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes
</span><a href="#local-6989586621679545862"><span class="hs-identifier hs-var">expectedNewVotes</span></a></span><span>
</span><span id="line-320"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span>
</span><span id="line-321"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span>
</span><span id="line-322"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Output proposal should be valid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545855"><span class="hs-identifier hs-var">expectedProposalOut</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>          </span><span class="hs-comment">-- We validate the output stake datum here as well: We need the vote option</span><span>
</span><span id="line-327"></span><span>          </span><span class="hs-comment">-- to create a valid 'ProposalLock', however the vote option is encoded</span><span>
</span><span id="line-328"></span><span>          </span><span class="hs-comment">-- in the proposal redeemer, which is invisible for the stake validator.</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545853"><span class="annot"><span class="annottext">newProposalLock :: Term s PProposalLock
</span><a href="#local-6989586621679545853"><span class="hs-identifier hs-var hs-var">newProposalLock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;vote&quot; ':= PResultTag)
         ((':)
            @PLabeledType
            (&quot;proposalTag&quot; ':= PProposalId)
            ('[] @PLabeledType))))
 -&gt; PProposalLock s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
-&gt; Term s PProposalLock
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-332"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType
           (&quot;proposalTag&quot; ':= PProposalId)
           ('[] @PLabeledType))))
-&gt; PProposalLock s'
</span><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-var">PProposalLock</span></a></span><span>
</span><span id="line-333"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;vote&quot;
</span><span class="">#vote</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;vote&quot;
-&gt; Term s (PAsData PResultTag)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag -&gt; Term s (PAsData PResultTag)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545866"><span class="hs-identifier hs-var">voteFor</span></a></span><span>
</span><span id="line-334"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;vote&quot; ':= PResultTag)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;vote&quot; ':= PResultTag)
        ((':)
           @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTag&quot;
</span><span class="">#proposalTag</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalTag&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType (&quot;proposalTag&quot; ':= PProposalId) ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-335"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>              </span><span class="hs-comment">-- Prepend the new lock to existing locks</span><span>
</span><span id="line-337"></span><span>              </span><span id="local-6989586621679545851"><span class="annot"><span class="annottext">expectedProposalLocks :: Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679545851"><span class="hs-identifier hs-var hs-var">expectedProposalLocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-338"></span><span>                </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PProposalLock
   :--&gt; (PBuiltinList (PAsData PProposalLock)
         :--&gt; PBuiltinList (PAsData PProposalLock)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PListLike list, PElemConstraint list a) =&gt;
Term s (a :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pcons</span></a></span><span class="hs-cpp">
                  # pdata newProposalLock
</span><span class="hs-cpp">                  # pfromData stakeInF.lockedBy
</span><span>              </span><span id="local-6989586621679545849"><span class="annot"><span class="annottext">expectedStakeOut :: Term s PStakeDatum
</span><a href="#local-6989586621679545849"><span class="hs-identifier hs-var hs-var">expectedStakeOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-343"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-344"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-345"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-346"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679545851"><span class="hs-identifier hs-var">expectedProposalLocks</span></a></span><span>
</span><span id="line-347"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Output stake should be locked by the proposal&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545849"><span class="hs-identifier hs-var">expectedStakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545873"><span class="hs-identifier hs-var">stakeOut</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><a href="Agora.Proposal.html#PCosign"><span class="hs-identifier hs-type">PCosign</span></a></span><span> </span><span id="local-6989586621679545846"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679545846"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake should not change&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545872"><span class="hs-identifier hs-var">stakeUnchanged</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>          </span><span id="local-6989586621679545845"><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545845"><span class="hs-identifier hs-var">newSigs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; TermCont
     @POpaque s (Term s (PBuiltinList (PAsData PPubKeyHash)))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PBuiltinList (PAsData PPubKeyHash))
 -&gt; TermCont
      @POpaque s (Term s (PBuiltinList (PAsData PPubKeyHash))))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; TermCont
     @POpaque s (Term s (PBuiltinList (PAsData PPubKeyHash)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;newCosigners&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType))
   :--&gt; PBuiltinList (PAsData PPubKeyHash))
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ('[] @PLabeledType)))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679545846"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Cosigners are unique&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-359"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
   :--&gt; ((PAsData PPubKeyHash :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
         :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)))
forall (a :: PType) (s :: S) (list :: PType -&gt; PType).
(PIsListLike list a, PIsListLike list (list a)) =&gt;
Term
  s
  ((a :--&gt; (a :--&gt; PBool))
   :--&gt; ((a :--&gt; (a :--&gt; PBool)) :--&gt; (list a :--&gt; PBool)))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisUniqBy</span></a></span><span class="hs-cpp">
              # phoistAcyclic (plam (#==))
</span><span class="hs-cpp">              # phoistAcyclic (plam $ \(pfromData -&gt; x) (pfromData -&gt; y) -&gt; x #&lt; y)
</span><span class="hs-cpp">              # newSigs
</span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Signed by all new cosigners&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-365"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pall</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
</span><a href="#local-6989586621679545896"><span class="hs-identifier hs-var">signedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545845"><span class="hs-identifier hs-var">newSigs</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;As many new cosigners as Stake datums&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679545881"><span class="hs-identifier hs-var">spentStakeST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545845"><span class="hs-identifier hs-var">newSigs</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;All new cosigners are witnessed by their Stake datums&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pall</span></a></span><span class="hs-cpp">
              # plam
</span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">sig</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>                    </span><span class="hs-identifier">pmatch</span><span>
</span><span id="line-375"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">findStakeOwnedBy</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">stakeSTAssetClass</span><span class="hs-cpp">
                          # pfromData sig
</span><span class="hs-cpp">                          # txInfoF.datums
</span><span class="hs-cpp">                          # txInfoF.inputs
</span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>                      </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-381"></span><span>                        </span><span class="hs-identifier">PNothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PFalse</span><span>
</span><span id="line-382"></span><span>                        </span><span class="hs-identifier">PJust</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PTrue</span><span>
</span><span id="line-383"></span><span>                </span><span class="hs-special">)</span><span class="hs-cpp">
              # newSigs
</span><span>
</span><span id="line-386"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545821"><span class="annot"><span class="annottext">updatedSigs :: Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545821"><span class="hs-identifier hs-var hs-var">updatedSigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash)
         :--&gt; PBuiltinList (PAsData PPubKeyHash)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconcat</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash)
         :--&gt; PBuiltinList (PAsData PPubKeyHash)))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term
     s
     (PBuiltinList (PAsData PPubKeyHash)
      :--&gt; PBuiltinList (PAsData PPubKeyHash))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545845"><span class="hs-identifier hs-var">newSigs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-387"></span><span>              </span><span id="local-6989586621679545819"><span class="annot"><span class="annottext">expectedDatum :: Term s PProposalDatum
</span><a href="#local-6989586621679545819"><span class="hs-identifier hs-var hs-var">expectedDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-389"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-390"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-391"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-392"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span>
</span><span id="line-393"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679545821"><span class="hs-identifier hs-var">updatedSigs</span></a></span><span>
</span><span id="line-394"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-395"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-396"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span>
</span><span id="line-397"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span>
</span><span id="line-398"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Signatures are correctly added to cosignature list&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-401"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545819"><span class="hs-identifier hs-var">expectedDatum</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><a href="Agora.Proposal.html#PUnlock"><span class="hs-identifier hs-type">PUnlock</span></a></span><span> </span><span id="local-6989586621679545817"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679545817"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>          </span><span class="hs-comment">-- At draft stage, the votes should be empty.</span><span>
</span><span id="line-407"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Shouldn't retract votes from a draft proposal&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Draft"><span class="hs-identifier hs-var">Draft</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>          </span><span class="hs-comment">-- This is the vote option we're retracting from.</span><span>
</span><span id="line-411"></span><span>          </span><span id="local-6989586621679545814"><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545814"><span class="hs-identifier hs-var">retractFrom</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag))
-&gt; Term s PResultTag -&gt; TermCont @POpaque s (Term s PResultTag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resultTag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType))
   :--&gt; PResultTag)
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
-&gt; Term s PResultTag
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679545817"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>          </span><span class="hs-comment">-- Determine if the input stake is actually locked by this proposal.</span><span>
</span><span id="line-414"></span><span>          </span><span id="local-6989586621679545813"><span class="annot"><span class="annottext">Term s PStakeUsage
</span><a href="#local-6989586621679545813"><span class="hs-identifier hs-var">stakeUsage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PStakeUsage -&gt; TermCont @POpaque s (Term s PStakeUsage)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeUsage -&gt; TermCont @POpaque s (Term s PStakeUsage))
-&gt; Term s PStakeUsage -&gt; TermCont @POpaque s (Term s PStakeUsage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
forall {w :: S}.
Term
  w
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
</span><a href="Agora.Stake.html#pgetStakeUsage"><span class="hs-identifier hs-var">pgetStakeUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PProposalId :--&gt; PStakeUsage)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lockedBy</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalId :--&gt; PStakeUsage)
-&gt; Term s PProposalId -&gt; Term s PStakeUsage
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake input relevant&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">Term s PStakeUsage
-&gt; (PStakeUsage s -&gt; Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeUsage
</span><a href="#local-6989586621679545813"><span class="hs-identifier hs-var">stakeUsage</span></a></span><span> </span><span class="annot"><span class="annottext">((PStakeUsage s -&gt; Term s PBool) -&gt; Term s PBool)
-&gt; (PStakeUsage s -&gt; Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-418"></span><span>              </span><span class="annot"><span class="annottext">PStakeUsage s
</span><a href="Agora.Stake.html#PDidNothing"><span class="hs-identifier hs-var">PDidNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake should be relevant&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-420"></span><span>                  </span><span class="annot"><span class="annottext">PLifted PBool -&gt; Term s PBool
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
PLifted PBool
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-421"></span><span>              </span><span class="annot"><span class="annottext">PStakeUsage s
</span><a href="Agora.Stake.html#PCreated"><span class="hs-identifier hs-var">PCreated</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-422"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Removing creator's locks means status is Finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-423"></span><span>                  </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span>
</span><span id="line-424"></span><span>              </span><span class="annot"><a href="Agora.Stake.html#PVotedFor"><span class="hs-identifier hs-type">PVotedFor</span></a></span><span> </span><span id="local-6989586621679545807"><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545807"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Result tag should match the one given in the redeemer&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-426"></span><span>                  </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545807"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag -&gt; Term s PResultTag -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545814"><span class="hs-identifier hs-var">retractFrom</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-comment">-- The count of removing votes is equal to the 'stakeAmount' of input stake.</span><span>
</span><span id="line-429"></span><span>          </span><span id="local-6989586621679545806"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679545806"><span class="hs-identifier hs-var">retractCount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-431"></span><span>              </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; (PDiscrete @Type GTTag s -&gt; Term s (PInteger @S))
-&gt; Term s (PInteger @S)
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span> </span><span class="annot"><span class="annottext">((PDiscrete @Type GTTag s -&gt; Term s (PInteger @S))
 -&gt; Term s (PInteger @S))
-&gt; (PDiscrete @Type GTTag s -&gt; Term s (PInteger @S))
-&gt; Term s (PInteger @S)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier hs-type">PDiscrete</span></a></span><span> </span><span id="local-6989586621679545805"><span class="annot"><span class="annottext">Term s (PTagged @Type GTTag (PInteger @S))
</span><a href="#local-6989586621679545805"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s (PTagged @Type GTTag (PInteger @S) :--&gt; PInteger @S)
forall (w :: PType -&gt; PType) (a :: PType) (s :: S).
(PComonad w, PSubcategory w a) =&gt;
Term s (w a :--&gt; a)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pextract</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTagged @Type GTTag (PInteger @S) :--&gt; PInteger @S)
-&gt; Term s (PTagged @Type GTTag (PInteger @S))
-&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTagged @Type GTTag (PInteger @S))
</span><a href="#local-6989586621679545805"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-comment">-- The votes can only change when the proposal still allows voting.</span><span>
</span><span id="line-434"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545804"><span class="annot"><span class="annottext">shouldUpdateVotes :: Term s PBool
</span><a href="#local-6989586621679545804"><span class="hs-identifier hs-var hs-var">shouldUpdateVotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>                </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#VotingReady"><span class="hs-identifier hs-var">VotingReady</span></a></span><span class="hs-cpp">
                  #&amp;&amp; pnot # (pcon PCreated #== stakeUsage)
</span><span>
</span><span id="line-438"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal output correct&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-439"></span><span>            </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType).
Term s PBool -&gt; Term s a -&gt; Term s a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pif</span></a></span><span>
</span><span id="line-440"></span><span>              </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545804"><span class="hs-identifier hs-var">shouldUpdateVotes</span></a></span><span>
</span><span id="line-441"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Remove votes and leave other parts of the proposal as it.</span><span>
</span><span id="line-442"></span><span>                    </span><span id="local-6989586621679545802"><span class="annot"><span class="annottext">expectedVotes :: Term s PProposalVotes
</span><a href="#local-6989586621679545802"><span class="hs-identifier hs-var hs-var">expectedVotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PInteger @S :--&gt; (PProposalVotes :--&gt; PProposalVotes)))
forall (s :: S).
Term
  s
  (PResultTag
   :--&gt; (PInteger @S :--&gt; (PProposalVotes :--&gt; PProposalVotes)))
</span><a href="Agora.Proposal.html#pretractVotes"><span class="hs-identifier hs-var">pretractVotes</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PResultTag
   :--&gt; (PInteger @S :--&gt; (PProposalVotes :--&gt; PProposalVotes)))
-&gt; Term s PResultTag
-&gt; Term s (PInteger @S :--&gt; (PProposalVotes :--&gt; PProposalVotes))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PResultTag
</span><a href="#local-6989586621679545814"><span class="hs-identifier hs-var">retractFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S :--&gt; (PProposalVotes :--&gt; PProposalVotes))
-&gt; Term s (PInteger @S)
-&gt; Term s (PProposalVotes :--&gt; PProposalVotes)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679545806"><span class="hs-identifier hs-var">retractCount</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PProposalVotes :--&gt; PProposalVotes)
-&gt; Term s PProposalVotes -&gt; Term s PProposalVotes
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>                    </span><span id="local-6989586621679545801"><span class="annot"><span class="annottext">expectedProposalOut :: Term s PProposalDatum
</span><a href="#local-6989586621679545801"><span class="hs-identifier hs-var hs-var">expectedProposalOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-445"></span><span>                      </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-446"></span><span>                        </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-447"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-448"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-449"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span>
</span><span id="line-450"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-451"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-452"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes -&gt; Term s (PAsData PProposalVotes)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalVotes
</span><a href="#local-6989586621679545802"><span class="hs-identifier hs-var">expectedVotes</span></a></span><span>
</span><span id="line-453"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span>
</span><span id="line-454"></span><span>                            </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span>
</span><span id="line-455"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Update votes&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-457"></span><span>                      </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545801"><span class="hs-identifier hs-var">expectedProposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span>
</span><span id="line-458"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>              </span><span class="hs-comment">-- No change to the proposal is allowed.</span><span>
</span><span id="line-460"></span><span>              </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal unchanged&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545885"><span class="hs-identifier hs-var">proposalUnchanged</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>          </span><span class="hs-comment">-- At last, we ensure that all locks belong to this proposal will be removed.</span><span>
</span><span id="line-463"></span><span>          </span><span id="local-6989586621679545800"><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
</span><a href="#local-6989586621679545800"><span class="hs-identifier hs-var">stakeOutputLocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
 -&gt; TermCont
      @POpaque
      s
      (Term s (PAsData (PBuiltinList (PAsData PProposalLock)))))
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s (PStakeDatum :--&gt; PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; Term s PStakeDatum
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545873"><span class="hs-identifier hs-var">stakeOut</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545799"><span class="annot"><span class="annottext">templateStakeOut :: Term s PStakeDatum
</span><a href="#local-6989586621679545799"><span class="hs-identifier hs-var hs-var">templateStakeOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-467"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-468"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-469"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679545876"><span class="hs-identifier hs-var">stakeInF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-470"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
</span><a href="#local-6989586621679545800"><span class="hs-identifier hs-var">stakeOutputLocks</span></a></span><span>
</span><span id="line-471"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Only locks updated in the output stake&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-474"></span><span>            </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545799"><span class="hs-identifier hs-var">templateStakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679545873"><span class="hs-identifier hs-var">stakeOut</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;All relevant locks removed from the stake&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-477"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
forall {w :: S}.
Term
  w
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
</span><a href="Agora.Stake.html#pgetStakeUsage"><span class="hs-identifier hs-var">pgetStakeUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; (PProposalId :--&gt; PStakeUsage))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PProposalId :--&gt; PStakeUsage)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
</span><a href="#local-6989586621679545800"><span class="hs-identifier hs-var">stakeOutputLocks</span></a></span><span class="hs-cpp">
              # proposalF.proposalId #== pcon PDidNothing
</span><span>
</span><span id="line-480"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><a href="Agora.Proposal.html#PAdvanceProposal"><span class="hs-identifier hs-type">PAdvanceProposal</span></a></span><span> </span><span id="local-6989586621679545797"><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><a href="#local-6989586621679545797"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake should not change&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545872"><span class="hs-identifier hs-var">stakeUnchanged</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>          </span><span id="local-6989586621679545796"><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; TermCont @POpaque s (Term s (PAsData PProposalStatus))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PProposalStatus)
 -&gt; TermCont @POpaque s (Term s (PAsData PProposalStatus)))
-&gt; Term s (PAsData PProposalStatus)
-&gt; TermCont @POpaque s (Term s (PAsData PProposalStatus))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;status&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PProposalDatum :--&gt; PAsData PProposalStatus)
-&gt; Term s PProposalDatum -&gt; Term s (PAsData PProposalStatus)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Only the status of proposals should be updated in this case.</span><span>
</span><span id="line-488"></span><span>              </span><span id="local-6989586621679545795"><span class="annot"><span class="annottext">templateProposalOut :: Term s PProposalDatum
</span><a href="#local-6989586621679545795"><span class="hs-identifier hs-var hs-var">templateProposalOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>                </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;proposalId&quot; ':= PProposalId)
         ((':)
            @PLabeledType
            (&quot;effects&quot;
             ':= PMap
                   'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
            ((':)
               @PLabeledType
               (&quot;status&quot; ':= PProposalStatus)
               ((':)
                  @PLabeledType
                  (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                  ((':)
                     @PLabeledType
                     (&quot;thresholds&quot; ':= PProposalThresholds)
                     ((':)
                        @PLabeledType
                        (&quot;votes&quot; ':= PProposalVotes)
                        ((':)
                           @PLabeledType
                           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                           ((':)
                              @PLabeledType
                              (&quot;startingTime&quot; ':= PProposalStartingTime)
                              ('[] @PLabeledType))))))))))
 -&gt; PProposalDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
-&gt; Term s PProposalDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-490"></span><span>                  </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType))))))))))
-&gt; PProposalDatum s'
</span><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-var">PProposalDatum</span></a></span><span>
</span><span id="line-491"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
</span><span class="">#proposalId</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;proposalId&quot;
-&gt; Term s (PAsData PProposalId)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-492"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
  ((':)
     @PLabeledType
     (&quot;proposalId&quot; ':= PProposalId)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType)))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;proposalId&quot; ':= PProposalId)
        ((':)
           @PLabeledType
           (&quot;effects&quot;
            ':= PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
           ((':)
              @PLabeledType
              (&quot;status&quot; ':= PProposalStatus)
              ((':)
                 @PLabeledType
                 (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                 ((':)
                    @PLabeledType
                    (&quot;thresholds&quot; ':= PProposalThresholds)
                    ((':)
                       @PLabeledType
                       (&quot;votes&quot; ':= PProposalVotes)
                       ((':)
                          @PLabeledType
                          (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                          ((':)
                             @PLabeledType
                             (&quot;startingTime&quot; ':= PProposalStartingTime)
                             ('[] @PLabeledType)))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
</span><span class="">#effects</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;effects&quot;
-&gt; Term
     s
     (PAsData
        (PMap
           'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-493"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
  ((':)
     @PLabeledType
     (&quot;effects&quot;
      ':= PMap
            'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType))))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;effects&quot;
         ':= PMap
               'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))
        ((':)
           @PLabeledType
           (&quot;status&quot; ':= PProposalStatus)
           ((':)
              @PLabeledType
              (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
              ((':)
                 @PLabeledType
                 (&quot;thresholds&quot; ':= PProposalThresholds)
                 ((':)
                    @PLabeledType
                    (&quot;votes&quot; ':= PProposalVotes)
                    ((':)
                       @PLabeledType
                       (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                       ((':)
                          @PLabeledType
                          (&quot;startingTime&quot; ':= PProposalStartingTime)
                          ('[] @PLabeledType))))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
</span><span class="">#status</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;status&quot;
-&gt; Term s (PAsData PProposalStatus)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span><span>
</span><span id="line-494"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
  ((':)
     @PLabeledType
     (&quot;status&quot; ':= PProposalStatus)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType)))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;status&quot; ':= PProposalStatus)
        ((':)
           @PLabeledType
           (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ((':)
              @PLabeledType
              (&quot;thresholds&quot; ':= PProposalThresholds)
              ((':)
                 @PLabeledType
                 (&quot;votes&quot; ':= PProposalVotes)
                 ((':)
                    @PLabeledType
                    (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                    ((':)
                       @PLabeledType
                       (&quot;startingTime&quot; ':= PProposalStartingTime)
                       ('[] @PLabeledType)))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
</span><span class="">#cosigners</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;cosigners&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PPubKeyHash)))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-495"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
  ((':)
     @PLabeledType
     (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType))))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;cosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ((':)
           @PLabeledType
           (&quot;thresholds&quot; ':= PProposalThresholds)
           ((':)
              @PLabeledType
              (&quot;votes&quot; ':= PProposalVotes)
              ((':)
                 @PLabeledType
                 (&quot;timingConfig&quot; ':= PProposalTimingConfig)
                 ((':)
                    @PLabeledType
                    (&quot;startingTime&quot; ':= PProposalStartingTime)
                    ('[] @PLabeledType))))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
</span><span class="">#thresholds</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;thresholds&quot;
-&gt; Term s (PAsData PProposalThresholds)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-496"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
  ((':)
     @PLabeledType
     (&quot;thresholds&quot; ':= PProposalThresholds)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType)))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;thresholds&quot; ':= PProposalThresholds)
        ((':)
           @PLabeledType
           (&quot;votes&quot; ':= PProposalVotes)
           ((':)
              @PLabeledType
              (&quot;timingConfig&quot; ':= PProposalTimingConfig)
              ((':)
                 @PLabeledType
                 (&quot;startingTime&quot; ':= PProposalStartingTime)
                 ('[] @PLabeledType)))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
</span><span class="">#votes</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;votes&quot;
-&gt; Term s (PAsData PProposalVotes)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-497"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;votes&quot; ':= PProposalVotes)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;votes&quot; ':= PProposalVotes)
        ((':)
           @PLabeledType
           (&quot;timingConfig&quot; ':= PProposalTimingConfig)
           ((':)
              @PLabeledType
              (&quot;startingTime&quot; ':= PProposalStartingTime)
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
</span><span class="">#timingConfig</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;timingConfig&quot;
-&gt; Term s (PAsData PProposalTimingConfig)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span>
</span><span id="line-498"></span><span>                      </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;startingTime&quot; ':= PProposalStartingTime)
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;timingConfig&quot; ':= PProposalTimingConfig)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;timingConfig&quot; ':= PProposalTimingConfig)
        ((':)
           @PLabeledType
           (&quot;startingTime&quot; ':= PProposalStartingTime)
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
</span><span class="">#startingTime</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;startingTime&quot;
-&gt; Term s (PAsData PProposalStartingTime)
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;startingTime&quot; ':= PProposalStartingTime)
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span>
</span><span id="line-499"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Only status changes in the output proposal&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-502"></span><span>            </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545795"><span class="hs-identifier hs-var">templateProposalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum -&gt; Term s PProposalDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679545886"><span class="hs-identifier hs-var">proposalOut</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>          </span><span id="local-6989586621679545794"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545794"><span class="hs-identifier hs-var">inDraftPeriod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
forall (s :: S).
Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
</span><a href="Agora.Proposal.Time.html#isDraftPeriod"><span class="hs-identifier hs-var">isDraftPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
-&gt; Term s PProposalTimingConfig
-&gt; Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
-&gt; Term s PProposalStartingTime
-&gt; Term s (PProposalTime :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalTime :--&gt; PBool)
-&gt; Term s PProposalTime -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-505"></span><span>          </span><span id="local-6989586621679545793"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545793"><span class="hs-identifier hs-var">inVotingPeriod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
forall (s :: S).
Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
</span><a href="Agora.Proposal.Time.html#isVotingPeriod"><span class="hs-identifier hs-var">isVotingPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
-&gt; Term s PProposalTimingConfig
-&gt; Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
-&gt; Term s PProposalStartingTime
-&gt; Term s (PProposalTime :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalTime :--&gt; PBool)
-&gt; Term s PProposalTime -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-506"></span><span>          </span><span id="local-6989586621679545792"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545792"><span class="hs-identifier hs-var">inLockedPeriod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
forall (s :: S).
Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
</span><a href="Agora.Proposal.Time.html#isLockingPeriod"><span class="hs-identifier hs-var">isLockingPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
-&gt; Term s PProposalTimingConfig
-&gt; Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
-&gt; Term s PProposalStartingTime
-&gt; Term s (PProposalTime :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalTime :--&gt; PBool)
-&gt; Term s PProposalTime -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-507"></span><span>          </span><span id="local-6989586621679545791"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545791"><span class="hs-identifier hs-var">inExecutionPeriod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
forall (s :: S).
Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
</span><a href="Agora.Proposal.Time.html#isExecutionPeriod"><span class="hs-identifier hs-var">isExecutionPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PProposalTimingConfig
   :--&gt; (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool)))
-&gt; Term s PProposalTimingConfig
-&gt; Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timingConfig</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalStartingTime :--&gt; (PProposalTime :--&gt; PBool))
-&gt; Term s PProposalStartingTime
-&gt; Term s (PProposalTime :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startingTime</span><span> </span><span class="annot"><span class="annottext">Term s (PProposalTime :--&gt; PBool)
-&gt; Term s PProposalTime -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalTime
</span><a href="#local-6989586621679545895"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>          </span><span class="hs-comment">-- Check the timings.</span><span>
</span><span id="line-510"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679545790"><span class="annot"><span class="annottext">isFinished :: Term s PBool
</span><a href="#local-6989586621679545790"><span class="hs-identifier hs-var hs-var">isFinished</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>              </span><span id="local-6989586621679545789"><span class="annot"><span class="annottext">notTooLate :: Term s PBool
</span><a href="#local-6989586621679545789"><span class="hs-identifier hs-var hs-var">notTooLate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PProposalStatus
-&gt; (PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus) -&gt; Term s PProposalStatus
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool)
-&gt; (PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-513"></span><span>                </span><span class="annot"><a href="Agora.Proposal.html#PDraft"><span class="hs-identifier hs-type">PDraft</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545794"><span class="hs-identifier hs-var">inDraftPeriod</span></a></span><span>
</span><span id="line-514"></span><span>                </span><span class="hs-comment">-- Can only advance after the voting period is over.</span><span>
</span><span id="line-515"></span><span>                </span><span class="annot"><a href="Agora.Proposal.html#PVotingReady"><span class="hs-identifier hs-type">PVotingReady</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545792"><span class="hs-identifier hs-var">inLockedPeriod</span></a></span><span>
</span><span id="line-516"></span><span>                </span><span class="annot"><a href="Agora.Proposal.html#PLocked"><span class="hs-identifier hs-type">PLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545791"><span class="hs-identifier hs-var">inExecutionPeriod</span></a></span><span>
</span><span id="line-517"></span><span>                </span><span class="annot"><span class="annottext">PProposalStatus s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PLifted PBool -&gt; Term s PBool
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
PLifted PBool
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>              </span><span id="local-6989586621679545785"><span class="annot"><span class="annottext">notTooEarly :: Term s PBool
</span><a href="#local-6989586621679545785"><span class="hs-identifier hs-var hs-var">notTooEarly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PProposalStatus
-&gt; (PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus) -&gt; Term s PProposalStatus
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool)
-&gt; (PProposalStatus s -&gt; Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-520"></span><span>                </span><span class="annot"><a href="Agora.Proposal.html#PVotingReady"><span class="hs-identifier hs-type">PVotingReady</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545793"><span class="hs-identifier hs-var">inVotingPeriod</span></a></span><span>
</span><span id="line-521"></span><span>                </span><span class="annot"><a href="Agora.Proposal.html#PLocked"><span class="hs-identifier hs-type">PLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545792"><span class="hs-identifier hs-var">inLockedPeriod</span></a></span><span>
</span><span id="line-522"></span><span>                </span><span class="annot"><span class="annottext">PProposalStatus s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PLifted PBool -&gt; Term s PBool
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
PLifted PBool
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Cannot advance ahead of time&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545785"><span class="hs-identifier hs-var">notTooEarly</span></a></span><span>
</span><span id="line-525"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Finished proposals cannot be advanced&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545790"><span class="hs-identifier hs-var">isFinished</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-528"></span><span>            </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (a :: PType).
Term s PBool -&gt; Term s a -&gt; Term s a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pif</span></a></span><span>
</span><span id="line-529"></span><span>              </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679545789"><span class="hs-identifier hs-var">notTooLate</span></a></span><span>
</span><span id="line-530"></span><span>              </span><span class="hs-comment">-- On time: advance to next status.</span><span>
</span><span id="line-531"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Term s PProposalStatus
-&gt; (PProposalStatus s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus) -&gt; Term s PProposalStatus
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s
            (PAsData
               (PMap
                  'Unsorted PResultTag (PMap 'Unsorted PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;timingConfig&quot;, Term s (PAsData PProposalTimingConfig))
                       ((':)
                          @(Symbol, Type)
                          '(&quot;startingTime&quot;, Term s (PAsData PProposalStartingTime))
                          ('[] @(Symbol, Type))))))))))
</span><a href="#local-6989586621679545901"><span class="hs-identifier hs-var">proposalF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PProposalStatus s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PProposalStatus s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-532"></span><span>                  </span><span class="annot"><a href="Agora.Proposal.html#PDraft"><span class="hs-identifier hs-type">PDraft</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-533"></span><span>                    </span><span class="hs-comment">-- TODO: Perform other necessary checks.</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>                    </span><span class="hs-comment">-- 'Draft' -&gt; 'VotingReady'</span><span>
</span><span id="line-536"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal status set to VotingReady&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-537"></span><span>                      </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#VotingReady"><span class="hs-identifier hs-var">VotingReady</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>                    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>                  </span><span class="annot"><a href="Agora.Proposal.html#PVotingReady"><span class="hs-identifier hs-type">PVotingReady</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>                    </span><span class="hs-comment">-- 'VotingReady' -&gt; 'Locked'</span><span>
</span><span id="line-542"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal status set to Locked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-543"></span><span>                      </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Locked"><span class="hs-identifier hs-var">Locked</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>                    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>                  </span><span class="annot"><a href="Agora.Proposal.html#PLocked"><span class="hs-identifier hs-type">PLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-547"></span><span>                    </span><span class="hs-comment">-- 'Locked' -&gt; 'Finished'</span><span>
</span><span id="line-548"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal status set to Finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-549"></span><span>                      </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>                    </span><span class="hs-comment">-- TODO: Perform other necessary checks.</span><span>
</span><span id="line-552"></span><span>                    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                  </span><span class="annot"><span class="annottext">PProposalStatus s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>              </span><span class="hs-comment">-- Too late: failed proposal, status set to 'Finished'.</span><span>
</span><span id="line-556"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque) -&gt; Term s PBool -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-557"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal should fail: not on time&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-558"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
</span><a href="#local-6989586621679545796"><span class="hs-identifier hs-var">proposalOutStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalStatus)
-&gt; Term s (PAsData PProposalStatus) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus -&gt; Term s (PAsData PProposalStatus)
forall (p :: PType) h (s :: S).
(ToData h, (PLifted p :: Type) ~ (h :: Type),
 (PConstanted h :: PType) ~ (p :: PType)) =&gt;
h -&gt; Term s (PAsData p)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstantData</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalStatus
</span><a href="Agora.Proposal.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span>
</span><span id="line-559"></span><span>                    </span><span class="hs-comment">-- TODO: Should check that the GST is not moved</span><span>
</span><span id="line-560"></span><span>                    </span><span class="hs-comment">--        if the proposal is in 'Locked' state.</span><span>
</span><span id="line-561"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-562"></span></pre></body></html>