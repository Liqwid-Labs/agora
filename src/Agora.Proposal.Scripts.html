<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Module     : Agora.Proposal.Scripts
Maintainer : emi@haskell.fyi
Description: Plutus Scripts for Proposals.

Plutus Scripts for Proposals.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agora.Proposal.Scripts</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-9"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier">proposalValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier">proposalPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.html"><span class="hs-identifier">Agora.Proposal</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier">PProposalDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier">PProposalDatum</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#PProposalRedeemer"><span class="hs-identifier">PProposalRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier">Proposal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#governorSTAssetClass"><span class="hs-identifier">governorSTAssetClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#stakeSTAssetClass"><span class="hs-identifier">stakeSTAssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Record.html"><span class="hs-identifier">Agora.Record</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Record.html#mkRecordConstr"><span class="hs-identifier">mkRecordConstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Record.html#.%26"><span class="hs-operator">(.&amp;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Record.html#.%3D"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Stake.html"><span class="hs-identifier">Agora.Stake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Stake.html#findStakeOwnedBy"><span class="hs-identifier">findStakeOwnedBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Utils.html"><span class="hs-identifier">Agora.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#anyOutput"><span class="hs-identifier">anyOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#findTxOutByTxOutRef"><span class="hs-identifier">findTxOutByTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#getMintingPolicySymbol"><span class="hs-identifier">getMintingPolicySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#passert"><span class="hs-identifier">passert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pisUniq"><span class="hs-identifier">pisUniq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier">psymbolValueOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#ptokenSpent"><span class="hs-identifier">ptokenSpent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#ptxSignedBy"><span class="hs-identifier">ptxSignedBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pvalueSpent"><span class="hs-identifier">pvalueSpent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptContext</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMinting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PSpending</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">passetClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">passetClassValueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Monadic</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.TryFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">ptryFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/jq1snvvlmgg1bd2wl23baclk24qwx1i3-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V1.Ledger.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/jq1snvvlmgg1bd2wl23baclk24qwx1i3-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/jq1snvvlmgg1bd2wl23baclk24qwx1i3-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">{- | Policy for Proposals.

   == What this policy does

   === For minting:

   - Governor is happy with mint.

     * The governor must do most of the checking for the validity of the
       transaction. For example, the governor must check that the datum
       is correct, and that the ST is correctly paid to the right validator.

   - Exactly 1 token is minted.

   === For burning:

   - This policy cannot be burned.
-}</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-type">proposalPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier hs-type">Proposal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMintingPolicy</span></a></span><span>
</span><span id="line-62"></span><span id="proposalPolicy"><span class="annot"><span class="annottext">proposalPolicy :: Proposal -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-var hs-var">proposalPolicy</span></a></span></span><span> </span><span id="local-6989586621679404331"><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679404331"><span class="hs-identifier hs-var">proposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PMintingPolicy)
-&gt; (Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404329"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679404329"><span class="hs-identifier hs-var">_redeemer</span></a></span></span><span> </span><span id="local-6989586621679404328"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679404328"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PScriptContext</span></a></span><span> </span><span id="local-6989586621679404327"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679404327"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
-&gt; (PScriptContext s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679404328"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679404325"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679404327"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxInfo</span></a></span><span> </span><span id="local-6989586621679404323"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679404323"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; (PTxInfo s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; (PTxInfo s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PTxInfo
-&gt; (PTxInfo s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679404321"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404321"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679404323"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679404320"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679404320"><span class="hs-identifier hs-var">_ownSymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose
 -&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404319"><span class="annot"><span class="annottext">inputs :: Term s (PBuiltinList (PAsData PTxInInfo))
</span><a href="#local-6989586621679404319"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404321"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-71"></span><span>        </span><span id="local-6989586621679404318"><span class="annot"><span class="annottext">mintedValue :: Term s PValue
</span><a href="#local-6989586621679404318"><span class="hs-identifier hs-var hs-var">mintedValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PValue) -&gt; Term s PValue
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404321"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><a href="../file:///nix/store/jq1snvvlmgg1bd2wl23baclk24qwx1i3-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404317"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679404317"><span class="hs-identifier hs-var">govCs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404316"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679404316"><span class="hs-identifier hs-var">govTn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679404331"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">governorSTAssetClass</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679404315"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679404315"><span class="hs-identifier hs-var">ownSymbol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose
 -&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404314"><span class="annot"><span class="annottext">mintedProposalST :: Term s (PInteger @S)
</span><a href="#local-6989586621679404314"><span class="hs-identifier hs-var hs-var">mintedProposalST</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-76"></span><span>          </span><span class="annot"><span class="annottext">(:$)
  @Type @PType (Term s) (PValue :--&gt; (PAssetClass :--&gt; PInteger @S))
forall (s :: S).
(:$)
  @Type @PType (Term s) (PValue :--&gt; (PAssetClass :--&gt; PInteger @S))
</span><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClassValueOf</span></a></span><span class="hs-cpp">
            # mintedValue
</span><span class="hs-cpp">            # (passetClass # (pfield @&quot;_0&quot; # ownSymbol') # pconstant &quot;&quot;)
</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Governance state-thread token must move&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
forall {s :: S}.
Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
</span><a href="Agora.Utils.html#ptokenSpent"><span class="hs-identifier hs-var">ptokenSpent</span></a></span><span class="hs-cpp">
        # (passetClass # pconstant govCs # pconstant govTn)
</span><span class="hs-cpp">        # inputs
</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Minted exactly one proposal ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679404314"><span class="hs-identifier hs-var">mintedProposalST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">{- | The validator for Proposals.

The documentation for various of the redeemers lives at 'Agora.Proposal.ProposalRedeemer'.

== What this validator does

=== Voting/unlocking

When voting and unlocking, the proposal must witness a state transition
occuring in the relevant Stake. This transition must place a lock on
the stake that is tagged with the right 'Agora.Proposal.ResultTag', and 'Agora.Proposal.ProposalId'.

=== Periods

Most redeemers are time-sensitive.

A list of all time-sensitive redeemers and their requirements:

- 'Agora.Proposal.Vote' can only be used when both the status is in 'Agora.Proposal.VotingReady',
  and 'Agora.Proposal.Time.isVotingPeriod' is true.
- 'Agora.Proposal.Cosign' can only be used when both the status is in 'Agora.Proposal.Draft',
  and 'Agora.Proposal.Time.isDraftPeriod' is true.
- 'Agora.Proposal.AdvanceProposal' can only be used when the status can be advanced
  (see 'Agora.Proposal.AdvanceProposal' docs).
- 'Agora.Proposal.Unlock' is always valid.
-}</span><span>
</span><span id="line-116"></span><span class="annot"><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier hs-type">proposalValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Proposal.html#Proposal"><span class="hs-identifier hs-type">Proposal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidator</span></a></span><span>
</span><span id="line-117"></span><span id="proposalValidator"><span class="annot"><span class="annottext">proposalValidator :: Proposal -&gt; ClosedTerm PValidator
</span><a href="Agora.Proposal.Scripts.html#proposalValidator"><span class="hs-identifier hs-var hs-var">proposalValidator</span></a></span></span><span> </span><span id="local-6989586621679403976"><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">proposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData
 -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData
  -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PValidator)
-&gt; (Term s PData
    -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403975"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679403975"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679403974"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679403974"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span id="local-6989586621679403973"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679403973"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PScriptContext</span></a></span><span> </span><span id="local-6989586621679403972"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679403972"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
-&gt; (PScriptContext s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679403973"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679403971"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403971"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;txInfo&quot; ':= PTxInfo)
        ((':)
           @PLabeledType (&quot;purpose&quot; ':= PScriptPurpose) ('[] @PLabeledType))))
</span><a href="#local-6989586621679403972"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679403970"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679403970"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
-&gt; (Term s PTxInfo -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo
 -&gt; (Term s PTxInfo -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PTxInfo
-&gt; (Term s PTxInfo -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403971"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxInfo</span></a></span><span> </span><span id="local-6989586621679403968"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679403968"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; (PTxInfo s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679403970"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679403967"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ((':)
           @(Symbol, Type)
           '(&quot;signatories&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;datums&quot;,
                Term
                  s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679403967"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;signatories&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;inputs&quot; ':= PBuiltinList (PAsData PTxInInfo))
        ((':)
           @PLabeledType
           (&quot;outputs&quot; ':= PBuiltinList (PAsData PTxOut))
           ((':)
              @PLabeledType
              (&quot;fee&quot; ':= PValue)
              ((':)
                 @PLabeledType
                 (&quot;mint&quot; ':= PValue)
                 ((':)
                    @PLabeledType
                    (&quot;dcert&quot; ':= PBuiltinList (PAsData PDCert))
                    ((':)
                       @PLabeledType
                       (&quot;wdrl&quot;
                        ':= PBuiltinList
                              (PAsData (PTuple PStakingCredential (PInteger @S))))
                       ((':)
                          @PLabeledType
                          (&quot;validRange&quot; ':= PPOSIXTimeRange)
                          ((':)
                             @PLabeledType
                             (&quot;signatories&quot; ':= PBuiltinList (PAsData PPubKeyHash))
                             ((':)
                                @PLabeledType
                                (&quot;datums&quot; ':= PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
                                ((':) @PLabeledType (&quot;id&quot; ':= PTxId) ('[] @PLabeledType))))))))))))
</span><a href="#local-6989586621679403968"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PSpending</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403966"><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679403966"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose
 -&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403971"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PJust</span></a></span><span> </span><span id="local-6989586621679403964"><span class="annot"><span class="annottext">Term s PTxOut
</span><a href="#local-6989586621679403964"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe PTxOut)
-&gt; (PMaybe PTxOut s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMaybe PTxOut)
 -&gt; (PMaybe PTxOut s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PMaybe PTxOut)
-&gt; (PMaybe PTxOut s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxOut))
forall (s :: S).
Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxOut))
</span><a href="Agora.Utils.html#findTxOutByTxOutRef"><span class="hs-identifier hs-var">findTxOutByTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxOut))
-&gt; Term s PTxOutRef
-&gt; Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOutRef
</span><a href="#local-6989586621679403966"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxOut)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PMaybe PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ((':)
           @(Symbol, Type)
           '(&quot;signatories&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;datums&quot;,
                Term
                  s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679403967"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621679403963"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;address&quot;, Term s (PAsData PAddress))
     ((':)
        @(Symbol, Type)
        '(&quot;value&quot;, Term s (PAsData PValue))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403963"><span class="hs-identifier hs-var">txOutF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s PTxOut
 -&gt; (HRec
       (BoundTerms
          ((':)
             @PLabeledType
             (&quot;address&quot; ':= PAddress)
             ((':)
                @PLabeledType
                (&quot;value&quot; ':= PValue)
                ((':)
                   @PLabeledType
                   (&quot;datumHash&quot; ':= PMaybeData PDatumHash)
                   ('[] @PLabeledType))))
          ((':) @ToBind 'Bind ((':) @ToBind 'Bind ('[] @ToBind)))
          s)
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s PTxOut
-&gt; (HRec
      (BoundTerms
         ((':)
            @PLabeledType
            (&quot;address&quot; ':= PAddress)
            ((':)
               @PLabeledType
               (&quot;value&quot; ':= PValue)
               ((':)
                  @PLabeledType
                  (&quot;datumHash&quot; ':= PMaybeData PDatumHash)
                  ('[] @PLabeledType))))
         ((':) @ToBind 'Bind ((':) @ToBind 'Bind ('[] @ToBind)))
         s)
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxOut
</span><a href="#local-6989586621679403964"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalDatum) -&gt; Term s PProposalDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403962"><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679403962"><span class="hs-identifier hs-var">proposalDatum</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">forall (b :: PType) (a :: PType) (s :: S) (r :: PType).
PTryFrom a b =&gt;
Term s a
-&gt; ((Term s b, Reduce @Type (PTryFromExcess a b s)) -&gt; Term s r)
-&gt; Term s r
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptryFrom</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679403975"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PProposalRedeemer) -&gt; Term s PProposalRedeemer
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403961"><span class="annot"><span class="annottext">Term s PProposalRedeemer
</span><a href="#local-6989586621679403961"><span class="hs-identifier hs-var">proposalRedeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduce @Type (PTryFromExcess PData (PAsData PProposalRedeemer) s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">forall (b :: PType) (a :: PType) (s :: S) (r :: PType).
PTryFrom a b =&gt;
Term s a
-&gt; ((Term s b, Reduce @Type (PTryFromExcess a b s)) -&gt; Term s r)
-&gt; Term s r
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptryFrom</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Proposal.html#PProposalRedeemer"><span class="hs-identifier hs-type">PProposalRedeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679403974"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679403960"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;proposalId&quot;, Term s (PAsData PProposalId))
     ((':)
        @(Symbol, Type)
        '(&quot;effects&quot;,
          Term
            s (PAsData (PMap PResultTag (PMap PValidatorHash PDatumHash))))
        ((':)
           @(Symbol, Type)
           '(&quot;status&quot;, Term s (PAsData PProposalStatus))
           ((':)
              @(Symbol, Type)
              '(&quot;cosigners&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;thresholds&quot;, Term s (PAsData PProposalThresholds))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;votes&quot;, Term s (PAsData PProposalVotes))
                    ('[] @(Symbol, Type))))))))
</span><a href="#local-6989586621679403960"><span class="hs-identifier hs-var">proposalF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalId&quot;</span></span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;effects&quot;</span></span><span>
</span><span id="line-138"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;status&quot;</span></span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;cosigners&quot;</span></span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;thresholds&quot;</span></span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;votes&quot;</span></span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Term s PProposalDatum
</span><a href="#local-6989586621679403962"><span class="hs-identifier hs-var">proposalDatum</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679403959"><span class="annot"><span class="annottext">Term s (PAsData PAddress)
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">ownAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PAddress)
-&gt; (Term s (PAsData PAddress) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PAddress)
 -&gt; (Term s (PAsData PAddress) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PAsData PAddress)
-&gt; (Term s (PAsData PAddress) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;address&quot;, Term s (PAsData PAddress))
     ((':)
        @(Symbol, Type)
        '(&quot;value&quot;, Term s (PAsData PValue))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403963"><span class="hs-identifier hs-var">txOutF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403958"><span class="annot"><span class="annottext">stCurrencySymbol :: Term s PCurrencySymbol
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var hs-var">stCurrencySymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol)
-&gt; PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; CurrencySymbol
</span><a href="Agora.Utils.html#getMintingPolicySymbol"><span class="hs-identifier hs-var">getMintingPolicySymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposal -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Proposal.Scripts.html#proposalPolicy"><span class="hs-identifier hs-var">proposalPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679403957"><span class="annot"><span class="annottext">Term s PValue
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var">valueSpent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PValue
-&gt; (Term s PValue -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PValue
 -&gt; (Term s PValue -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PValue
-&gt; (Term s PValue -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue)
forall (s :: S).
Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue)
</span><a href="Agora.Utils.html#pvalueSpent"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo)) -&gt; Term s PValue
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ((':)
           @(Symbol, Type)
           '(&quot;signatories&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;datums&quot;,
                Term
                  s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679403967"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679403956"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679403956"><span class="hs-identifier hs-var">spentST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
</span><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol -&gt; Term s (PValue :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue :--&gt; PInteger @S)
-&gt; Term s PValue -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PValue
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var">valueSpent</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../file:///nix/store/jq1snvvlmgg1bd2wl23baclk24qwx1i3-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403954"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679403954"><span class="hs-identifier hs-var">stakeSym</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403953"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">stakeTn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposal
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakeSTAssetClass</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679403952"><span class="annot"><span class="annottext">Term s PAssetClass
</span><a href="#local-6989586621679403952"><span class="hs-identifier hs-var">stakeSTAssetClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">Term s PAssetClass
-&gt; (Term s PAssetClass -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PAssetClass
 -&gt; (Term s PAssetClass -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PAssetClass
-&gt; (Term s PAssetClass -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(:$)
  @Type
  @PType
  (Term s)
  (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
forall (s :: S).
(:$)
  @Type
  @PType
  (Term s)
  (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
</span><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClass</span></a></span><span> </span><span class="annot"><span class="annottext">(:$)
  @Type
  @PType
  (Term s)
  (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTokenName :--&gt; PAssetClass)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679403954"><span class="hs-identifier hs-var">stakeSym</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTokenName :--&gt; PAssetClass)
-&gt; Term s PTokenName -&gt; Term s PAssetClass
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName -&gt; Term s PTokenName
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName
TokenName
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">stakeTn</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679403951"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679403951"><span class="hs-identifier hs-var">spentStakeST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(:$)
  @Type @PType (Term s) (PValue :--&gt; (PAssetClass :--&gt; PInteger @S))
forall (s :: S).
(:$)
  @Type @PType (Term s) (PValue :--&gt; (PAssetClass :--&gt; PInteger @S))
</span><a href="../file:///nix/store/kxxfwnpph41xygd3dgzpdwmkayp02bf2-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClassValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">(:$)
  @Type @PType (Term s) (PValue :--&gt; (PAssetClass :--&gt; PInteger @S))
-&gt; Term s PValue -&gt; Term s (PAssetClass :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PValue
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var">valueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAssetClass :--&gt; PInteger @S)
-&gt; Term s PAssetClass -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PAssetClass
</span><a href="#local-6989586621679403952"><span class="hs-identifier hs-var">stakeSTAssetClass</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679403950"><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
</span><a href="#local-6989586621679403950"><span class="hs-identifier hs-var">signedBy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; (Term s (PAsData PPubKeyHash :--&gt; PBool) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PPubKeyHash :--&gt; PBool)
 -&gt; (Term s (PAsData PPubKeyHash :--&gt; PBool) -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; (Term s (PAsData PPubKeyHash :--&gt; PBool) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="Agora.Utils.html#ptxSignedBy"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;mint&quot;, Term s (PAsData PValue))
        ((':)
           @(Symbol, Type)
           '(&quot;signatories&quot;,
             Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
           ((':)
              @(Symbol, Type)
              '(&quot;datums&quot;,
                Term
                  s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
              ('[] @(Symbol, Type))))))
</span><a href="#local-6989586621679403967"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">signatories</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679403956"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">Term s PProposalRedeemer
-&gt; (PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PProposalRedeemer
</span><a href="#local-6989586621679403961"><span class="hs-identifier hs-var">proposalRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PProposalRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><a href="Agora.Proposal.html#PVote"><span class="hs-identifier hs-type">PVote</span></a></span><span> </span><span id="local-6989586621679403948"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679403948"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><a href="Agora.Proposal.html#PCosign"><span class="hs-identifier hs-type">PCosign</span></a></span><span> </span><span id="local-6989586621679403946"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621679403945"><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">newSigs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; (Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PBuiltinList (PAsData PPubKeyHash))
 -&gt; (Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; (Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;newCosigners&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType))
   :--&gt; PBuiltinList (PAsData PPubKeyHash))
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
           ('[] @PLabeledType)))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;newCosigners&quot; ':= PBuiltinList (PAsData PPubKeyHash))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Cosigners are unique&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PEq a, PIsListLike list a) =&gt;
Term s (list a :--&gt; PBool)
</span><a href="Agora.Utils.html#pisUniq"><span class="hs-identifier hs-var">pisUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">newSigs</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Signed by all new cosigners&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-173"></span><span>          </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pall</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
</span><a href="#local-6989586621679403950"><span class="hs-identifier hs-var">signedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">newSigs</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;As many new cosigners as Stake datums&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-176"></span><span>          </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679403951"><span class="hs-identifier hs-var">spentStakeST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s (list a :--&gt; PInteger @S)
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plength</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash) :--&gt; PInteger @S)
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PPubKeyHash))
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">newSigs</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;All new cosigners are witnessed by their Stake datums&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-179"></span><span>          </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PPubKeyHash :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PPubKeyHash) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pall</span></a></span><span class="hs-cpp">
            # plam
</span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">sig</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>                  </span><span class="hs-identifier">pmatch</span><span>
</span><span id="line-183"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">findStakeOwnedBy</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">stakeSTAssetClass</span><span class="hs-cpp">
                        # pfromData sig
</span><span class="hs-cpp">                        # txInfoF.datums
</span><span class="hs-cpp">                        # txInfoF.inputs
</span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>                    </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-189"></span><span>                      </span><span class="hs-identifier">PNothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PFalse</span><span>
</span><span id="line-190"></span><span>                      </span><span class="hs-identifier">PJust</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PTrue</span><span>
</span><span id="line-191"></span><span>              </span><span class="hs-special">)</span><span class="hs-cpp">
            # newSigs
</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Signatures are correctly added to cosignature list&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (datum :--&gt; PBool))) :--&gt; PBool))
</span><a href="Agora.Utils.html#anyOutput"><span class="hs-identifier hs-var">anyOutput</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Proposal.html#PProposalDatum"><span class="hs-identifier hs-type">PProposalDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (PProposalDatum :--&gt; PBool)))
         :--&gt; PBool))
-&gt; Term s PTxInfo
-&gt; Term
     s
     ((PValue :--&gt; (PAddress :--&gt; (PProposalDatum :--&gt; PBool)))
      :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;txInfo&quot;, Term s (PAsData PTxInfo))
     ((':)
        @(Symbol, Type)
        '(&quot;purpose&quot;, Term s (PAsData PScriptPurpose))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679403971"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span class="hs-cpp">
            #$ plam
</span><span>            </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">newValue</span><span> </span><span class="hs-identifier">address</span><span> </span><span class="hs-identifier">newProposalDatum</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-198"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">updatedSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pconcat</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">newSigs</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">cosigners</span><span>
</span><span id="line-199"></span><span>                  </span><span class="hs-identifier">correctDatum</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">newProposalDatum</span><span class="hs-cpp">
                      #== pdata
</span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">mkRecordConstr</span><span>
</span><span id="line-203"></span><span>                            </span><span class="hs-identifier">PProposalDatum</span><span>
</span><span id="line-204"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="">#proposalId</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">proposalId</span><span>
</span><span id="line-205"></span><span>                                </span><span class="hs-operator">.&amp;</span><span> </span><span class="">#effects</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">effects</span><span>
</span><span id="line-206"></span><span>                                </span><span class="hs-operator">.&amp;</span><span> </span><span class="">#status</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">status</span><span>
</span><span id="line-207"></span><span>                                </span><span class="hs-operator">.&amp;</span><span> </span><span class="">#cosigners</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">updatedSigs</span><span>
</span><span id="line-208"></span><span>                                </span><span class="hs-operator">.&amp;</span><span> </span><span class="">#thresholds</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">thresholds</span><span>
</span><span id="line-209"></span><span>                                </span><span class="hs-operator">.&amp;</span><span> </span><span class="">#votes</span><span> </span><span class="hs-operator">.=</span><span> </span><span class="hs-identifier">proposalF</span><span class="hs-operator">.</span><span class="hs-identifier">votes</span><span>
</span><span id="line-210"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>              </span><span class="hs-identifier">foldr1</span><span>
</span><span id="line-214"></span><span>                </span><span class="hs-special">(</span><span class="hs-operator">#&amp;&amp;</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;Datum must be correct&quot;</span><span> </span><span class="hs-identifier">correctDatum</span><span>
</span><span id="line-216"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;Value should be correct&quot;</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-217"></span><span>                    </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">txOutF</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">newValue</span><span>
</span><span id="line-218"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;Must be sent to Proposal's address&quot;</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-219"></span><span>                    </span><span class="hs-identifier">ownAddress</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">address</span><span>
</span><span id="line-220"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-224"></span><span>      </span><span class="annot"><a href="Agora.Proposal.html#PUnlock"><span class="hs-identifier hs-type">PUnlock</span></a></span><span> </span><span id="local-6989586621679403926"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;resultTag&quot; ':= PResultTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679403926"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><a href="Agora.Proposal.html#PAdvanceProposal"><span class="hs-identifier hs-type">PAdvanceProposal</span></a></span><span> </span><span id="local-6989586621679403924"><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><a href="#local-6989586621679403924"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/1v7fbvqpp06pvnwc34lj43v8axg7yqwd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span></pre></body></html>