<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Module     : Agora.Stake.Scripts
Maintainer : emi@haskell.fyi
Description: Plutus Scripts for Stakes.

Plutus Scripts for Stakes.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agora.Stake.Scripts</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier">stakePolicy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Stake.Scripts.html#stakeValidator"><span class="hs-identifier">stakeValidator</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.SafeMoney.html"><span class="hs-identifier">Agora.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier">GTTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Stake.html"><span class="hs-identifier">Agora.Stake</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Utils.html"><span class="hs-identifier">Agora.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier">mustBePJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier">mustFindDatum'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pvalidatorHashToTokenName"><span class="hs-identifier">pvalidatorHashToTokenName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kkgdz1wxscdc4vv72bln4vqrkirp71nq-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier">Data.Tagged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/kkgdz1wxscdc4vv72bln4vqrkirp71nq-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier">Tagged</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kkgdz1wxscdc4vv72bln4vqrkirp71nq-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier">untag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">AmountGuarantees</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Positive</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PCredential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PPubKeyCredential</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptCredential</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMinting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PSpending</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTokenName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTxInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mintingPolicySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mkMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">passetClassValueOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pvalueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Api.V1.ScriptContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pfindTxInByTxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pisTokenSpent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">ptxSignedBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pvalueSpent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-string">&quot;liqwid-plutarch-extra&quot;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pgeqByClass'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">pgeqBySymbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">psymbolValueOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.Record</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier">mkRecordConstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator">(.&amp;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">Plutarch.Extra.TermCont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pguardC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pletC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">pmatchC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier">ptryFromC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">punsafeCoerce</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier">Plutarch.Numeric.Additive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier">AdditiveMonoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier">zero</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier">AdditiveSemigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-operator">(+)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">Plutarch.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">pdiscreteValue'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier">pvalueDiscrete'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PlutusLedgerApi.V1.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier">Num</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{- | Policy for Stake state threads.

   == What this Policy does

   === For minting:

   - Check that exactly one state thread is minted.
   - Check that an output exists with a state thread and a valid datum.
   - Check that no state thread is an input.
   - assert @'PlutusLedgerApi.V1.TokenName' == 'PlutusLedgerApi.V1.ValidatorHash'@
     of the script that we pay to.

   === For burning:

   - Check that exactly one state thread is burned.
   - Check that datum at state thread is valid and not locked.

   @since 0.1.0
-}</span><span>
</span><span id="line-63"></span><span class="annot"><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier hs-type">stakePolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-comment">-- | The (governance) token that a Stake can store.</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="../file:///nix/store/kkgdz1wxscdc4vv72bln4vqrkirp71nq-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier hs-type">Tagged</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMintingPolicy</span></a></span><span>
</span><span id="line-67"></span><span id="stakePolicy"><span class="annot"><span class="annottext">stakePolicy :: Tagged @Type GTTag AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier hs-var hs-var">stakePolicy</span></a></span></span><span> </span><span id="local-6989586621679554345"><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass
</span><a href="#local-6989586621679554345"><span class="hs-identifier hs-var">gtClassRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PMintingPolicy)
-&gt; (Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679554343"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679554343"><span class="hs-identifier hs-var">_redeemer</span></a></span></span><span> </span><span id="local-6989586621679554342"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679554342"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621679554340"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679554340"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PScriptContext)
       (Bindings
          (PFields PScriptContext)
          ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PScriptContext)
        (Bindings
           (PFields PScriptContext)
           ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PScriptContext)
            (Bindings
               (PFields PScriptContext)
               ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PScriptContext)
          (Bindings
             (PFields PScriptContext)
             ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679554342"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621679554337"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679554337"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo))
-&gt; Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679554340"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679554336"><span class="hs-identifier hs-type">_a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PTxInfo</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span id="local-6989586621679554336"><span class="annot"><span class="annottext">_a :: Term s PTxInfo
</span><a href="#local-6989586621679554336"><span class="hs-identifier hs-var hs-var">_a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679554337"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679554335"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;signatories&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;datums&quot;,
                   Term
                     s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                 ('[] @(Symbol, Type)))))))
</span><a href="#local-6989586621679554335"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
       ((':)
          @(Symbol, Type)
          '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
          ((':)
             @(Symbol, Type)
             '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
             ((':)
                @(Symbol, Type)
                '(&quot;signatories&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                ((':)
                   @(Symbol, Type)
                   '(&quot;datums&quot;,
                     Term
                       s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                   ('[] @(Symbol, Type)))))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;signatories&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;datums&quot;,
                         Term
                           s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                       ('[] @(Symbol, Type))))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
        ((':)
           @(Symbol, Type)
           '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
           ((':)
              @(Symbol, Type)
              '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
              ((':)
                 @(Symbol, Type)
                 '(&quot;signatories&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;datums&quot;,
                      Term
                        s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                    ('[] @(Symbol, Type)))))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
            ((':)
               @(Symbol, Type)
               '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
               ((':)
                  @(Symbol, Type)
                  '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                  ((':)
                     @(Symbol, Type)
                     '(&quot;signatories&quot;,
                       Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                     ((':)
                        @(Symbol, Type)
                        '(&quot;datums&quot;,
                          Term
                            s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                        ('[] @(Symbol, Type)))))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
          ((':)
             @(Symbol, Type)
             '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
             ((':)
                @(Symbol, Type)
                '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                ((':)
                   @(Symbol, Type)
                   '(&quot;signatories&quot;,
                     Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                   ((':)
                      @(Symbol, Type)
                      '(&quot;datums&quot;,
                        Term
                          s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                      ('[] @(Symbol, Type)))))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
           ((':)
              @(Symbol, Type)
              '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
                 ((':)
                    @(Symbol, Type)
                    '(&quot;signatories&quot;,
                      Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
                    ((':)
                       @(Symbol, Type)
                       '(&quot;datums&quot;,
                         Term
                           s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                       ('[] @(Symbol, Type))))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;signatories&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679554337"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679554334"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679554334"><span class="hs-identifier hs-var">ownSymbol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679554340"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679554332"><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679554332"><span class="hs-identifier hs-var">ownSymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
-&gt; TermCont @POpaque s (Term s PCurrencySymbol)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PCurrencySymbol
 -&gt; TermCont @POpaque s (Term s PCurrencySymbol))
-&gt; Term s PCurrencySymbol
-&gt; TermCont @POpaque s (Term s PCurrencySymbol)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType))
   :--&gt; PCurrencySymbol)
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
-&gt; Term s PCurrencySymbol
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679554334"><span class="hs-identifier hs-var">ownSymbol'</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679554329"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554329"><span class="hs-identifier hs-var">spentST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679554332"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'Positive) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
forall (s :: S).
Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;signatories&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;datums&quot;,
                   Term
                     s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                 ('[] @(Symbol, Type)))))))
</span><a href="#local-6989586621679554335"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621679554327"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554327"><span class="hs-identifier hs-var">mintedST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679554332"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'NoGuarantees) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;signatories&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;datums&quot;,
                   Term
                     s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                 ('[] @(Symbol, Type)))))))
</span><a href="#local-6989586621679554335"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554326"><span class="annot"><span class="annottext">burning :: Term s POpaque
</span><a href="#local-6989586621679554326"><span class="hs-identifier hs-var hs-var">burning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-82"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554329"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST burned&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-85"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554327"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;An unlocked input existed containing an ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-88"></span><span>            </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxInInfo :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike list a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (list a :--&gt; PBool))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pany</span></a></span><span class="hs-cpp">
              # plam
</span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;resolved&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">txOut</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>                    </span><span class="hs-identifier">txOutF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;datumHash&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">txOut</span><span>
</span><span id="line-92"></span><span>                    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-93"></span><span>                      </span><span class="hs-identifier">pif</span><span>
</span><span id="line-94"></span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ownSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOutF</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">datum</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mustFindDatum'</span><span> </span><span class="hs-glyph">@</span><span class="hs-identifier">PStakeDatum</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txOutF</span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">txInfoF</span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-96"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">pnot</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stakeLocked</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">datum</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">pconstant</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                </span><span class="hs-special">)</span><span class="hs-cpp">
              # pfromData txInfoF.inputs
</span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554315"><span class="annot"><span class="annottext">minting :: Term s POpaque
</span><a href="#local-6989586621679554315"><span class="hs-identifier hs-var hs-var">minting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-106"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554329"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">0</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Minted ST must be exactly 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554327"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-112"></span><span>            </span><span class="annot"><span class="annottext">TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @PBool s (Term s PBool) -&gt; Term s PBool)
-&gt; TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554314"><span class="annot"><span class="annottext">scriptOutputWithStakeST :: Term s (PAsData PTxOut)
</span><a href="#local-6989586621679554314"><span class="hs-identifier hs-var hs-var">scriptOutputWithStakeST</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>                    </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span class="hs-cpp">
                      # &quot;Output to script not found&quot;
</span><span class="hs-cpp">                        #$ pfind
</span><span class="hs-cpp">                      # plam
</span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">output</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>                            </span><span class="hs-identifier">outputF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">output</span><span>
</span><span id="line-120"></span><span>                            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-121"></span><span>                              </span><span class="hs-identifier">pmatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;credential&quot;</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">outputF</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-122"></span><span>                                </span><span class="hs-comment">-- Should pay to a script address</span><span>
</span><span id="line-123"></span><span>                                </span><span class="hs-identifier">PPubKeyCredential</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PFalse</span><span>
</span><span id="line-124"></span><span>                                </span><span class="hs-identifier">PScriptCredential</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;_0&quot;</span><span> </span><span class="hs-operator">#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">validatorHash</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">tn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Term</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">PTokenName</span><span>
</span><span id="line-126"></span><span>                                      </span><span class="hs-identifier">tn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pvalidatorHashToTokenName</span><span> </span><span class="hs-identifier">validatorHash</span><span>
</span><span id="line-127"></span><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">pvalueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">outputF</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ownSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">tn</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-128"></span><span>                        </span><span class="hs-special">)</span><span class="hs-cpp">
                      # pfromData txInfoF.outputs
</span><span>
</span><span id="line-131"></span><span>              </span><span id="local-6989586621679554305"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':)
           @Symbol
           &quot;value&quot;
           ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
     s)
</span><a href="#local-6989586621679554305"><span class="hs-identifier hs-var">outputF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-132"></span><span>                </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields (PAsData PTxOut))
       (Bindings
          (PFields (PAsData PTxOut))
          ((':)
             @Symbol
             &quot;value&quot;
             ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
       s)
  -&gt; Term s PBool)
 -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':)
                 @Symbol
                 &quot;value&quot;
                 ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields (PAsData PTxOut))
        (Bindings
           (PFields (PAsData PTxOut))
           ((':)
              @Symbol
              &quot;value&quot;
              ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
        s)
   -&gt; Term s PBool)
  -&gt; Term s PBool)
 -&gt; TermCont
      @PBool
      s
      (HRec
         (BoundTerms
            (PFields (PAsData PTxOut))
            (Bindings
               (PFields (PAsData PTxOut))
               ((':)
                  @Symbol
                  &quot;value&quot;
                  ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields (PAsData PTxOut))
          (Bindings
             (PFields (PAsData PTxOut))
             ((':)
                @Symbol
                &quot;value&quot;
                ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
          s)
     -&gt; Term s PBool)
    -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        (BoundTerms
           (PFields (PAsData PTxOut))
           (Bindings
              (PFields (PAsData PTxOut))
              ((':)
                 @Symbol
                 &quot;value&quot;
                 ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-133"></span><span>                  </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datumHash&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679554314"><span class="hs-identifier hs-var">scriptOutputWithStakeST</span></a></span><span>
</span><span id="line-134"></span><span>              </span><span id="local-6989586621679554304"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679554304"><span class="hs-identifier hs-var">datumF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-135"></span><span>                </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
       ((':)
          @(Symbol, Type)
          '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
          ('[] @(Symbol, Type))))
  -&gt; Term s PBool)
 -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ('[] @(Symbol, Type)))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
        ((':)
           @(Symbol, Type)
           '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
           ('[] @(Symbol, Type))))
   -&gt; Term s PBool)
  -&gt; Term s PBool)
 -&gt; TermCont
      @PBool
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
            ((':)
               @(Symbol, Type)
               '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
               ('[] @(Symbol, Type))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
          ((':)
             @(Symbol, Type)
             '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
             ('[] @(Symbol, Type))))
     -&gt; Term s PBool)
    -&gt; Term s PBool)
-&gt; TermCont
     @PBool
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ('[] @(Symbol, Type)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-136"></span><span>                  </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum
 -&gt; (HRecOf
       PStakeDatum
       ((':) @Symbol &quot;owner&quot; ((':) @Symbol &quot;stakedAmount&quot; ('[] @Symbol)))
       s
     -&gt; Term s PBool)
 -&gt; Term s PBool)
-&gt; Term s PStakeDatum
-&gt; (HRecOf
      PStakeDatum
      ((':) @Symbol &quot;owner&quot; ((':) @Symbol &quot;stakedAmount&quot; ('[] @Symbol)))
      s
    -&gt; Term s PBool)
-&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-137"></span><span>                    </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; PStakeDatum))
-&gt; Term s (PMaybeData PDatumHash)
-&gt; Term
     s
     (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
      :--&gt; PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':)
           @Symbol
           &quot;value&quot;
           ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
     s)
</span><a href="#local-6989586621679554305"><span class="hs-identifier hs-var">outputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datumHash</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
   :--&gt; PStakeDatum)
-&gt; Term s (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))
-&gt; Term s PStakeDatum
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;inputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxInInfo))))
     ((':)
        @(Symbol, Type)
        '(&quot;outputs&quot;, Term s (PAsData (PBuiltinList (PAsData PTxOut))))
        ((':)
           @(Symbol, Type)
           '(&quot;mint&quot;, Term s (PAsData (PValue 'Sorted 'NoGuarantees)))
           ((':)
              @(Symbol, Type)
              '(&quot;signatories&quot;,
                Term s (PAsData (PBuiltinList (PAsData PPubKeyHash))))
              ((':)
                 @(Symbol, Type)
                 '(&quot;datums&quot;,
                   Term
                     s (PAsData (PBuiltinList (PAsData (PTuple PDatumHash PDatum)))))
                 ('[] @(Symbol, Type)))))))
</span><a href="#local-6989586621679554335"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">datums</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554303"><span class="annot"><span class="annottext">hasExpectedStake :: Term s PBool
</span><a href="#local-6989586621679554303"><span class="hs-identifier hs-var hs-var">hasExpectedStake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake ouput has expected amount of stake token&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-141"></span><span>                      </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
forall k (tag :: k) (keys :: KeyGuarantees)
       (amounts :: AmountGuarantees) (s :: S).
Tagged @k tag AssetClass
-&gt; Term s (PValue keys amounts :--&gt; PDiscrete @k tag)
</span><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier hs-var">pvalueDiscrete'</span></a></span><span> </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass
</span><a href="#local-6989586621679554345"><span class="hs-identifier hs-var">gtClassRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PDiscrete @Type GTTag)
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PDiscrete @Type GTTag)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields (PAsData PTxOut))
     (Bindings
        (PFields (PAsData PTxOut))
        ((':)
           @Symbol
           &quot;value&quot;
           ((':) @Symbol &quot;address&quot; ((':) @Symbol &quot;datumHash&quot; ('[] @Symbol)))))
     s)
</span><a href="#local-6989586621679554305"><span class="hs-identifier hs-var">outputF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ('[] @(Symbol, Type))))
</span><a href="#local-6989586621679554304"><span class="hs-identifier hs-var">datumF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-142"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554301"><span class="annot"><span class="annottext">ownerSignsTransaction :: Term s PBool
</span><a href="#local-6989586621679554301"><span class="hs-identifier hs-var hs-var">ownerSignsTransaction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake Owner should sign the transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool) -&gt; Term s PBool -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-144"></span><span>                      </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span class="hs-cpp">
                        # txInfoF.signatories
</span><span class="hs-cpp">                        # datumF.owner
</span><span>
</span><span id="line-148"></span><span>              </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @PBool s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679554303"><span class="hs-identifier hs-var">hasExpectedStake</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679554301"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (a :: PType).
Term s PBool -&gt; Term s a -&gt; Term s a -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
POrd t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679554327"><span class="hs-identifier hs-var">mintedST</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s POpaque
</span><a href="#local-6989586621679554315"><span class="hs-identifier hs-var">minting</span></a></span><span> </span><span class="annot"><span class="annottext">Term s POpaque
</span><a href="#local-6989586621679554326"><span class="hs-identifier hs-var">burning</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">{- | Validator intended for Stake UTXOs to be locked by.

     == What this Validator does:

     === 'DepositWithdraw'

     Deposit or withdraw some GT to the stake.

     - Tx must be signed by the owner.
     - The 'stakedAmount' field must be updated.
     - The stake must not be locked.
     - The new UTXO must have the previous value plus the difference
       as stated by the redeemer.

     === 'PermitVote'

     Allow a 'ProposalLock' to be put on the stake in order to vote
     on a proposal.

     - A proposal token must be spent alongside the stake.

       * Its total votes must be correctly updated to include this stake's
         contribution.

     - Tx must be signed by the owner.

     === 'RetractVotes'

     Remove a 'ProposalLock' set when voting on a proposal.

     - A proposal token must be spent alongside the stake.
     - Tx must be signed by the owner.

     === 'Destroy'

     Destroy the stake in order to reclaim the min ADA.

     - The stake must not be locked.
     - Tx must be signed by the owner.

     === 'WitnessStake'

     Allow this Stake to be included in a transaction without making
     any changes to it. In the future,
     this could use [CIP-31](https://cips.cardano.org/cips/cip31/) instead.

     - Tx must be signed by the owner __or__ a proposal ST token must be spent
       alongside the stake.
     - The datum and value must remain unchanged.

     @since 0.1.0
-}</span><span>
</span><span id="line-208"></span><span class="annot"><a href="Agora.Stake.Scripts.html#stakeValidator"><span class="hs-identifier hs-type">stakeValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidator</span></a></span><span>
</span><span id="line-209"></span><span id="stakeValidator"><span class="annot"><span class="annottext">stakeValidator :: Stake -&gt; ClosedTerm PValidator
</span><a href="Agora.Stake.Scripts.html#stakeValidator"><span class="hs-identifier hs-var hs-var">stakeValidator</span></a></span></span><span> </span><span id="local-6989586621679553813"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData
 -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData
  -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PValidator)
-&gt; (Term s PData
    -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679553812"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679553812"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679553811"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679553811"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span id="local-6989586621679553810"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679553810"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679553809"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679553809"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PScriptContext)
       (Bindings
          (PFields PScriptContext)
          ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PScriptContext)
        (Bindings
           (PFields PScriptContext)
           ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PScriptContext)
            (Bindings
               (PFields PScriptContext)
               ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PScriptContext)
          (Bindings
             (PFields PScriptContext)
             ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PScriptContext)
           (Bindings
              (PFields PScriptContext)
              ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679553810"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679553808"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679553808"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo))
-&gt; Term s PTxInfo -&gt; TermCont @POpaque s (Term s PTxInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679553809"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679553807"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679553807"><span class="hs-identifier hs-var">txInfoF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    (BoundTerms
       (PFields PTxInfo)
       (Bindings
          (PFields PTxInfo)
          ((':)
             @Symbol
             &quot;mint&quot;
             ((':)
                @Symbol
                &quot;inputs&quot;
                ((':)
                   @Symbol
                   &quot;outputs&quot;
                   ((':)
                      @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
       s)
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
           s))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     (BoundTerms
        (PFields PTxInfo)
        (Bindings
           (PFields PTxInfo)
           ((':)
              @Symbol
              &quot;mint&quot;
              ((':)
                 @Symbol
                 &quot;inputs&quot;
                 ((':)
                    @Symbol
                    &quot;outputs&quot;
                    ((':)
                       @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
        s)
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         (BoundTerms
            (PFields PTxInfo)
            (Bindings
               (PFields PTxInfo)
               ((':)
                  @Symbol
                  &quot;mint&quot;
                  ((':)
                     @Symbol
                     &quot;inputs&quot;
                     ((':)
                        @Symbol
                        &quot;outputs&quot;
                        ((':)
                           @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
            s)))
-&gt; ((HRec
       (BoundTerms
          (PFields PTxInfo)
          (Bindings
             (PFields PTxInfo)
             ((':)
                @Symbol
                &quot;mint&quot;
                ((':)
                   @Symbol
                   &quot;inputs&quot;
                   ((':)
                      @Symbol
                      &quot;outputs&quot;
                      ((':)
                         @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
          s)
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        (BoundTerms
           (PFields PTxInfo)
           (Bindings
              (PFields PTxInfo)
              ((':)
                 @Symbol
                 &quot;mint&quot;
                 ((':)
                    @Symbol
                    &quot;inputs&quot;
                    ((':)
                       @Symbol
                       &quot;outputs&quot;
                       ((':)
                          @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
           s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;signatories&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;datums&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679553808"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679553806"><span class="annot"><span class="annottext">Term s PStakeRedeemer
</span><a href="#local-6989586621679553806"><span class="hs-identifier hs-var">stakeRedeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduce @Type (PTryFromExcess PData (PAsData PStakeRedeemer) s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PData
-&gt; TermCont
     @POpaque
     s
     (Term s (PAsData PStakeRedeemer),
      Reduce @Type (PTryFromExcess PData (PAsData PStakeRedeemer) s))
forall (b :: PType) (r :: PType) (a :: PType) (s :: S).
PTryFrom a b =&gt;
Term s a
-&gt; TermCont @r s (Term s b, Reduce @Type (PTryFromExcess a b s))
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">ptryFromC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679553811"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-comment">-- TODO: Use PTryFrom</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679553805"><span class="hs-identifier hs-type">stakeDatum'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621679553805"><span class="annot"><span class="annottext">stakeDatum' :: Term s PStakeDatum
</span><a href="#local-6989586621679553805"><span class="hs-identifier hs-var hs-var">stakeDatum'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum)
-&gt; Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData -&gt; Term s (PAsData PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType). Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">punsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679553812"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621679553803"><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((HRec
    ((':)
       @(Symbol, Type)
       '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
       ((':)
          @(Symbol, Type)
          '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
          ((':)
             @(Symbol, Type)
             '(&quot;lockedBy&quot;,
               Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
             ('[] @(Symbol, Type)))))
  -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ((':)
                 @(Symbol, Type)
                 '(&quot;lockedBy&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                 ('[] @(Symbol, Type))))))
forall a (s :: S) (r :: PType).
((a -&gt; Term s r) -&gt; Term s r) -&gt; TermCont @r s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">tcont</span></a></span><span> </span><span class="annot"><span class="annottext">(((HRec
     ((':)
        @(Symbol, Type)
        '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
        ((':)
           @(Symbol, Type)
           '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
           ((':)
              @(Symbol, Type)
              '(&quot;lockedBy&quot;,
                Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
              ('[] @(Symbol, Type)))))
   -&gt; Term s POpaque)
  -&gt; Term s POpaque)
 -&gt; TermCont
      @POpaque
      s
      (HRec
         ((':)
            @(Symbol, Type)
            '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
            ((':)
               @(Symbol, Type)
               '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
               ((':)
                  @(Symbol, Type)
                  '(&quot;lockedBy&quot;,
                    Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                  ('[] @(Symbol, Type)))))))
-&gt; ((HRec
       ((':)
          @(Symbol, Type)
          '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
          ((':)
             @(Symbol, Type)
             '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
             ((':)
                @(Symbol, Type)
                '(&quot;lockedBy&quot;,
                  Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                ('[] @(Symbol, Type)))))
     -&gt; Term s POpaque)
    -&gt; Term s POpaque)
-&gt; TermCont
     @POpaque
     s
     (HRec
        ((':)
           @(Symbol, Type)
           '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
           ((':)
              @(Symbol, Type)
              '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
              ((':)
                 @(Symbol, Type)
                 '(&quot;lockedBy&quot;,
                   Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
                 ('[] @(Symbol, Type))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRecOf a fs s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553805"><span class="hs-identifier hs-var">stakeDatum'</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PSpending</span></a></span><span> </span><span id="local-6989586621679553802"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
</span><a href="#local-6989586621679553802"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s))
-&gt; Term s PScriptPurpose -&gt; TermCont @POpaque s (PScriptPurpose s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679553809"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PJust</span></a></span><span> </span><span id="local-6989586621679553800"><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679553800"><span class="hs-identifier hs-var">txInInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe PTxInInfo)
-&gt; TermCont @POpaque s (PMaybe PTxInInfo s)
forall {r :: PType} (a :: PType) (s :: S).
PMatch a =&gt;
Term s a -&gt; TermCont @r s (a s)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pmatchC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMaybe PTxInInfo)
 -&gt; TermCont @POpaque s (PMaybe PTxInInfo s))
-&gt; Term s (PMaybe PTxInInfo)
-&gt; TermCont @POpaque s (PMaybe PTxInInfo s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
forall (s :: S).
Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pfindTxInByTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxOutRef
   :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo))
-&gt; Term s PTxOutRef
-&gt; Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType))
   :--&gt; PTxOutRef)
-&gt; Term
     s
     (PDataRecord
        ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
-&gt; Term s PTxOutRef
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
</span><a href="#local-6989586621679553802"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PTxInInfo) :--&gt; PMaybe PTxInInfo)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679553807"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679553799"><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
           (PFields (PAsData PTxOut)))))
</span><a href="#local-6989586621679553799"><span class="hs-identifier hs-var">ownAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
           (PFields (PAsData PTxOut)))))
-&gt; TermCont
     @POpaque
     s
     (Term
        s
        (PAsData
           (PUnLabel
              (IndexList
                 @PLabeledType
                 (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                 (PFields (PAsData PTxOut))))))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PAsData
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
            (PFields (PAsData PTxOut)))))
 -&gt; TermCont
      @POpaque
      s
      (Term
         s
         (PAsData
            (PUnLabel
               (IndexList
                  @PLabeledType
                  (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                  (PFields (PAsData PTxOut)))))))
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
              (PFields (PAsData PTxOut)))))
-&gt; TermCont
     @POpaque
     s
     (Term
        s
        (PAsData
           (PUnLabel
              (IndexList
                 @PLabeledType
                 (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                 (PFields (PAsData PTxOut))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PTxOut
   :--&gt; PAsData
          (PUnLabel
             (IndexList
                @PLabeledType
                (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                (PFields (PAsData PTxOut)))))
-&gt; Term s (PAsData PTxOut)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
              (PFields (PAsData PTxOut)))))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInInfo :--&gt; PAsData PTxOut)
-&gt; Term s PTxInInfo -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679553800"><span class="hs-identifier hs-var">txInInfo</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679553798"><span class="hs-identifier hs-type">continuingValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValue</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621679553798"><span class="annot"><span class="annottext">continuingValue :: Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553798"><span class="hs-identifier hs-var hs-var">continuingValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PAsData PTxOut) -&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInInfo :--&gt; PAsData PTxOut)
-&gt; Term s PTxInInfo -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679553800"><span class="hs-identifier hs-var">txInInfo</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- Whether the owner signs this transaction or not.</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679553777"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PPubKeyHash)
   :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
-&gt; Term s (PBuiltinList (PAsData PPubKeyHash))
-&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679553807"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">signatories</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; Term s (PAsData PPubKeyHash) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679553776"><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679553776"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
-&gt; TermCont @POpaque s (Term s PCurrencySymbol)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PCurrencySymbol
 -&gt; TermCont @POpaque s (Term s PCurrencySymbol))
-&gt; Term s PCurrencySymbol
-&gt; TermCont @POpaque s (Term s PCurrencySymbol)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol)
-&gt; PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; CurrencySymbol)
-&gt; MintingPolicy -&gt; CurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Stake.Scripts.html#stakePolicy"><span class="hs-identifier hs-var">stakePolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679553774"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553774"><span class="hs-identifier hs-var">mintedST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679553776"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'NoGuarantees :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'NoGuarantees) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679553807"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679553773"><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553773"><span class="hs-identifier hs-var">valueSpent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PValue 'Sorted 'Positive)
 -&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive)))
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
forall (s :: S).
Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PBuiltinList (PAsData PTxInInfo) :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PBuiltinList (PAsData PTxInInfo))
-&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PTxInfo)
     (Bindings
        (PFields PTxInfo)
        ((':)
           @Symbol
           &quot;mint&quot;
           ((':)
              @Symbol
              &quot;inputs&quot;
              ((':)
                 @Symbol
                 &quot;outputs&quot;
                 ((':)
                    @Symbol &quot;signatories&quot; ((':) @Symbol &quot;datums&quot; ('[] @Symbol)))))))
     s)
</span><a href="#local-6989586621679553807"><span class="hs-identifier hs-var">txInfoF</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">inputs</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679553772"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553772"><span class="hs-identifier hs-var">spentST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s (PCurrencySymbol :--&gt; (PValue keys amounts :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol :--&gt; (PValue 'Sorted 'Positive :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol
-&gt; Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679553776"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive :--&gt; PInteger @S)
-&gt; Term s (PValue 'Sorted 'Positive) -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553773"><span class="hs-identifier hs-var">valueSpent</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679553771"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679553771"><span class="hs-identifier hs-var">propCs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553770"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679553770"><span class="hs-identifier hs-var">propTn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalSTClass</span><span>
</span><span id="line-238"></span><span>        </span><span id="local-6989586621679553769"><span class="annot"><span class="annottext">proposalSTClass :: Term s PAssetClass
</span><a href="#local-6989586621679553769"><span class="hs-identifier hs-var hs-var">proposalSTClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClass</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTokenName :--&gt; PAssetClass)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679553771"><span class="hs-identifier hs-var">propCs</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTokenName :--&gt; PAssetClass)
-&gt; Term s PTokenName -&gt; Term s PAssetClass
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName -&gt; Term s PTokenName
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName
TokenName
</span><a href="#local-6989586621679553770"><span class="hs-identifier hs-var">propTn</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679553768"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553768"><span class="hs-identifier hs-var">spentProposalST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; TermCont @POpaque s (Term s (PInteger @S))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; TermCont @POpaque s (Term s (PInteger @S)))
-&gt; Term s (PInteger @S)
-&gt; TermCont @POpaque s (Term s (PInteger @S))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PValue 'Sorted 'Positive :--&gt; (PAssetClass :--&gt; PInteger @S))
forall (s :: S) (keys :: KeyGuarantees)
       (amounts :: AmountGuarantees).
Term s (PValue keys amounts :--&gt; (PAssetClass :--&gt; PInteger @S))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClassValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PValue 'Sorted 'Positive :--&gt; (PAssetClass :--&gt; PInteger @S))
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PAssetClass :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553773"><span class="hs-identifier hs-var">valueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAssetClass :--&gt; PInteger @S)
-&gt; Term s PAssetClass -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PAssetClass
</span><a href="#local-6989586621679553769"><span class="hs-identifier hs-var">proposalSTClass</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- Is the stake currently locked?</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679553767"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553767"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PStakeDatum :--&gt; PBool)
forall (s :: S). Term s (PStakeDatum :--&gt; PBool)
</span><a href="Agora.Stake.html#stakeLocked"><span class="hs-identifier hs-var">stakeLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PStakeDatum :--&gt; PBool)
-&gt; Term s PStakeDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553805"><span class="hs-identifier hs-var">stakeDatum'</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
</span><a href="#local-6989586621679553806"><span class="hs-identifier hs-var">stakeRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><a href="Agora.Stake.html#PDestroy"><span class="hs-identifier hs-type">PDestroy</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553772"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Should burn ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553774"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake unlocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553767"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-comment">-- Handle redeemers that require own stake output.</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">PStakeRedeemer s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>          </span><span class="hs-comment">-- Filter out own output with own address and PST.</span><span>
</span><span id="line-262"></span><span>          </span><span id="local-6989586621679553765"><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679553765"><span class="hs-identifier hs-var">ownOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PTxOut)
 -&gt; TermCont @POpaque s (Term s (PAsData PTxOut)))
-&gt; Term s (PAsData PTxOut)
-&gt; TermCont @POpaque s (Term s (PAsData PTxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-264"></span><span>              </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
forall (a :: PType) (s :: S).
Term s (PString @S :--&gt; (PMaybe a :--&gt; a))
</span><a href="Agora.Utils.html#mustBePJust"><span class="hs-identifier hs-var">mustBePJust</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s (PString @S :--&gt; (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut))
-&gt; Term s (PString @S)
-&gt; Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Own output should be present&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe (PAsData PTxOut) :--&gt; PAsData PTxOut)
-&gt; Term s (PMaybe (PAsData PTxOut)) -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  ((PAsData PTxOut :--&gt; PBool)
   :--&gt; (PBuiltinList (PAsData PTxOut) :--&gt; PMaybe (PAsData PTxOut)))
forall (l :: PType -&gt; PType) (a :: PType) (s :: S).
PIsListLike l a =&gt;
Term s ((a :--&gt; PBool) :--&gt; (l a :--&gt; PMaybe a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfind</span></a></span><span class="hs-cpp">
                # plam
</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">input</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTermCont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>                      </span><span class="hs-identifier">inputF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcont</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;value&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">input</span><span>
</span><span id="line-268"></span><span>                      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-269"></span><span>                        </span><span class="hs-identifier">inputF</span><span class="hs-operator">.</span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">ownAddress</span><span class="hs-cpp">
                          #&amp;&amp; psymbolValueOf # stCurrencySymbol # inputF.value #== 1
</span><span>                  </span><span class="hs-special">)</span><span class="hs-cpp">
                # pfromData txInfoF.outputs
</span><span>
</span><span id="line-274"></span><span>          </span><span id="local-6989586621679553762"><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553762"><span class="hs-identifier hs-var">stakeOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-275"></span><span>            </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum))
-&gt; Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-276"></span><span>              </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
(PIsData datum, PTryFrom PData (PAsData datum)) =&gt;
Term
  s
  (PMaybeData PDatumHash
   :--&gt; (PBuiltinList (PAsData (PTuple PDatumHash PDatum))
         :--&gt; datum))
</span><a href="Agora.Utils.html#mustFindDatum%27"><span class="hs-identifier hs-var">mustFindDatum'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span class="hs-cpp">
                # (pfield @&quot;datumHash&quot; # ownOutput)
</span><span class="hs-cpp">                # txInfoF.datums
</span><span>
</span><span id="line-280"></span><span>          </span><span id="local-6989586621679553761"><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553761"><span class="hs-identifier hs-var">ownOutputValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-281"></span><span>            </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PValue 'Sorted 'Positive)
 -&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive)))
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; TermCont @POpaque s (Term s (PValue 'Sorted 'Positive))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-282"></span><span>              </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut :--&gt; PValue 'Sorted 'Positive)
-&gt; Term s (PAsData PTxOut) -&gt; Term s (PValue 'Sorted 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut)
</span><a href="#local-6989586621679553765"><span class="hs-identifier hs-var">ownOutput</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>          </span><span id="local-6989586621679553760"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553760"><span class="hs-identifier hs-var">ownOutputValueUnchanged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-285"></span><span>            </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-286"></span><span>              </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PAsData (PValue 'Sorted 'Positive))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553798"><span class="hs-identifier hs-var">continuingValue</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PValue 'Sorted 'Positive))
-&gt; Term s (PAsData (PValue 'Sorted 'Positive)) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PAsData (PValue 'Sorted 'Positive))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553761"><span class="hs-identifier hs-var">ownOutputValue</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>          </span><span id="local-6989586621679553758"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553758"><span class="hs-identifier hs-var">stakeOutUnchanged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @POpaque s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-290"></span><span>              </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553762"><span class="hs-identifier hs-var">stakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum)
-&gt; Term s (PAsData PStakeDatum) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553805"><span class="hs-identifier hs-var">stakeDatum'</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>          </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-293"></span><span>            </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
</span><a href="#local-6989586621679553806"><span class="hs-identifier hs-var">stakeRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-294"></span><span>              </span><span class="annot"><a href="Agora.Stake.html#PRetractVotes"><span class="hs-identifier hs-type">PRetractVotes</span></a></span><span> </span><span id="local-6989586621679553756"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;locks&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679553756"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span>
</span><span id="line-296"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-297"></span><span>                  </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-300"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553772"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-comment">-- This puts trust into the Proposal. The Proposal must necessarily check</span><span>
</span><span id="line-303"></span><span>                </span><span class="hs-comment">-- that this is not abused.</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal ST spent&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-305"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553768"><span class="hs-identifier hs-var">spentProposalST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-308"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553755"><span class="annot"><span class="annottext">expectedLocks :: Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
</span><a href="#local-6989586621679553755"><span class="hs-identifier hs-var hs-var">expectedLocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;locks&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;locks&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
   :--&gt; PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;locks&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;locks&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679553756"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>                      </span><span id="local-6989586621679553754"><span class="annot"><span class="annottext">expectedDatum :: Term s PStakeDatum
</span><a href="#local-6989586621679553754"><span class="hs-identifier hs-var hs-var">expectedDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>                        </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-312"></span><span>                          </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-313"></span><span>                          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-314"></span><span>                              </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-315"></span><span>                              </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
</span><a href="#local-6989586621679553755"><span class="hs-identifier hs-var">expectedLocks</span></a></span><span>
</span><span id="line-316"></span><span>                          </span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>                      </span><span id="local-6989586621679553752"><span class="annot"><span class="annottext">valueCorrect :: Term s PBool
</span><a href="#local-6989586621679553752"><span class="hs-identifier hs-var hs-var">valueCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553760"><span class="hs-identifier hs-var">ownOutputValueUnchanged</span></a></span><span>
</span><span id="line-319"></span><span>                      </span><span id="local-6989586621679553751"><span class="annot"><span class="annottext">outputDatumCorrect :: Term s PBool
</span><a href="#local-6989586621679553751"><span class="hs-identifier hs-var hs-var">outputDatumCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553762"><span class="hs-identifier hs-var">stakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553754"><span class="hs-identifier hs-var">expectedDatum</span></a></span><span>
</span><span id="line-320"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldl1</span></a></span><span>
</span><span id="line-321"></span><span>                        </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-322"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;valueCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553752"><span class="hs-identifier hs-var">valueCorrect</span></a></span><span>
</span><span id="line-323"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;datumCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553751"><span class="hs-identifier hs-var">outputDatumCorrect</span></a></span><span>
</span><span id="line-324"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-328"></span><span>              </span><span class="annot"><a href="Agora.Stake.html#PPermitVote"><span class="hs-identifier hs-type">PPermitVote</span></a></span><span> </span><span id="local-6989586621679553748"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;lock&quot; ':= PProposalLock) ('[] @PLabeledType)))
</span><a href="#local-6989586621679553748"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span>
</span><span id="line-330"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-331"></span><span>                  </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>                </span><span class="hs-comment">-- This puts trust into the Proposal. The Proposal must necessarily check</span><span>
</span><span id="line-334"></span><span>                </span><span class="hs-comment">-- that this is not abused.</span><span>
</span><span id="line-335"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Proposal ST spent&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-336"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553768"><span class="hs-identifier hs-var">spentProposalST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>                </span><span class="hs-comment">-- Update the stake datum, but only the 'lockedBy' field.</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- We actually don't know whether the given lock is valid or not.</span><span>
</span><span id="line-341"></span><span>                    </span><span class="hs-comment">-- This is checked in the proposal validator.</span><span>
</span><span id="line-342"></span><span>                    </span><span id="local-6989586621679553747"><span class="annot"><span class="annottext">newLock :: Term s (PAsData PProposalLock)
</span><a href="#local-6989586621679553747"><span class="hs-identifier hs-var hs-var">newLock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;lock&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;lock&quot; ':= PProposalLock) ('[] @PLabeledType))
   :--&gt; PAsData PProposalLock)
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType (&quot;lock&quot; ':= PProposalLock) ('[] @PLabeledType)))
-&gt; Term s (PAsData PProposalLock)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;lock&quot; ':= PProposalLock) ('[] @PLabeledType)))
</span><a href="#local-6989586621679553748"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-343"></span><span>                    </span><span class="hs-comment">-- Prepend the new lock to the existing locks.</span><span>
</span><span id="line-344"></span><span>                    </span><span id="local-6989586621679553746"><span class="annot"><span class="annottext">expectedLocks :: Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679553746"><span class="hs-identifier hs-var hs-var">expectedLocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PProposalLock
   :--&gt; (PBuiltinList (PAsData PProposalLock)
         :--&gt; PBuiltinList (PAsData PProposalLock)))
forall (list :: PType -&gt; PType) (a :: PType) (s :: S).
(PListLike list, PElemConstraint list a) =&gt;
Term s (a :--&gt; (list a :--&gt; list a))
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pcons</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PProposalLock
   :--&gt; (PBuiltinList (PAsData PProposalLock)
         :--&gt; PBuiltinList (PAsData PProposalLock)))
-&gt; Term s (PAsData PProposalLock)
-&gt; Term
     s
     (PBuiltinList (PAsData PProposalLock)
      :--&gt; PBuiltinList (PAsData PProposalLock))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PProposalLock)
</span><a href="#local-6989586621679553747"><span class="hs-identifier hs-var">newLock</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PBuiltinList (PAsData PProposalLock)
   :--&gt; PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lockedBy</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>                </span><span id="local-6989586621679553744"><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553744"><span class="hs-identifier hs-var">expectedDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-347"></span><span>                  </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum))
-&gt; Term s PStakeDatum -&gt; TermCont @POpaque s (Term s PStakeDatum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-348"></span><span>                    </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-349"></span><span>                      </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-350"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-351"></span><span>                          </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-352"></span><span>                          </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679553746"><span class="hs-identifier hs-var">expectedLocks</span></a></span><span>
</span><span id="line-353"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-356"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553743"><span class="annot"><span class="annottext">correctOutputDatum :: Term s PBool
</span><a href="#local-6989586621679553743"><span class="hs-identifier hs-var hs-var">correctOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553762"><span class="hs-identifier hs-var">stakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553744"><span class="hs-identifier hs-var">expectedDatum</span></a></span><span>
</span><span id="line-357"></span><span>                      </span><span id="local-6989586621679553742"><span class="annot"><span class="annottext">valueCorrect :: Term s PBool
</span><a href="#local-6989586621679553742"><span class="hs-identifier hs-var hs-var">valueCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553760"><span class="hs-identifier hs-var">ownOutputValueUnchanged</span></a></span><span>
</span><span id="line-358"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldl1</span></a></span><span>
</span><span id="line-359"></span><span>                        </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-360"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;valueCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553742"><span class="hs-identifier hs-var">valueCorrect</span></a></span><span>
</span><span id="line-361"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;datumCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553743"><span class="hs-identifier hs-var">correctOutputDatum</span></a></span><span>
</span><span id="line-362"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>                </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>              </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-366"></span><span>              </span><span class="annot"><a href="Agora.Stake.html#PWitnessStake"><span class="hs-identifier hs-type">PWitnessStake</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-368"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553772"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679553740"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679553740"><span class="hs-identifier hs-var">propCs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553739"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679553739"><span class="hs-identifier hs-var">propTn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">proposalSTClass</span><span>
</span><span id="line-371"></span><span>                    </span><span id="local-6989586621679553738"><span class="annot"><span class="annottext">propAssetClass :: Term s PAssetClass
</span><a href="#local-6989586621679553738"><span class="hs-identifier hs-var hs-var">propAssetClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">passetClass</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PTokenName :--&gt; PAssetClass))
-&gt; Term s PCurrencySymbol -&gt; Term s (PTokenName :--&gt; PAssetClass)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol
CurrencySymbol
</span><a href="#local-6989586621679553740"><span class="hs-identifier hs-var">propCs</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTokenName :--&gt; PAssetClass)
-&gt; Term s PTokenName -&gt; Term s PAssetClass
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName -&gt; Term s PTokenName
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PTokenName
TokenName
</span><a href="#local-6989586621679553739"><span class="hs-identifier hs-var">propTn</span></a></span><span>
</span><span id="line-372"></span><span>                    </span><span id="local-6989586621679553737"><span class="annot"><span class="annottext">proposalTokenMoved :: Term s PBool
</span><a href="#local-6989586621679553737"><span class="hs-identifier hs-var hs-var">proposalTokenMoved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>                      </span><span class="annot"><span class="annottext">Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
forall {s :: S}.
Term
  s (PAssetClass :--&gt; (PBuiltinList (PAsData PTxInInfo) :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pisTokenSpent</span></a></span><span class="hs-cpp">
                        # propAssetClass
</span><span class="hs-cpp">                        # txInfoF.inputs
</span><span>
</span><span id="line-377"></span><span>                </span><span class="hs-comment">-- In order for cosignature to be witnessed, it must be possible for a</span><span>
</span><span id="line-378"></span><span>                </span><span class="hs-comment">-- proposal to allow this transaction to happen. This puts trust into the Proposal.</span><span>
</span><span id="line-379"></span><span>                </span><span class="hs-comment">-- The Proposal must necessarily check that this is not abused.</span><span>
</span><span id="line-380"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span>
</span><span id="line-381"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction OR proposal token is spent&quot;</span></span><span>
</span><span id="line-382"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#||</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553737"><span class="hs-identifier hs-var">proposalTokenMoved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-385"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553735"><span class="annot"><span class="annottext">correctOutputDatum :: Term s PBool
</span><a href="#local-6989586621679553735"><span class="hs-identifier hs-var hs-var">correctOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553758"><span class="hs-identifier hs-var">stakeOutUnchanged</span></a></span><span>
</span><span id="line-386"></span><span>                      </span><span id="local-6989586621679553734"><span class="annot"><span class="annottext">valueCorrect :: Term s PBool
</span><a href="#local-6989586621679553734"><span class="hs-identifier hs-var hs-var">valueCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553760"><span class="hs-identifier hs-var">ownOutputValueUnchanged</span></a></span><span>
</span><span id="line-387"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldl1</span></a></span><span>
</span><span id="line-388"></span><span>                        </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-389"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;valueCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553734"><span class="hs-identifier hs-var">valueCorrect</span></a></span><span>
</span><span id="line-390"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;correctOutputDatum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553735"><span class="hs-identifier hs-var">correctOutputDatum</span></a></span><span>
</span><span id="line-391"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span>                </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>              </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-394"></span><span>              </span><span class="annot"><a href="Agora.Stake.html#PDepositWithdraw"><span class="hs-identifier hs-type">PDepositWithdraw</span></a></span><span> </span><span id="local-6989586621679553732"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;delta&quot; ':= PDiscrete @Type GTTag)
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679553732"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque)
-&gt; TermCont @POpaque s (Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-396"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679553772"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-397"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake unlocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-398"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553767"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span><span>
</span><span id="line-399"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span>
</span><span id="line-400"></span><span>                  </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-401"></span><span>                  </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553777"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-402"></span><span>                </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @POpaque s ())
-&gt; Term s PBool -&gt; TermCont @POpaque s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-403"></span><span>                  </span><span class="annot"><span class="annottext">TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall (a :: PType) (s :: S). TermCont @a s (Term s a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">unTermCont</span></a></span><span> </span><span class="annot"><span class="annottext">(TermCont @PBool s (Term s PBool) -&gt; Term s PBool)
-&gt; TermCont @PBool s (Term s PBool) -&gt; Term s PBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553731"><span class="annot"><span class="annottext">oldStakedAmount :: Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553731"><span class="hs-identifier hs-var hs-var">oldStakedAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PDiscrete @Type GTTag))
-&gt; Term s (PDiscrete @Type GTTag)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData (PDiscrete @Type GTTag))
 -&gt; Term s (PDiscrete @Type GTTag))
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; Term s (PDiscrete @Type GTTag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-405"></span><span>                        </span><span id="local-6989586621679553730"><span class="annot"><span class="annottext">delta :: Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553730"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData (PDiscrete @Type GTTag))
-&gt; Term s (PDiscrete @Type GTTag)
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData (PDiscrete @Type GTTag))
 -&gt; Term s (PDiscrete @Type GTTag))
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; Term s (PDiscrete @Type GTTag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;delta&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;delta&quot; ':= PDiscrete @Type GTTag)
        ('[] @PLabeledType))
   :--&gt; PAsData (PDiscrete @Type GTTag))
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;delta&quot; ':= PDiscrete @Type GTTag)
           ('[] @PLabeledType)))
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;delta&quot; ':= PDiscrete @Type GTTag)
        ('[] @PLabeledType)))
</span><a href="#local-6989586621679553732"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>                    </span><span id="local-6989586621679553729"><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553729"><span class="hs-identifier hs-var">newStakedAmount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; TermCont @PBool s (Term s (PDiscrete @Type GTTag))
forall {r :: PType} (s :: S) (a :: PType).
Term s a -&gt; TermCont @r s (Term s a)
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pletC</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PDiscrete @Type GTTag)
 -&gt; TermCont @PBool s (Term s (PDiscrete @Type GTTag)))
-&gt; Term s (PDiscrete @Type GTTag)
-&gt; TermCont @PBool s (Term s (PDiscrete @Type GTTag))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553731"><span class="hs-identifier hs-var">oldStakedAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s (PDiscrete @Type GTTag)
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553730"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>                    </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @PBool s ()
forall {r :: PType} (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; TermCont @r s ()
</span><a href="../file:///nix/store/x2hnvsjw6yhhcdfyc1lfi4f51izw6pvw-plutarch-extra-lib-plutarch-extra-1.1.0-haddock-doc/share/doc/plutarch-extra/html/src"><span class="hs-identifier hs-var">pguardC</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;New staked amount shoudl be greater than or equal to 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @PBool s ())
-&gt; Term s PBool -&gt; TermCont @PBool s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-410"></span><span>                      </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
forall a. AdditiveMonoid a =&gt; a
</span><a href="../file:///nix/store/xymxwxq5813q8dcwphnd0flk3q6vhlqk-plutarch-numeric-lib-plutarch-numeric-1.0.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s PBool
forall (t :: PType) (s :: S).
POrd t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553729"><span class="hs-identifier hs-var">newStakedAmount</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553727"><span class="annot"><span class="annottext">expectedDatum :: Term s PStakeDatum
</span><a href="#local-6989586621679553727"><span class="hs-identifier hs-var hs-var">expectedDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>                          </span><span class="annot"><span class="annottext">(forall (s' :: S).
 Term
   s'
   (PDataRecord
      ((':)
         @PLabeledType
         (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
         ((':)
            @PLabeledType
            (&quot;owner&quot; ':= PPubKeyHash)
            ((':)
               @PLabeledType
               (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
               ('[] @PLabeledType)))))
 -&gt; PStakeDatum s')
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
-&gt; Term s PStakeDatum
forall (r :: [PLabeledType]) (s :: S) (pt :: PType).
PlutusType pt =&gt;
(forall (s' :: S). Term s' (PDataRecord r) -&gt; pt s')
-&gt; RecordMorphism s ('[] @PLabeledType) r -&gt; Term s pt
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">mkRecordConstr</span></a></span><span>
</span><span id="line-414"></span><span>                            </span><span class="annot"><span class="annottext">forall (s' :: S).
Term
  s'
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType)))))
-&gt; PStakeDatum s'
</span><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span><span>
</span><span id="line-415"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
</span><span class="">#stakedAmount</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;stakedAmount&quot;
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
-&gt; Term s (PAsData (PDiscrete @Type GTTag))
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s a -&gt; Term s (PAsData a)
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pdata</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553729"><span class="hs-identifier hs-var">newStakedAmount</span></a></span><span>
</span><span id="line-416"></span><span>                                </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
  ((':)
     @PLabeledType
     (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType))))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;stakedAmount&quot; ':= PDiscrete @Type GTTag)
        ((':)
           @PLabeledType
           (&quot;owner&quot; ':= PPubKeyHash)
           ((':)
              @PLabeledType
              (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
              ('[] @PLabeledType))))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
</span><span class="">#owner</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;owner&quot;
-&gt; Term s (PAsData PPubKeyHash)
-&gt; RecordMorphism
     s
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-417"></span><span>                                </span><span class="annot"><span class="annottext">RecordMorphism
  s
  ((':)
     @PLabeledType
     (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
     ('[] @PLabeledType))
  ((':)
     @PLabeledType
     (&quot;owner&quot; ':= PPubKeyHash)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;owner&quot; ':= PPubKeyHash)
        ((':)
           @PLabeledType
           (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
           ('[] @PLabeledType)))
forall (s :: S) (a :: [PLabeledType]) (b :: [PLabeledType])
       (c :: [PLabeledType]).
RecordMorphism s b c
-&gt; RecordMorphism s a b -&gt; RecordMorphism s a c
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
</span><span class="">#lockedBy</span></span><span> </span><span class="annot"><span class="annottext">FieldName &quot;lockedBy&quot;
-&gt; Term s (PAsData (PBuiltinList (PAsData PProposalLock)))
-&gt; RecordMorphism
     s
     ('[] @PLabeledType)
     ((':)
        @PLabeledType
        (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
        ('[] @PLabeledType))
forall (sym :: Symbol) (a :: PType) (as :: [PLabeledType])
       (s :: S).
FieldName sym
-&gt; Term s (PAsData a)
-&gt; RecordMorphism s as ((':) @PLabeledType (sym ':= a) as)
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @(Symbol, Type)
     '(&quot;stakedAmount&quot;, Term s (PAsData (PDiscrete @Type GTTag)))
     ((':)
        @(Symbol, Type)
        '(&quot;owner&quot;, Term s (PAsData PPubKeyHash))
        ((':)
           @(Symbol, Type)
           '(&quot;lockedBy&quot;,
             Term s (PAsData (PBuiltinList (PAsData PProposalLock))))
           ('[] @(Symbol, Type)))))
</span><a href="#local-6989586621679553803"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lockedBy</span><span>
</span><span id="line-418"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>                        </span><span id="local-6989586621679553726"><span class="annot"><span class="annottext">datumCorrect :: Term s PBool
</span><a href="#local-6989586621679553726"><span class="hs-identifier hs-var hs-var">datumCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553762"><span class="hs-identifier hs-var">stakeOut</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum -&gt; Term s PStakeDatum -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679553727"><span class="hs-identifier hs-var">expectedDatum</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679553725"><span class="hs-identifier hs-type">valueDelta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValue</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Positive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                        </span><span id="local-6989586621679553725"><span class="annot"><span class="annottext">valueDelta :: Term s (PValue w 'Positive)
</span><a href="#local-6989586621679553725"><span class="hs-identifier hs-var hs-var">valueDelta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass
-&gt; Term s (PDiscrete @Type GTTag :--&gt; PValue w 'Positive)
forall tag (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Tagged @Type tag AssetClass
-&gt; Term s (PDiscrete @Type tag :--&gt; PValue keys amounts)
</span><a href="../file:///nix/store/w35d1vd5mcca7fnzkvd5nfpq8pga39ds-plutarch-safe-money-lib-plutarch-safe-money-1.0.0-haddock-doc/share/doc/plutarch-safe-money/html/src"><span class="hs-identifier hs-var">pdiscreteValue'</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag :--&gt; PValue w 'Positive)
-&gt; Term s (PDiscrete @Type GTTag) -&gt; Term s (PValue w 'Positive)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDiscrete @Type GTTag)
</span><a href="#local-6989586621679553730"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>                        </span><span id="local-6989586621679553723"><span class="annot"><span class="annottext">expectedValue :: Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553723"><span class="hs-identifier hs-var hs-var">expectedValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>                          </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
</span><a href="#local-6989586621679553798"><span class="hs-identifier hs-var">continuingValue</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PValue 'Sorted 'Positive)
-&gt; Term s (PValue 'Sorted 'Positive)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue 'Sorted 'Positive)
forall {w :: KeyGuarantees}. Term s (PValue w 'Positive)
</span><a href="#local-6989586621679553725"><span class="hs-identifier hs-var">valueDelta</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>                        </span><span id="local-6989586621679553722"><span class="annot"><span class="annottext">valueCorrect :: Term s PBool
</span><a href="#local-6989586621679553722"><span class="hs-identifier hs-var hs-var">valueCorrect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-428"></span><span>                          </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldr1</span></a></span><span>
</span><span id="line-429"></span><span>                            </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-430"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AssetClass
-&gt; Term
     s
     (PValue 'Sorted 'Positive
      :--&gt; (PValue 'Sorted 'Positive :--&gt; PBool))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
AssetClass
-&gt; Term
     s (PValue keys amounts :--&gt; (PValue keys amounts :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pgeqByClass'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><a href="../file:///nix/store/6ilca7icmqibgfqmnsl33jwlfyzd55gp-plutus-ledger-api-lib-plutus-ledger-api-1.0.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-var">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
                                # ownOutputValue
</span><span class="hs-cpp">                                # expectedValue
</span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetClass
-&gt; Term
     s
     (PValue 'Sorted 'Positive
      :--&gt; (PValue 'Sorted 'Positive :--&gt; PBool))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
AssetClass
-&gt; Term
     s (PValue keys amounts :--&gt; (PValue keys amounts :--&gt; PBool))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pgeqByClass'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tagged @Type GTTag AssetClass -&gt; AssetClass
forall {k} (s :: k) b. Tagged @k s b -&gt; b
</span><a href="../file:///nix/store/kkgdz1wxscdc4vv72bln4vqrkirp71nq-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier hs-var">untag</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679553813"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span class="hs-special">)</span><span class="hs-cpp">
                                # ownOutputValue
</span><span class="hs-cpp">                                # expectedValue
</span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PCurrencySymbol
   :--&gt; (PValue 'Sorted 'Positive
         :--&gt; (PValue 'Sorted 'Positive :--&gt; PBool)))
forall (keys :: KeyGuarantees) (amounts :: AmountGuarantees)
       (s :: S).
Term
  s
  (PCurrencySymbol
   :--&gt; (PValue keys amounts :--&gt; (PValue keys amounts :--&gt; PBool)))
</span><a href="../file:///nix/store/mxjlxldp3b6p6f6nad1amdwx3cimd4s4-liqwid-plutarch-extra-lib-liqwid-plutarch-extra-1.1.0-haddock-doc/share/doc/liqwid-plutarch-extra/html/src"><span class="hs-identifier hs-var">pgeqBySymbol</span></a></span><span class="hs-cpp">
                                # stCurrencySymbol
</span><span class="hs-cpp">                                # ownOutputValue
</span><span class="hs-cpp">                                # expectedValue
</span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>                    </span><span class="hs-comment">--</span><span>
</span><span id="line-442"></span><span>                    </span><span class="annot"><span class="annottext">Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; TermCont @PBool s (Term s PBool))
-&gt; Term s PBool -&gt; TermCont @PBool s (Term s PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-443"></span><span>                      </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s PBool -&gt; Term s PBool)
-&gt; [Term s PBool] -&gt; Term s PBool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">foldl1</span></a></span><span>
</span><span id="line-444"></span><span>                        </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S). Term s PBool -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">(#&amp;&amp;)</span></a></span><span>
</span><span id="line-445"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;valueCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553722"><span class="hs-identifier hs-var">valueCorrect</span></a></span><span>
</span><span id="line-446"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s PBool
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">ptraceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;datumCorrect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679553726"><span class="hs-identifier hs-var">datumCorrect</span></a></span><span>
</span><span id="line-447"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-448"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-449"></span><span>                </span><span class="annot"><span class="annottext">Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque))
-&gt; Term s POpaque -&gt; TermCont @POpaque s (Term s POpaque)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>              </span><span class="annot"><span class="annottext">PStakeRedeemer s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/bhji90x2v2q0fi8ya6w3sbvwcyh0r0lb-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-451"></span></pre></body></html>