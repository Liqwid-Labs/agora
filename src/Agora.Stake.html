<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{- |
Module     : Agora.Stake
Maintainer : emi@haskell.fyi
Description: Vote-lockable stake UTXOs holding GT.

Vote-lockable stake UTXOs holding GT.
-}</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agora.Stake</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier">PStakeDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier">PStakeRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier">StakeDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#StakeRedeemer"><span class="hs-identifier">StakeRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier">ProposalLock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier">PProposalLock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier">Stake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#stakePolicy"><span class="hs-identifier">stakePolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#stakeValidator"><span class="hs-identifier">stakeValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Agora.Stake.html#stakeLocked"><span class="hs-identifier">stakeLocked</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bbqlrh1y49319abxa4wk2wgr55mz53f1-generics-sop-lib-generics-sop-0.5.1.2-haddock-doc/share/doc/generics-sop/html/src"><span class="hs-identifier">Generics.SOP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bbqlrh1y49319abxa4wk2wgr55mz53f1-generics-sop-lib-generics-sop-0.5.1.2-haddock-doc/share/doc/generics-sop/html/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kc0wy15n7hfi7snlg75kqdy7jicnk63j-sop-core-lib-sop-core-0.5.0.2-haddock-doc/share/doc/sop-core/html/src"><span class="hs-identifier">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/kc0wy15n7hfi7snlg75kqdy7jicnk63j-sop-core-lib-sop-core-0.5.0.2-haddock-doc/share/doc/sop-core/html/src"><span class="hs-identifier">I</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier">Num</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V1.Ledger.Api</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">PubKeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2adk1nflfvfyyvgzzs451y9i03sf50a5-plutus-tx-lib-plutus-tx-0.1.0.0-haddock-doc/share/doc/plutus-tx/html/src"><span class="hs-identifier">PlutusTx</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">popaque</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Api.V1</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PCredential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PPubKeyCredential</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptCredential</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PPubKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PMinting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PSpending</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PTokenName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mintingPolicySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">mkMintingPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.DataRepr</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">DerivePConstantViaData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PDataFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PIsDataReprInstances</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PIsDataReprInstances</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">punsafeCoerce</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">PUnsafeLiftDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier">Plutarch.Monadic</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V1.Ledger.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier">AssetClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Proposal.html"><span class="hs-identifier">Agora.Proposal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Proposal.html#PProposalId"><span class="hs-identifier">PProposalId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#PResultTag"><span class="hs-identifier">PResultTag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#ProposalId"><span class="hs-identifier">ProposalId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agora.Proposal.html#ResultTag"><span class="hs-identifier">ResultTag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.SafeMoney.html"><span class="hs-identifier">Agora.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier">GTTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agora.Utils.html"><span class="hs-identifier">Agora.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#anyInput"><span class="hs-identifier">anyInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#anyOutput"><span class="hs-identifier">anyOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#paddValue"><span class="hs-identifier">paddValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#passert"><span class="hs-identifier">passert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pfindTxInByTxOutRef"><span class="hs-identifier">pfindTxInByTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pgeqByClass"><span class="hs-identifier">pgeqByClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pgeqByClass%27"><span class="hs-identifier">pgeqByClass'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pgeqBySymbol"><span class="hs-identifier">pgeqBySymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pnotNull"><span class="hs-identifier">pnotNull</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#psingletonValue"><span class="hs-identifier">psingletonValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier">psymbolValueOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#ptxSignedBy"><span class="hs-identifier">ptxSignedBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Agora.Utils.html#pvalueSpent"><span class="hs-identifier">pvalueSpent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/gjci1akcvwllmxx4y32j7s3m3sakf9ka-plutarch-numeric-lib-plutarch-numeric-1.0-haddock-doc/share/doc/plutarch-numeric/html/src"><span class="hs-identifier">Plutarch.Numeric</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/hdn2zzf6sqipbv8vkckda3xsrbmsp7nw-plutarch-safemoney-lib-plutarch-safemoney-0.3-haddock-doc/share/doc/plutarch-safemoney/html/src"><span class="hs-identifier">Plutarch.SafeMoney</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="../file:///nix/store/hdn2zzf6sqipbv8vkckda3xsrbmsp7nw-plutarch-safemoney-lib-plutarch-safemoney-0.3-haddock-doc/share/doc/plutarch-safemoney/html/src"><span class="hs-identifier">PDiscrete</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2bbdjr3sdyryx5y551a92axfpvafpc6-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier">Tagged</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="../file:///nix/store/hdn2zzf6sqipbv8vkckda3xsrbmsp7nw-plutarch-safemoney-lib-plutarch-safemoney-0.3-haddock-doc/share/doc/plutarch-safemoney/html/src"><span class="hs-identifier">pdiscreteValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="../file:///nix/store/x2bbdjr3sdyryx5y551a92axfpvafpc6-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier">untag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Parameters for creating Stake scripts.</span><span>
</span><span id="line-87"></span><span class="hs-keyword">newtype</span><span> </span><span id="Stake"><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stake"><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="gtClassRef"><span class="annot"><span class="annottext">Stake -&gt; Tagged @Type GTTag AssetClass
</span><a href="Agora.Stake.html#gtClassRef"><span class="hs-identifier hs-var hs-var">gtClassRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/x2bbdjr3sdyryx5y551a92axfpvafpc6-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier hs-type">Tagged</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">AssetClass</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- ^ Used when inlining the AssetClass of a 'PDiscrete' in the script code.</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">{- | A lock placed on a Stake datum in order to prevent
     depositing and withdrawing when votes are in place.

     NOTE: Due to retracting votes always being possible,
     this lock will only lock with contention on the proposal.

     FIXME: Contention on Proposals could create contention
     on voting which in turn creates contention on stakers.

     Vaguely this is the dependency graph for this locking
     interaction. Both the stake validator and the proposal
     validator are only able to check for one another through
     the datum belonging to the ST:

     @
     &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;   &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
     &#9474; Stake Validator &#9500;&#9472;&#9488; &#9474; Proposal Validator &#9474;
     &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496; &#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
              &#9474;          &#9474;        &#9474;     &#9474;
              &#9474;        &#9484;&#9472;&#9532;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;     &#9474;
              &#9660;        &#9474; &#9474;              &#9660;
     &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9474; &#9474; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
     &#9474; Stake Policy &#9474;&#9668;&#9472;&#9496; &#9492;&#9658;&#9474; Proposal Policy &#9474;
     &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
     @
-}</span><span>
</span><span id="line-118"></span><span id="local-6989586621679311043"><span id="local-6989586621679311044"></span></span><span class="hs-keyword">data</span><span> </span><span id="ProposalLock"><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-var">ProposalLock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProposalLock"><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-var">ProposalLock</span></a></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vote"><span class="annot"><span class="annottext">ProposalLock -&gt; ResultTag
</span><a href="Agora.Stake.html#vote"><span class="hs-identifier hs-var hs-var">vote</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Proposal.html#ResultTag"><span class="hs-identifier hs-type">ResultTag</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- ^ What was voted on. This allows retracting votes to</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-comment">--   undo their vote.</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="proposalId"><span class="annot"><span class="annottext">ProposalLock -&gt; ProposalId
</span><a href="Agora.Stake.html#proposalId"><span class="hs-identifier hs-var hs-var">proposalId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Proposal.html#ProposalId"><span class="hs-identifier hs-type">ProposalId</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-comment">-- ^ Identifies the proposal. See 'ProposalId' for further</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-comment">-- comments on its significance.</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679311028"><span id="local-6989586621679311030"><span id="local-6989586621679311038"><span class="annot"><span class="annottext">Int -&gt; ProposalLock -&gt; ShowS
[ProposalLock] -&gt; ShowS
ProposalLock -&gt; String
(Int -&gt; ProposalLock -&gt; ShowS)
-&gt; (ProposalLock -&gt; String)
-&gt; ([ProposalLock] -&gt; ShowS)
-&gt; Show ProposalLock
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ProposalLock] -&gt; ShowS
$cshowList :: [ProposalLock] -&gt; ShowS
show :: ProposalLock -&gt; String
$cshow :: ProposalLock -&gt; String
showsPrec :: Int -&gt; ProposalLock -&gt; ShowS
$cshowsPrec :: Int -&gt; ProposalLock -&gt; ShowS
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ProposalLock -&gt; Rep ProposalLock x)
-&gt; (forall x. Rep ProposalLock x -&gt; ProposalLock)
-&gt; Generic ProposalLock
forall x. Rep ProposalLock x -&gt; ProposalLock
forall x. ProposalLock -&gt; Rep ProposalLock x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ProposalLock x -&gt; ProposalLock
$cfrom :: forall x. ProposalLock -&gt; Rep ProposalLock x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621679311013"><span id="local-6989586621679311015"><span id="local-6989586621679311021"><span class="hs-identifier">PlutusTx.makeIsDataIndexed</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ProposalLock</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">ProposalLock</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Haskell-level redeemer for Stake scripts.</span><span>
</span><span id="line-131"></span><span id="local-6989586621679310949"><span id="local-6989586621679310950"></span></span><span class="hs-keyword">data</span><span> </span><span id="StakeRedeemer"><span class="annot"><a href="Agora.Stake.html#StakeRedeemer"><span class="hs-identifier hs-var">StakeRedeemer</span></a></span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Deposit or withdraw a discrete amount of the staked governance token.</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">--   Stake must be unlocked.</span><span>
</span><span id="line-134"></span><span>    </span><span id="DepositWithdraw"><span class="annot"><a href="Agora.Stake.html#DepositWithdraw"><span class="hs-identifier hs-var">DepositWithdraw</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/x2bbdjr3sdyryx5y551a92axfpvafpc6-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier hs-type">Tagged</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Destroy a stake, retrieving its LQ, the minimum ADA and any other assets.</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">--   Stake must be unlocked.</span><span>
</span><span id="line-137"></span><span>    </span><span id="Destroy"><span class="annot"><a href="Agora.Stake.html#Destroy"><span class="hs-identifier hs-var">Destroy</span></a></span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Permit a Vote to be added onto a 'Proposal'.</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">--   This also adds a lock to the 'lockedBy' field. See 'ProposalLock'.</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">--   This needs to be done in sync with casting a vote, otherwise</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">--   it's possible for a lock to be permanently placed on the stake,</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">--   and then the funds are lost.</span><span>
</span><span id="line-143"></span><span>    </span><span id="PermitVote"><span class="annot"><a href="Agora.Stake.html#PermitVote"><span class="hs-identifier hs-var">PermitVote</span></a></span></span><span> </span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Retract a vote, removing it from the 'lockedBy' field. See 'ProposalLock'.</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">--   This action checks for permission of the 'Proposal'. Finished proposals are</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">--   always allowed to have votes retracted and won't affect the Proposal datum,</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">--   allowing 'Stake's to be unlocked.</span><span>
</span><span id="line-148"></span><span>    </span><span id="RetractVotes"><span class="annot"><a href="Agora.Stake.html#RetractVotes"><span class="hs-identifier hs-var">RetractVotes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310930"><span id="local-6989586621679310932"><span id="local-6989586621679310943"><span class="annot"><span class="annottext">Int -&gt; StakeRedeemer -&gt; ShowS
[StakeRedeemer] -&gt; ShowS
StakeRedeemer -&gt; String
(Int -&gt; StakeRedeemer -&gt; ShowS)
-&gt; (StakeRedeemer -&gt; String)
-&gt; ([StakeRedeemer] -&gt; ShowS)
-&gt; Show StakeRedeemer
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StakeRedeemer] -&gt; ShowS
$cshowList :: [StakeRedeemer] -&gt; ShowS
show :: StakeRedeemer -&gt; String
$cshow :: StakeRedeemer -&gt; String
showsPrec :: Int -&gt; StakeRedeemer -&gt; ShowS
$cshowsPrec :: Int -&gt; StakeRedeemer -&gt; ShowS
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. StakeRedeemer -&gt; Rep StakeRedeemer x)
-&gt; (forall x. Rep StakeRedeemer x -&gt; StakeRedeemer)
-&gt; Generic StakeRedeemer
forall x. Rep StakeRedeemer x -&gt; StakeRedeemer
forall x. StakeRedeemer -&gt; Rep StakeRedeemer x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep StakeRedeemer x -&gt; StakeRedeemer
$cfrom :: forall x. StakeRedeemer -&gt; Rep StakeRedeemer x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621679310914"><span id="local-6989586621679310916"><span id="local-6989586621679310924"><span class="hs-identifier">PlutusTx.makeIsDataIndexed</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">''</span><span class="hs-identifier">StakeRedeemer</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">DepositWithdraw</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">Destroy</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">PermitVote</span><span class="hs-special">,</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">RetractVotes</span><span class="hs-special">,</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Haskell-level datum for Stake scripts.</span><span>
</span><span id="line-160"></span><span id="local-6989586621679310845"><span id="local-6989586621679310846"></span></span><span class="hs-keyword">data</span><span> </span><span id="StakeDatum"><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier hs-var">StakeDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StakeDatum"><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier hs-var">StakeDatum</span></a></span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stakedAmount"><span class="annot"><span class="annottext">StakeDatum -&gt; Tagged @Type GTTag BuiltinInteger
</span><a href="Agora.Stake.html#stakedAmount"><span class="hs-identifier hs-var hs-var">stakedAmount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/x2bbdjr3sdyryx5y551a92axfpvafpc6-tagged-lib-tagged-0.8.6.1-haddock-doc/share/doc/tagged/html/src"><span class="hs-identifier hs-type">Tagged</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/ghc-bignum-1.2/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">-- ^ Tracks the amount of governance token staked in the datum.</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">-- This also acts as the voting weight for 'Proposal's.</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="owner"><span class="annot"><span class="annottext">StakeDatum -&gt; PubKeyHash
</span><a href="Agora.Stake.html#owner"><span class="hs-identifier hs-var hs-var">owner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/56s38y8krq5sxnvf6xk7nj5vchvg5gay-plutus-ledger-api-lib-plutus-ledger-api-0.1.0.0-haddock-doc/share/doc/plutus-ledger-api/html/src"><span class="hs-identifier hs-type">PubKeyHash</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- ^ The hash of the public key this stake belongs to.</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- TODO Support for MultiSig/Scripts is tracked here:</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-comment">--      https://github.com/Liqwid-Labs/agora/issues/45</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="lockedBy"><span class="annot"><span class="annottext">StakeDatum -&gt; [ProposalLock]
</span><a href="Agora.Stake.html#lockedBy"><span class="hs-identifier hs-var hs-var">lockedBy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-comment">-- ^ The current proposals locking this stake. This field must be empty</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-comment">-- for the stake to be usable for deposits and withdrawals.</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310828"><span id="local-6989586621679310830"><span id="local-6989586621679310839"><span class="annot"><span class="annottext">Int -&gt; StakeDatum -&gt; ShowS
[StakeDatum] -&gt; ShowS
StakeDatum -&gt; String
(Int -&gt; StakeDatum -&gt; ShowS)
-&gt; (StakeDatum -&gt; String)
-&gt; ([StakeDatum] -&gt; ShowS)
-&gt; Show StakeDatum
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StakeDatum] -&gt; ShowS
$cshowList :: [StakeDatum] -&gt; ShowS
show :: StakeDatum -&gt; String
$cshow :: StakeDatum -&gt; String
showsPrec :: Int -&gt; StakeDatum -&gt; ShowS
$cshowsPrec :: Int -&gt; StakeDatum -&gt; ShowS
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. StakeDatum -&gt; Rep StakeDatum x)
-&gt; (forall x. Rep StakeDatum x -&gt; StakeDatum) -&gt; Generic StakeDatum
forall x. Rep StakeDatum x -&gt; StakeDatum
forall x. StakeDatum -&gt; Rep StakeDatum x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep StakeDatum x -&gt; StakeDatum
$cfrom :: forall x. StakeDatum -&gt; Rep StakeDatum x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621679310813"><span id="local-6989586621679310815"><span id="local-6989586621679310823"><span class="hs-identifier">PlutusTx.makeIsDataIndexed</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">StakeDatum</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">StakeDatum</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- | Plutarch-level datum for Stake scripts.</span><span>
</span><span id="line-180"></span><span id="local-6989586621679310763"><span id="local-6989586621679310764"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PStakeDatum"><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679312243"><span class="annot"><a href="#local-6989586621679312243"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">S</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PStakeDatum"><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-var">PStakeDatum</span></a></span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="getStakeDatum"><span class="annot"><span class="annottext">forall (s :: S).
PStakeDatum s
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;stakedAmount&quot; ':= PDiscrete GTTag)
           ((':)
              @PLabeledType
              (&quot;owner&quot; ':= PPubKeyHash)
              ((':)
                 @PLabeledType
                 (&quot;lockedBy&quot; ':= PBuiltinList (PAsData PProposalLock))
                 ('[] @PLabeledType)))))
</span><a href="Agora.Stake.html#getStakeDatum"><span class="hs-identifier hs-var hs-var">getStakeDatum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><a href="#local-6989586621679312243"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="../file:///nix/store/hdn2zzf6sqipbv8vkckda3xsrbmsp7nw-plutarch-safemoney-lib-plutarch-safemoney-0.3-haddock-doc/share/doc/plutarch-safemoney/html/src"><span class="hs-identifier hs-type">PDiscrete</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span>
</span><span id="line-186"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PPubKeyHash</span></a></span><span>
</span><span id="line-187"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBuiltinList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. PStakeDatum s -&gt; Rep (PStakeDatum s) x)
-&gt; (forall x. Rep (PStakeDatum s) x -&gt; PStakeDatum s)
-&gt; Generic (PStakeDatum s)
forall x. Rep (PStakeDatum s) x -&gt; PStakeDatum s
forall x. PStakeDatum s -&gt; Rep (PStakeDatum s) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (s :: S) x. Rep (PStakeDatum s) x -&gt; PStakeDatum s
forall (s :: S) x. PStakeDatum s -&gt; Rep (PStakeDatum s) x
$cto :: forall (s :: S) x. Rep (PStakeDatum s) x -&gt; PStakeDatum s
$cfrom :: forall (s :: S) x. PStakeDatum s -&gt; Rep (PStakeDatum s) x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310752"><span id="local-6989586621679310754"><span class="annot"><span class="annottext">All @[Type] (SListI @Type) (Code (PStakeDatum s))
All @[Type] (SListI @Type) (Code (PStakeDatum s))
-&gt; (PStakeDatum s -&gt; Rep (PStakeDatum s))
-&gt; (Rep (PStakeDatum s) -&gt; PStakeDatum s)
-&gt; Generic (PStakeDatum s)
Rep (PStakeDatum s) -&gt; PStakeDatum s
PStakeDatum s -&gt; Rep (PStakeDatum s)
forall a.
All @[Type] (SListI @Type) (Code a)
-&gt; (a -&gt; Rep a) -&gt; (Rep a -&gt; a) -&gt; Generic a
forall {s :: S}. All @[Type] (SListI @Type) (Code (PStakeDatum s))
forall (s :: S). Rep (PStakeDatum s) -&gt; PStakeDatum s
forall (s :: S). PStakeDatum s -&gt; Rep (PStakeDatum s)
to :: Rep (PStakeDatum s) -&gt; PStakeDatum s
$cto :: forall (s :: S). Rep (PStakeDatum s) -&gt; PStakeDatum s
from :: PStakeDatum s -&gt; Rep (PStakeDatum s)
$cfrom :: forall (s :: S). PStakeDatum s -&gt; Rep (PStakeDatum s)
</span><a href="../file:///nix/store/bbqlrh1y49319abxa4wk2wgr55mz53f1-generics-sop-lib-generics-sop-0.5.1.2-haddock-doc/share/doc/generics-sop/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310736"><span id="local-6989586621679310738"><span class="annot"><span class="annottext">PIsData PStakeDatum
PMatch PStakeDatum
PMatch PStakeDatum
-&gt; PIsData PStakeDatum
-&gt; (forall (s :: S).
    PStakeDatum s -&gt; Term s (PDataSum (PIsDataReprRepr PStakeDatum)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr PStakeDatum))
    -&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr PStakeDatum
forall (s :: S).
PStakeDatum s -&gt; Term s (PDataSum (PIsDataReprRepr PStakeDatum))
forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeDatum))
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
forall (a :: PType).
PMatch a
-&gt; PIsData a
-&gt; (forall (s :: S). a s -&gt; Term s (PDataSum (PIsDataReprRepr a)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr a))
    -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr a
pmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeDatum))
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
$cpmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeDatum))
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
pconRepr :: forall (s :: S).
PStakeDatum s -&gt; Term s (PDataSum (PIsDataReprRepr PStakeDatum))
$cpconRepr :: forall (s :: S).
PStakeDatum s -&gt; Term s (PDataSum (PIsDataReprRepr PStakeDatum))
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PIsDataRepr</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679310718"><span id="local-6989586621679310725"><span class="annot"><span class="annottext">PCon PStakeDatum
PMatch PStakeDatum
PCon PStakeDatum
-&gt; PMatch PStakeDatum
-&gt; (forall (s :: S) (b :: PType).
    PStakeDatum s -&gt; Term s (PInner PStakeDatum b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner PStakeDatum b)
    -&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType PStakeDatum
forall (s :: S) (b :: PType).
Term s (PInner PStakeDatum b)
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
forall (s :: S) (b :: PType).
PStakeDatum s -&gt; Term s (PInner PStakeDatum b)
forall (a :: PType).
PCon a
-&gt; PMatch a
-&gt; (forall (s :: S) (b :: PType). a s -&gt; Term s (PInner a b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner a b) -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType a
pmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PStakeDatum b)
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
$cpmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PStakeDatum b)
-&gt; (PStakeDatum s -&gt; Term s b) -&gt; Term s b
pcon' :: forall (s :: S) (b :: PType).
PStakeDatum s -&gt; Term s (PInner PStakeDatum b)
$cpcon' :: forall (s :: S) (b :: PType).
PStakeDatum s -&gt; Term s (PInner PStakeDatum b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PlutusType</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310705"><span id="local-6989586621679310711"><span class="annot"><span class="annottext">(forall (s :: S).
 Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum)
-&gt; (forall (s :: S).
    Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum))
-&gt; PIsData PStakeDatum
forall (s :: S). Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
forall (s :: S). Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
forall (a :: PType).
(forall (s :: S). Term s (PAsData a) -&gt; Term s a)
-&gt; (forall (s :: S). Term s a -&gt; Term s (PAsData a)) -&gt; PIsData a
pdata :: forall (s :: S). Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
$cpdata :: forall (s :: S). Term s PStakeDatum -&gt; Term s (PAsData PStakeDatum)
pfromData :: forall (s :: S). Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
$cpfromData :: forall (s :: S). Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">PIsData</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310699"><span class="annot"><span class="annottext">(forall (s :: S).
 Term s PStakeDatum -&gt; Term s (PDataRecord (PFields PStakeDatum)))
-&gt; PDataFields PStakeDatum
forall (s :: S).
Term s PStakeDatum -&gt; Term s (PDataRecord (PFields PStakeDatum))
forall (a :: PType).
(forall (s :: S). Term s a -&gt; Term s (PDataRecord (PFields a)))
-&gt; PDataFields a
ptoFields :: forall (s :: S).
Term s PStakeDatum -&gt; Term s (PDataRecord (PFields PStakeDatum))
$cptoFields :: forall (s :: S).
Term s PStakeDatum -&gt; Term s (PDataRecord (PFields PStakeDatum))
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">PDataFields</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PIsDataReprInstances</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PUnsafeLiftDecl</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-keyword">type</span><span> </span><span id="PLifted"><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">PLifted</span></a></span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier hs-type">StakeDatum</span></a></span><span>
</span><span id="line-199"></span><span id="local-6989586621679310661"><span id="local-6989586621679310671"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">DerivePConstantViaData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier hs-type">StakeDatum</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PConstant</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeDatum"><span class="hs-identifier hs-type">StakeDatum</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | Plutarch-level redeemer for Stake scripts.</span><span>
</span><span id="line-202"></span><span id="local-6989586621679310648"><span id="local-6989586621679310649"></span></span><span class="hs-keyword">data</span><span> </span><span id="PStakeRedeemer"><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-var">PStakeRedeemer</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679312176"><span class="annot"><a href="#local-6989586621679312176"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">S</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Deposit or withdraw a discrete amount of the staked governance token.</span><span>
</span><span id="line-204"></span><span>    </span><span id="PDepositWithdraw"><span class="annot"><a href="Agora.Stake.html#PDepositWithdraw"><span class="hs-identifier hs-var">PDepositWithdraw</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679312176"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;delta&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="../file:///nix/store/hdn2zzf6sqipbv8vkckda3xsrbmsp7nw-plutarch-safemoney-lib-plutarch-safemoney-0.3-haddock-doc/share/doc/plutarch-safemoney/html/src"><span class="hs-identifier hs-type">PDiscrete</span></a></span><span> </span><span class="annot"><a href="Agora.SafeMoney.html#GTTag"><span class="hs-identifier hs-type">GTTag</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Destroy a stake, retrieving its LQ, the minimum ADA and any other assets.</span><span>
</span><span id="line-206"></span><span>    </span><span id="PDestroy"><span class="annot"><a href="Agora.Stake.html#PDestroy"><span class="hs-identifier hs-var">PDestroy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679312176"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PPermitVote"><span class="annot"><a href="Agora.Stake.html#PPermitVote"><span class="hs-identifier hs-var">PPermitVote</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679312176"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;lock&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PRetractVotes"><span class="annot"><a href="Agora.Stake.html#PRetractVotes"><span class="hs-identifier hs-var">PRetractVotes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679312176"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;locks&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBuiltinList</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. PStakeRedeemer s -&gt; Rep (PStakeRedeemer s) x)
-&gt; (forall x. Rep (PStakeRedeemer s) x -&gt; PStakeRedeemer s)
-&gt; Generic (PStakeRedeemer s)
forall x. Rep (PStakeRedeemer s) x -&gt; PStakeRedeemer s
forall x. PStakeRedeemer s -&gt; Rep (PStakeRedeemer s) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (s :: S) x. Rep (PStakeRedeemer s) x -&gt; PStakeRedeemer s
forall (s :: S) x. PStakeRedeemer s -&gt; Rep (PStakeRedeemer s) x
$cto :: forall (s :: S) x. Rep (PStakeRedeemer s) x -&gt; PStakeRedeemer s
$cfrom :: forall (s :: S) x. PStakeRedeemer s -&gt; Rep (PStakeRedeemer s) x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310635"><span id="local-6989586621679310637"><span class="annot"><span class="annottext">All @[Type] (SListI @Type) (Code (PStakeRedeemer s))
All @[Type] (SListI @Type) (Code (PStakeRedeemer s))
-&gt; (PStakeRedeemer s -&gt; Rep (PStakeRedeemer s))
-&gt; (Rep (PStakeRedeemer s) -&gt; PStakeRedeemer s)
-&gt; Generic (PStakeRedeemer s)
Rep (PStakeRedeemer s) -&gt; PStakeRedeemer s
PStakeRedeemer s -&gt; Rep (PStakeRedeemer s)
forall a.
All @[Type] (SListI @Type) (Code a)
-&gt; (a -&gt; Rep a) -&gt; (Rep a -&gt; a) -&gt; Generic a
forall {s :: S}.
All @[Type] (SListI @Type) (Code (PStakeRedeemer s))
forall (s :: S). Rep (PStakeRedeemer s) -&gt; PStakeRedeemer s
forall (s :: S). PStakeRedeemer s -&gt; Rep (PStakeRedeemer s)
to :: Rep (PStakeRedeemer s) -&gt; PStakeRedeemer s
$cto :: forall (s :: S). Rep (PStakeRedeemer s) -&gt; PStakeRedeemer s
from :: PStakeRedeemer s -&gt; Rep (PStakeRedeemer s)
$cfrom :: forall (s :: S). PStakeRedeemer s -&gt; Rep (PStakeRedeemer s)
</span><a href="#local-6989586621679310635"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310612"><span id="local-6989586621679310614"><span class="annot"><span class="annottext">PIsData PStakeRedeemer
PMatch PStakeRedeemer
PMatch PStakeRedeemer
-&gt; PIsData PStakeRedeemer
-&gt; (forall (s :: S).
    PStakeRedeemer s
    -&gt; Term s (PDataSum (PIsDataReprRepr PStakeRedeemer)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
    -&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr PStakeRedeemer
forall (s :: S).
PStakeRedeemer s
-&gt; Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
forall (a :: PType).
PMatch a
-&gt; PIsData a
-&gt; (forall (s :: S). a s -&gt; Term s (PDataSum (PIsDataReprRepr a)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr a))
    -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr a
pmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
$cpmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
pconRepr :: forall (s :: S).
PStakeRedeemer s
-&gt; Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
$cpconRepr :: forall (s :: S).
PStakeRedeemer s
-&gt; Term s (PDataSum (PIsDataReprRepr PStakeRedeemer))
</span><a href="#local-6989586621679310612"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PIsDataRepr</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679310597"><span id="local-6989586621679310603"><span class="annot"><span class="annottext">PCon PStakeRedeemer
PMatch PStakeRedeemer
PCon PStakeRedeemer
-&gt; PMatch PStakeRedeemer
-&gt; (forall (s :: S) (b :: PType).
    PStakeRedeemer s -&gt; Term s (PInner PStakeRedeemer b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner PStakeRedeemer b)
    -&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType PStakeRedeemer
forall (s :: S) (b :: PType).
Term s (PInner PStakeRedeemer b)
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
forall (s :: S) (b :: PType).
PStakeRedeemer s -&gt; Term s (PInner PStakeRedeemer b)
forall (a :: PType).
PCon a
-&gt; PMatch a
-&gt; (forall (s :: S) (b :: PType). a s -&gt; Term s (PInner a b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner a b) -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType a
pmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PStakeRedeemer b)
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
$cpmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PStakeRedeemer b)
-&gt; (PStakeRedeemer s -&gt; Term s b) -&gt; Term s b
pcon' :: forall (s :: S) (b :: PType).
PStakeRedeemer s -&gt; Term s (PInner PStakeRedeemer b)
$cpcon' :: forall (s :: S) (b :: PType).
PStakeRedeemer s -&gt; Term s (PInner PStakeRedeemer b)
</span><a href="#local-6989586621679310597"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PlutusType</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310586"><span id="local-6989586621679310591"><span class="annot"><span class="annottext">(forall (s :: S).
 Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer)
-&gt; (forall (s :: S).
    Term s PStakeRedeemer -&gt; Term s (PAsData PStakeRedeemer))
-&gt; PIsData PStakeRedeemer
forall (s :: S).
Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
forall (s :: S).
Term s PStakeRedeemer -&gt; Term s (PAsData PStakeRedeemer)
forall (a :: PType).
(forall (s :: S). Term s (PAsData a) -&gt; Term s a)
-&gt; (forall (s :: S). Term s a -&gt; Term s (PAsData a)) -&gt; PIsData a
pdata :: forall (s :: S).
Term s PStakeRedeemer -&gt; Term s (PAsData PStakeRedeemer)
$cpdata :: forall (s :: S).
Term s PStakeRedeemer -&gt; Term s (PAsData PStakeRedeemer)
pfromData :: forall (s :: S).
Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
$cpfromData :: forall (s :: S).
Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
</span><a href="#local-6989586621679310586"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">PIsData</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PIsDataReprInstances</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-type">PStakeRedeemer</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PUnsafeLiftDecl</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-type">PStakeRedeemer</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-keyword">type</span><span> </span><span id="PLifted"><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">PLifted</span></a></span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-type">PStakeRedeemer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeRedeemer"><span class="hs-identifier hs-type">StakeRedeemer</span></a></span><span>
</span><span id="line-217"></span><span id="local-6989586621679310558"><span id="local-6989586621679310567"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">DerivePConstantViaData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeRedeemer"><span class="hs-identifier hs-type">StakeRedeemer</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-type">PStakeRedeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PConstant</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#StakeRedeemer"><span class="hs-identifier hs-type">StakeRedeemer</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621679310548"><span id="local-6989586621679310549"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PProposalLock"><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-var">PProposalLock</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679312168"><span class="annot"><a href="#local-6989586621679312168"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">S</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PProposalLock"><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-var">PProposalLock</span></a></span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="getProposalLock"><span class="annot"><span class="annottext">forall (s :: S).
PProposalLock s
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType
           (&quot;vote&quot; ':= PResultTag)
           ((':)
              @PLabeledType
              (&quot;proposalTag&quot; ':= PProposalId)
              ('[] @PLabeledType))))
</span><a href="Agora.Stake.html#getProposalLock"><span class="hs-identifier hs-var hs-var">getProposalLock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><a href="#local-6989586621679312168"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PDataRecord</span></a></span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;vote&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="Agora.Proposal.html#PResultTag"><span class="hs-identifier hs-type">PResultTag</span></a></span><span>
</span><span id="line-225"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;proposalTag&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:=</span><span> </span><span class="annot"><a href="Agora.Proposal.html#PProposalId"><span class="hs-identifier hs-type">PProposalId</span></a></span><span>
</span><span id="line-226"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. PProposalLock s -&gt; Rep (PProposalLock s) x)
-&gt; (forall x. Rep (PProposalLock s) x -&gt; PProposalLock s)
-&gt; Generic (PProposalLock s)
forall x. Rep (PProposalLock s) x -&gt; PProposalLock s
forall x. PProposalLock s -&gt; Rep (PProposalLock s) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (s :: S) x. Rep (PProposalLock s) x -&gt; PProposalLock s
forall (s :: S) x. PProposalLock s -&gt; Rep (PProposalLock s) x
$cto :: forall (s :: S) x. Rep (PProposalLock s) x -&gt; PProposalLock s
$cfrom :: forall (s :: S) x. PProposalLock s -&gt; Rep (PProposalLock s) x
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">GHC.Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310537"><span id="local-6989586621679310539"><span class="annot"><span class="annottext">All @[Type] (SListI @Type) (Code (PProposalLock s))
All @[Type] (SListI @Type) (Code (PProposalLock s))
-&gt; (PProposalLock s -&gt; Rep (PProposalLock s))
-&gt; (Rep (PProposalLock s) -&gt; PProposalLock s)
-&gt; Generic (PProposalLock s)
Rep (PProposalLock s) -&gt; PProposalLock s
PProposalLock s -&gt; Rep (PProposalLock s)
forall a.
All @[Type] (SListI @Type) (Code a)
-&gt; (a -&gt; Rep a) -&gt; (Rep a -&gt; a) -&gt; Generic a
forall {s :: S}.
All @[Type] (SListI @Type) (Code (PProposalLock s))
forall (s :: S). Rep (PProposalLock s) -&gt; PProposalLock s
forall (s :: S). PProposalLock s -&gt; Rep (PProposalLock s)
to :: Rep (PProposalLock s) -&gt; PProposalLock s
$cto :: forall (s :: S). Rep (PProposalLock s) -&gt; PProposalLock s
from :: PProposalLock s -&gt; Rep (PProposalLock s)
$cfrom :: forall (s :: S). PProposalLock s -&gt; Rep (PProposalLock s)
</span><a href="#local-6989586621679310537"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310523"><span id="local-6989586621679310525"><span class="annot"><span class="annottext">PIsData PProposalLock
PMatch PProposalLock
PMatch PProposalLock
-&gt; PIsData PProposalLock
-&gt; (forall (s :: S).
    PProposalLock s
    -&gt; Term s (PDataSum (PIsDataReprRepr PProposalLock)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr PProposalLock))
    -&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr PProposalLock
forall (s :: S).
PProposalLock s
-&gt; Term s (PDataSum (PIsDataReprRepr PProposalLock))
forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PProposalLock))
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
forall (a :: PType).
PMatch a
-&gt; PIsData a
-&gt; (forall (s :: S). a s -&gt; Term s (PDataSum (PIsDataReprRepr a)))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PDataSum (PIsDataReprRepr a))
    -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PIsDataRepr a
pmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PProposalLock))
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
$cpmatchRepr :: forall (s :: S) (b :: PType).
Term s (PDataSum (PIsDataReprRepr PProposalLock))
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
pconRepr :: forall (s :: S).
PProposalLock s
-&gt; Term s (PDataSum (PIsDataReprRepr PProposalLock))
$cpconRepr :: forall (s :: S).
PProposalLock s
-&gt; Term s (PDataSum (PIsDataReprRepr PProposalLock))
</span><a href="#local-6989586621679310523"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PIsDataRepr</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679310508"><span id="local-6989586621679310514"><span class="annot"><span class="annottext">PCon PProposalLock
PMatch PProposalLock
PCon PProposalLock
-&gt; PMatch PProposalLock
-&gt; (forall (s :: S) (b :: PType).
    PProposalLock s -&gt; Term s (PInner PProposalLock b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner PProposalLock b)
    -&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType PProposalLock
forall (s :: S) (b :: PType).
Term s (PInner PProposalLock b)
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
forall (s :: S) (b :: PType).
PProposalLock s -&gt; Term s (PInner PProposalLock b)
forall (a :: PType).
PCon a
-&gt; PMatch a
-&gt; (forall (s :: S) (b :: PType). a s -&gt; Term s (PInner a b))
-&gt; (forall (s :: S) (b :: PType).
    Term s (PInner a b) -&gt; (a s -&gt; Term s b) -&gt; Term s b)
-&gt; PlutusType a
pmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PProposalLock b)
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
$cpmatch' :: forall (s :: S) (b :: PType).
Term s (PInner PProposalLock b)
-&gt; (PProposalLock s -&gt; Term s b) -&gt; Term s b
pcon' :: forall (s :: S) (b :: PType).
PProposalLock s -&gt; Term s (PInner PProposalLock b)
$cpcon' :: forall (s :: S) (b :: PType).
PProposalLock s -&gt; Term s (PInner PProposalLock b)
</span><a href="#local-6989586621679310508"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">PlutusType</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310497"><span id="local-6989586621679310502"><span class="annot"><span class="annottext">(forall (s :: S).
 Term s (PAsData PProposalLock) -&gt; Term s PProposalLock)
-&gt; (forall (s :: S).
    Term s PProposalLock -&gt; Term s (PAsData PProposalLock))
-&gt; PIsData PProposalLock
forall (s :: S).
Term s (PAsData PProposalLock) -&gt; Term s PProposalLock
forall (s :: S).
Term s PProposalLock -&gt; Term s (PAsData PProposalLock)
forall (a :: PType).
(forall (s :: S). Term s (PAsData a) -&gt; Term s a)
-&gt; (forall (s :: S). Term s a -&gt; Term s (PAsData a)) -&gt; PIsData a
pdata :: forall (s :: S).
Term s PProposalLock -&gt; Term s (PAsData PProposalLock)
$cpdata :: forall (s :: S).
Term s PProposalLock -&gt; Term s (PAsData PProposalLock)
pfromData :: forall (s :: S).
Term s (PAsData PProposalLock) -&gt; Term s PProposalLock
$cpfromData :: forall (s :: S).
Term s (PAsData PProposalLock) -&gt; Term s PProposalLock
</span><a href="#local-6989586621679310497"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">PIsData</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310492"><span class="annot"><span class="annottext">(forall (s :: S).
 Term s PProposalLock
 -&gt; Term s (PDataRecord (PFields PProposalLock)))
-&gt; PDataFields PProposalLock
forall (s :: S).
Term s PProposalLock
-&gt; Term s (PDataRecord (PFields PProposalLock))
forall (a :: PType).
(forall (s :: S). Term s a -&gt; Term s (PDataRecord (PFields a)))
-&gt; PDataFields a
ptoFields :: forall (s :: S).
Term s PProposalLock
-&gt; Term s (PDataRecord (PFields PProposalLock))
$cptoFields :: forall (s :: S).
Term s PProposalLock
-&gt; Term s (PDataRecord (PFields PProposalLock))
</span><a href="#local-6989586621679310492"><span class="hs-identifier hs-var hs-var hs-var hs-var">PDataFields</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PIsDataReprInstances</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PUnsafeLiftDecl</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-keyword">type</span><span> </span><span id="PLifted"><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">PLifted</span></a></span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span>
</span><span id="line-237"></span><span id="local-6989586621679310458"><span id="local-6989586621679310467"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">DerivePConstantViaData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PConstant</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#ProposalLock"><span class="hs-identifier hs-type">ProposalLock</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-240"></span><span class="hs-comment">{- What this Policy does

   For minting:
     Check that exactly one state thread is minted
     Check that an output exists with a state thread and a valid datum
     Check that no state thread is an input
     assert TokenName == ValidatorHash of the script that we pay to

   For burning:
     Check that exactly one state thread is burned
     Check that datum at state thread is valid and not locked
-}</span><span>
</span><span id="line-252"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- | Policy for Stake state threads.</span><span>
</span><span id="line-255"></span><span class="annot"><a href="Agora.Stake.html#stakePolicy"><span class="hs-identifier hs-type">stakePolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMintingPolicy</span></a></span><span>
</span><span id="line-256"></span><span id="stakePolicy"><span class="annot"><span class="annottext">stakePolicy :: Stake -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Stake.html#stakePolicy"><span class="hs-identifier hs-var hs-var">stakePolicy</span></a></span></span><span> </span><span id="local-6989586621679310250"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679310250"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PMintingPolicy)
-&gt; (Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PMintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679310248"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679310248"><span class="hs-identifier hs-var">_redeemer</span></a></span></span><span> </span><span id="local-6989586621679310247"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679310247"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679310246"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679310246"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679310247"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679310244"><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
</span><a href="#local-6989586621679310244"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
-&gt; (Term s (PAsData PTxInfo) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679310246"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679310242"><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol
        &quot;inputs&quot;
        (Term s (PAsData (PBuiltinList (PAsData PTxInInfo)))))
     ((':)
        @Type
        (Labeled
           @Symbol
           &quot;outputs&quot;
           (Term s (PAsData (PBuiltinList (PAsData PTxOut)))))
        ((':)
           @Type
           (Labeled @Symbol &quot;mint&quot; (Term s (PAsData PValue)))
           ('[] @Type))))
</span><a href="#local-6989586621679310242"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
</span><a href="#local-6989586621679310244"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PMinting</span></a></span><span> </span><span id="local-6989586621679310241"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679310241"><span class="hs-identifier hs-var">ownSymbol'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose
 -&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679310246"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679310238"><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679310238"><span class="hs-identifier hs-var">ownSymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
-&gt; (Term s PCurrencySymbol -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PCurrencySymbol
 -&gt; (Term s PCurrencySymbol -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PCurrencySymbol
-&gt; (Term s PCurrencySymbol -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType))
   :--&gt; PCurrencySymbol)
-&gt; Term
     s
     (PDataRecord
        ((':)
           @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
-&gt; Term s PCurrencySymbol
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;_0&quot; ':= PCurrencySymbol) ('[] @PLabeledType)))
</span><a href="#local-6989586621679310241"><span class="hs-identifier hs-var">ownSymbol'</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679310235"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310235"><span class="hs-identifier hs-var">spentST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
</span><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol -&gt; Term s (PValue :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679310238"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue :--&gt; PInteger @S)
-&gt; Term s PValue -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; PValue)
forall (s :: S). Term s (PTxInfo :--&gt; PValue)
</span><a href="Agora.Utils.html#pvalueSpent"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; PValue) -&gt; Term s PTxInfo -&gt; Term s PValue
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
</span><a href="#local-6989586621679310244"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679310233"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310233"><span class="hs-identifier hs-var">mintedST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
</span><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol -&gt; Term s (PValue :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679310238"><span class="hs-identifier hs-var">ownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue :--&gt; PInteger @S)
-&gt; Term s PValue -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol
        &quot;inputs&quot;
        (Term s (PAsData (PBuiltinList (PAsData PTxInInfo)))))
     ((':)
        @Type
        (Labeled
           @Symbol
           &quot;outputs&quot;
           (Term s (PAsData (PBuiltinList (PAsData PTxOut)))))
        ((':)
           @Type
           (Labeled @Symbol &quot;mint&quot; (Term s (PAsData PValue)))
           ('[] @Type))))
</span><a href="#local-6989586621679310242"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679310232"><span class="annot"><span class="annottext">burning :: Term s POpaque
</span><a href="#local-6989586621679310232"><span class="hs-identifier hs-var hs-var">burning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310235"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST burned&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310233"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;An unlocked input existed containing an ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-275"></span><span>            </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
PIsData datum =&gt;
Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (datum :--&gt; PBool))) :--&gt; PBool))
</span><a href="Agora.Utils.html#anyInput"><span class="hs-identifier hs-var">anyInput</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool)))
         :--&gt; PBool))
-&gt; Term s PTxInfo
-&gt; Term
     s
     ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool))) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
</span><a href="#local-6989586621679310244"><span class="hs-identifier hs-var">txInfo'</span></a></span><span class="hs-cpp">
              #$ plam
</span><span>              </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">stakeDatum'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">hasST</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">psymbolValueOf</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">ownSymbol</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">unlocked</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnot</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stakeLocked</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">stakeDatum'</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>                </span><span class="hs-identifier">hasST</span><span> </span><span class="hs-operator">#&amp;&amp;</span><span> </span><span class="hs-identifier">unlocked</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679310223"><span class="annot"><span class="annottext">minting :: Term s POpaque
</span><a href="#local-6989586621679310223"><span class="hs-identifier hs-var hs-var">minting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-285"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310235"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">0</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Minted ST must be exactly 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310233"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-292"></span><span>            </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
PIsData datum =&gt;
Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (datum :--&gt; PBool))) :--&gt; PBool))
</span><a href="Agora.Utils.html#anyOutput"><span class="hs-identifier hs-var">anyOutput</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool)))
         :--&gt; PBool))
-&gt; Term s PTxInfo
-&gt; Term
     s
     ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool))) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo) -&gt; Term s PTxInfo
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxInfo)
</span><a href="#local-6989586621679310244"><span class="hs-identifier hs-var">txInfo'</span></a></span><span class="hs-cpp">
              #$ plam
</span><span>              </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">address</span><span> </span><span class="hs-identifier">stakeDatum'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">cred</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;credential&quot;</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">address</span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-identifier">pmatch</span><span> </span><span class="hs-identifier">cred</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-297"></span><span>                  </span><span class="hs-comment">-- Should pay to a script address</span><span>
</span><span id="line-298"></span><span>                  </span><span class="hs-identifier">PPubKeyCredential</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pcon</span><span> </span><span class="hs-identifier">PFalse</span><span>
</span><span id="line-299"></span><span>                  </span><span class="hs-identifier">PScriptCredential</span><span> </span><span class="hs-identifier">validatorHash'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-300"></span><span>                    </span><span class="hs-identifier">validatorHash</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;_0&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">validatorHash'</span><span>
</span><span id="line-301"></span><span>                    </span><span class="hs-identifier">stakeDatum</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;owner&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;stakedAmount&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">stakeDatum'</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>                    </span><span class="hs-comment">-- TODO: figure out why this is required :/ (specifically, why `validatorHash._0` is `PData`)</span><span>
</span><span id="line-304"></span><span>                    </span><span class="hs-identifier">tn</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">plet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">punsafeCoerce</span><span> </span><span class="hs-identifier">validatorHash</span><span class="hs-operator">.</span><span class="hs-identifier">_0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Term</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PAsData</span><span> </span><span class="hs-identifier">PTokenName</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">stValue</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>                          </span><span class="hs-identifier">psingletonValue</span><span class="hs-cpp">
                            # ownSymbol
</span><span>                            </span><span class="hs-comment">-- This coerce is safe because the structure</span><span>
</span><span id="line-310"></span><span>                            </span><span class="hs-comment">-- of PValidatorHash is the same as PTokenName.</span><span class="hs-cpp">
                            # tn
</span><span class="hs-cpp">                            # 1
</span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">expectedValue</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>                          </span><span class="hs-identifier">paddValue</span><span class="hs-cpp">
                            # (pdiscreteValue stake.gtClassRef # stakeDatum.stakedAmount)
</span><span class="hs-cpp">                            # stValue
</span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">ownerSignsTransaction</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>                          </span><span class="hs-identifier">ptxSignedBy</span><span class="hs-cpp">
                            # ctx.txInfo
</span><span class="hs-cpp">                            # stakeDatum.owner
</span><span>
</span><span id="line-322"></span><span>                    </span><span class="hs-comment">-- TODO: This is quite inefficient now, as it does two lookups</span><span>
</span><span id="line-323"></span><span>                    </span><span class="hs-comment">-- instead of a more efficient single pass,</span><span>
</span><span id="line-324"></span><span>                    </span><span class="hs-comment">-- but it doesn't really matter for this. At least it's correct.</span><span>
</span><span id="line-325"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">valueCorrect</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>                          </span><span class="hs-identifier">foldr1</span><span>
</span><span id="line-327"></span><span>                            </span><span class="hs-special">(</span><span class="hs-operator">#&amp;&amp;</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">pgeqByClass'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AssetClass</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">expectedValue</span><span>
</span><span id="line-329"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pgeqByClass'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">untag</span><span> </span><span class="hs-identifier">stake</span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span class="hs-special">)</span><span class="hs-cpp">
                                # value
</span><span class="hs-cpp">                                # expectedValue
</span><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pgeqByClass</span><span class="hs-cpp">
                                # ownSymbol
</span><span class="hs-cpp">                                # tn
</span><span class="hs-cpp">                                # value
</span><span class="hs-cpp">                                # expectedValue
</span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>                    </span><span class="hs-identifier">ownerSignsTransaction</span><span class="hs-cpp">
                      #&amp;&amp; valueCorrect
</span><span>          </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (a :: PType).
Term s PBool -&gt; Term s a -&gt; Term s a -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
POrd t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679310233"><span class="hs-identifier hs-var">mintedST</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s POpaque
</span><a href="#local-6989586621679310223"><span class="hs-identifier hs-var">minting</span></a></span><span> </span><span class="annot"><span class="annottext">Term s POpaque
</span><a href="#local-6989586621679310232"><span class="hs-identifier hs-var">burning</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- | Validator intended for Stake UTXOs to live in.</span><span>
</span><span id="line-348"></span><span class="annot"><a href="Agora.Stake.html#stakeValidator"><span class="hs-identifier hs-type">stakeValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agora.Stake.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">ClosedTerm</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PValidator</span></a></span><span>
</span><span id="line-349"></span><span id="stakeValidator"><span class="annot"><span class="annottext">stakeValidator :: Stake -&gt; ClosedTerm PValidator
</span><a href="Agora.Stake.html#stakeValidator"><span class="hs-identifier hs-var hs-var">stakeValidator</span></a></span></span><span> </span><span id="local-6989586621679309968"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679309968"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">(Term s PData
 -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PData
  -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
 -&gt; Term s PValidator)
-&gt; (Term s PData
    -&gt; Term s PData -&gt; Term s PScriptContext -&gt; Term s POpaque)
-&gt; Term s PValidator
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679309967"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679309967"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621679309966"><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679309966"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span id="local-6989586621679309965"><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679309965"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621679309964"><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679309964"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;txInfo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;purpose&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PScriptContext
</span><a href="#local-6989586621679309965"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679309963"><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679309963"><span class="hs-identifier hs-var">txInfo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
-&gt; (Term s PTxInfo -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679309964"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679309962"><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol
        &quot;inputs&quot;
        (Term s (PAsData (PBuiltinList (PAsData PTxInInfo)))))
     ((':)
        @Type
        (Labeled
           @Symbol
           &quot;outputs&quot;
           (Term s (PAsData (PBuiltinList (PAsData PTxOut)))))
        ((':)
           @Type
           (Labeled @Symbol &quot;mint&quot; (Term s (PAsData PValue)))
           ('[] @Type))))
</span><a href="#local-6989586621679309962"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;mint&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679309963"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-comment">-- TODO: Use PTryFrom</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679309961"><span class="hs-identifier hs-type">stakeRedeemer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeRedeemer"><span class="hs-identifier hs-type">PStakeRedeemer</span></a></span><span>
</span><span id="line-357"></span><span>        </span><span id="local-6989586621679309961"><span class="annot"><span class="annottext">stakeRedeemer :: Term s PStakeRedeemer
</span><a href="#local-6989586621679309961"><span class="hs-identifier hs-var hs-var">stakeRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer)
-&gt; Term s (PAsData PStakeRedeemer) -&gt; Term s PStakeRedeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData -&gt; Term s (PAsData PStakeRedeemer)
forall (s :: S) (a :: PType) (b :: PType). Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">punsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679309966"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><a href="#local-6989586621679309959"><span class="hs-identifier hs-type">stakeDatum'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span>
</span><span id="line-359"></span><span>        </span><span id="local-6989586621679309959"><span class="annot"><span class="annottext">stakeDatum' :: Term s PStakeDatum
</span><a href="#local-6989586621679309959"><span class="hs-identifier hs-var hs-var">stakeDatum'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum)
-&gt; Term s (PAsData PStakeDatum) -&gt; Term s PStakeDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData -&gt; Term s (PAsData PStakeDatum)
forall (s :: S) (a :: PType) (b :: PType). Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">punsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PData
</span><a href="#local-6989586621679309967"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621679309957"><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol &quot;stakedAmount&quot; (Term s (PAsData (PDiscrete GTTag))))
     ((':)
        @Type
        (Labeled @Symbol &quot;owner&quot; (Term s (PAsData PPubKeyHash)))
        ('[] @Type)))
</span><a href="#local-6989586621679309957"><span class="hs-identifier hs-var">stakeDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (fs :: [Symbol]) (a :: PType) (s :: S) (b :: PType)
       (ps :: [PLabeledType]) (bs :: [ToBind]).
(PDataFields a,
 (ps :: [PLabeledType]) ~ (PFields a :: [PLabeledType]),
 (bs :: [ToBind]) ~ (Bindings ps fs :: [ToBind]),
 BindFields ps bs) =&gt;
Term s a -&gt; (HRec (BoundTerms ps bs s) -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pletFields</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;owner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;stakedAmount&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679309959"><span class="hs-identifier hs-var">stakeDatum'</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PSpending</span></a></span><span> </span><span id="local-6989586621679309956"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
</span><a href="#local-6989586621679309956"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PScriptPurpose
 -&gt; (PScriptPurpose s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PScriptPurpose
-&gt; (PScriptPurpose s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PScriptPurpose) -&gt; Term s PScriptPurpose
forall (a :: PType) (s :: S).
PIsData a =&gt;
Term s (PAsData a) -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfromData</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679309964"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">purpose</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PJust</span></a></span><span> </span><span id="local-6989586621679309954"><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679309954"><span class="hs-identifier hs-var">txInInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PMaybe PTxInInfo)
-&gt; (PMaybe PTxInInfo s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PMaybe PTxInInfo)
 -&gt; (PMaybe PTxInInfo s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PMaybe PTxInInfo)
-&gt; (PMaybe PTxInInfo s -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxOutRef :--&gt; (PTxInfo :--&gt; PMaybe PTxInInfo))
forall (s :: S).
Term s (PTxOutRef :--&gt; (PTxInfo :--&gt; PMaybe PTxInInfo))
</span><a href="Agora.Utils.html#pfindTxInByTxOutRef"><span class="hs-identifier hs-var">pfindTxInByTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxOutRef :--&gt; (PTxInfo :--&gt; PMaybe PTxInInfo))
-&gt; Term s PTxOutRef -&gt; Term s (PTxInfo :--&gt; PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType))
   :--&gt; PTxOutRef)
-&gt; Term
     s
     (PDataRecord
        ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
-&gt; Term s PTxOutRef
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':) @PLabeledType (&quot;_0&quot; ':= PTxOutRef) ('[] @PLabeledType)))
</span><a href="#local-6989586621679309956"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; PMaybe PTxInInfo)
-&gt; Term s PTxInfo -&gt; Term s (PMaybe PTxInInfo)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679309963"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621679309953"><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
           (PFields (PAsData PTxOut)))))
</span><a href="#local-6989586621679309953"><span class="hs-identifier hs-var">ownAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData
     (PUnLabel
        (IndexList
           @PLabeledType
           (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
           (PFields (PAsData PTxOut)))))
-&gt; (Term
      s
      (PAsData
         (PUnLabel
            (IndexList
               @PLabeledType
               (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
               (PFields (PAsData PTxOut)))))
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term
   s
   (PAsData
      (PUnLabel
         (IndexList
            @PLabeledType
            (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
            (PFields (PAsData PTxOut)))))
 -&gt; (Term
       s
       (PAsData
          (PUnLabel
             (IndexList
                @PLabeledType
                (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                (PFields (PAsData PTxOut)))))
     -&gt; Term s POpaque)
 -&gt; Term s POpaque)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
              (PFields (PAsData PTxOut)))))
-&gt; (Term
      s
      (PAsData
         (PUnLabel
            (IndexList
               @PLabeledType
               (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
               (PFields (PAsData PTxOut)))))
    -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PAsData PTxOut
   :--&gt; PAsData
          (PUnLabel
             (IndexList
                @PLabeledType
                (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
                (PFields (PAsData PTxOut)))))
-&gt; Term s (PAsData PTxOut)
-&gt; Term
     s
     (PAsData
        (PUnLabel
           (IndexList
              @PLabeledType
              (PLabelIndex &quot;address&quot; (PFields (PAsData PTxOut)))
              (PFields (PAsData PTxOut)))))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInInfo :--&gt; PAsData PTxOut)
-&gt; Term s PTxInInfo -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679309954"><span class="hs-identifier hs-var">txInInfo</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679309952"><span class="annot"><span class="annottext">continuingValue :: Term s PValue
</span><a href="#local-6989586621679309952"><span class="hs-identifier hs-var hs-var">continuingValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PTxOut :--&gt; PValue)
-&gt; Term s (PAsData PTxOut) -&gt; Term s PValue
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInInfo :--&gt; PAsData PTxOut)
-&gt; Term s PTxInInfo -&gt; Term s (PAsData PTxOut)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInInfo
</span><a href="#local-6989586621679309954"><span class="hs-identifier hs-var">txInInfo</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- Whether the owner signs this transaction or not.</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621679309951"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309951"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; (Term s PBool -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool
 -&gt; (Term s PBool -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PBool
-&gt; (Term s PBool -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
forall (s :: S).
Term s (PTxInfo :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
</span><a href="Agora.Utils.html#ptxSignedBy"><span class="hs-identifier hs-var">ptxSignedBy</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; (PAsData PPubKeyHash :--&gt; PBool))
-&gt; Term s PTxInfo -&gt; Term s (PAsData PPubKeyHash :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  (BoundTerms
     (PFields PScriptContext)
     (Bindings
        (PFields PScriptContext)
        ((':) @Symbol &quot;txInfo&quot; ((':) @Symbol &quot;purpose&quot; ('[] @Symbol))))
     s)
</span><a href="#local-6989586621679309964"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">txInfo</span><span> </span><span class="annot"><span class="annottext">Term s (PAsData PPubKeyHash :--&gt; PBool)
-&gt; Term s (PAsData PPubKeyHash) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol &quot;stakedAmount&quot; (Term s (PAsData (PDiscrete GTTag))))
     ((':)
        @Type
        (Labeled @Symbol &quot;owner&quot; (Term s (PAsData PPubKeyHash)))
        ('[] @Type)))
</span><a href="#local-6989586621679309957"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621679309950"><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679309950"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
-&gt; (Term s PCurrencySymbol -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PCurrencySymbol
 -&gt; (Term s PCurrencySymbol -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PCurrencySymbol
-&gt; (Term s PCurrencySymbol -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="annot"><span class="annottext">(PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol)
-&gt; PLifted PCurrencySymbol -&gt; Term s PCurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mintingPolicySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; CurrencySymbol)
-&gt; MintingPolicy -&gt; CurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedTerm PMintingPolicy -&gt; MintingPolicy
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">mkMintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stake -&gt; ClosedTerm PMintingPolicy
</span><a href="Agora.Stake.html#stakePolicy"><span class="hs-identifier hs-var">stakePolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679309968"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679309949"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679309949"><span class="hs-identifier hs-var">mintedST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
</span><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol -&gt; Term s (PValue :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679309950"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue :--&gt; PInteger @S)
-&gt; Term s PValue -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">HRec
  ((':)
     @Type
     (Labeled
        @Symbol
        &quot;inputs&quot;
        (Term s (PAsData (PBuiltinList (PAsData PTxInInfo)))))
     ((':)
        @Type
        (Labeled
           @Symbol
           &quot;outputs&quot;
           (Term s (PAsData (PBuiltinList (PAsData PTxOut)))))
        ((':)
           @Type
           (Labeled @Symbol &quot;mint&quot; (Term s (PAsData PValue)))
           ('[] @Type))))
</span><a href="#local-6989586621679309962"><span class="hs-identifier hs-var">txInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">mint</span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621679309948"><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679309948"><span class="hs-identifier hs-var">spentST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s (PInteger @S)
 -&gt; (Term s (PInteger @S) -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s (PInteger @S)
-&gt; (Term s (PInteger @S) -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
forall (s :: S).
Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
</span><a href="Agora.Utils.html#psymbolValueOf"><span class="hs-identifier hs-var">psymbolValueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PCurrencySymbol :--&gt; (PValue :--&gt; PInteger @S))
-&gt; Term s PCurrencySymbol -&gt; Term s (PValue :--&gt; PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PCurrencySymbol
</span><a href="#local-6989586621679309950"><span class="hs-identifier hs-var">stCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PValue :--&gt; PInteger @S)
-&gt; Term s PValue -&gt; Term s (PInteger @S)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; PValue)
forall (s :: S). Term s (PTxInfo :--&gt; PValue)
</span><a href="Agora.Utils.html#pvalueSpent"><span class="hs-identifier hs-var">pvalueSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PTxInfo :--&gt; PValue) -&gt; Term s PTxInfo -&gt; Term s PValue
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679309963"><span class="hs-identifier hs-var">txInfo'</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">-- Is the stake currently locked?</span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679309947"><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309947"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term s PBool -&gt; (Term s PBool -&gt; Term s POpaque) -&gt; Term s POpaque
forall (s :: S) (a :: PType) (b :: PType).
Term s a -&gt; (Term s a -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plet</span></a></span><span> </span><span class="annot"><span class="annottext">(Term s PBool
 -&gt; (Term s PBool -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; Term s PBool
-&gt; (Term s PBool -&gt; Term s POpaque)
-&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PStakeDatum :--&gt; PBool)
forall (s :: S). Term s (PStakeDatum :--&gt; PBool)
</span><a href="Agora.Stake.html#stakeLocked"><span class="hs-identifier hs-var">stakeLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PStakeDatum :--&gt; PBool)
-&gt; Term s PStakeDatum -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679309959"><span class="hs-identifier hs-var">stakeDatum'</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall (a :: PType) (s :: S) (b :: PType).
PMatch a =&gt;
Term s a -&gt; (a s -&gt; Term s b) -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pmatch</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeRedeemer
</span><a href="#local-6989586621679309961"><span class="hs-identifier hs-var">stakeRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">((PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque)
-&gt; (PStakeRedeemer s -&gt; Term s POpaque) -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><a href="Agora.Stake.html#PDestroy"><span class="hs-identifier hs-type">PDestroy</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PDataRecord ('[] @PLabeledType))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679309948"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-382"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Should burn ST&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679309949"><span class="hs-identifier hs-var">mintedST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake unlocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309947"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span>
</span><span id="line-386"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309951"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-388"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><a href="Agora.Stake.html#PRetractVotes"><span class="hs-identifier hs-type">PRetractVotes</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType
        (&quot;locks&quot; ':= PBuiltinList PProposalLock)
        ('[] @PLabeledType)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-393"></span><span>          </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309951"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-comment">-- TODO: check proposal constraints</span><span>
</span><span id="line-395"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-397"></span><span>      </span><span class="annot"><a href="Agora.Stake.html#PPermitVote"><span class="hs-identifier hs-type">PPermitVote</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;lock&quot; ':= PProposalLock) ('[] @PLabeledType)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-400"></span><span>          </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309951"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-comment">-- TODO: check proposal constraints</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-404"></span><span>      </span><span class="annot"><a href="Agora.Stake.html#PDepositWithdraw"><span class="hs-identifier hs-type">PDepositWithdraw</span></a></span><span> </span><span id="local-6989586621679309946"><span class="annot"><span class="annottext">Term
  s
  (PDataRecord
     ((':)
        @PLabeledType (&quot;delta&quot; ':= PDiscrete GTTag) ('[] @PLabeledType)))
</span><a href="#local-6989586621679309946"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;ST at inputs must be 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-406"></span><span>          </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><a href="#local-6989586621679309948"><span class="hs-identifier hs-var">spentST</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S) -&gt; Term s (PInteger @S) -&gt; Term s PBool
forall (t :: PType) (s :: S).
PEq t =&gt;
Term s t -&gt; Term s t -&gt; Term s PBool
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#==</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PInteger @S)
</span><span class="hs-number">1</span></span><span>
</span><span id="line-407"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Stake unlocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-408"></span><span>          </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool)
forall (s :: S). Term s (PBool :--&gt; PBool)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pnot</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBool :--&gt; PBool) -&gt; Term s PBool -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#$</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309947"><span class="hs-identifier hs-var">stakeIsLocked</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span>
</span><span id="line-410"></span><span>          </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;Owner signs this transaction&quot;</span></span><span>
</span><span id="line-411"></span><span>          </span><span class="annot"><span class="annottext">Term s PBool
</span><a href="#local-6989586621679309951"><span class="hs-identifier hs-var">ownerSignsTransaction</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="annot"><span class="annottext">Term s (PString @S)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall (s :: S) (k :: PType).
Term s (PString @S) -&gt; Term s PBool -&gt; Term s k -&gt; Term s k
</span><a href="Agora.Utils.html#passert"><span class="hs-identifier hs-var">passert</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PString @S)
</span><span class="hs-string">&quot;A UTXO must exist with the correct output&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque)
-&gt; Term s PBool -&gt; Term s POpaque -&gt; Term s POpaque
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">forall (datum :: PType) (s :: S).
PIsData datum =&gt;
Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (datum :--&gt; PBool))) :--&gt; PBool))
</span><a href="Agora.Utils.html#anyOutput"><span class="hs-identifier hs-var">anyOutput</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Term
  s
  (PTxInfo
   :--&gt; ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool)))
         :--&gt; PBool))
-&gt; Term s PTxInfo
-&gt; Term
     s
     ((PValue :--&gt; (PAddress :--&gt; (PStakeDatum :--&gt; PBool))) :--&gt; PBool)
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PTxInfo
</span><a href="#local-6989586621679309963"><span class="hs-identifier hs-var">txInfo'</span></a></span><span class="hs-cpp">
            #$ plam
</span><span>            </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">address</span><span> </span><span class="hs-identifier">newStakeDatum'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">P.do</span><span>
</span><span id="line-416"></span><span>              </span><span class="hs-identifier">newStakeDatum</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">pletFields</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-string">&quot;owner&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;stakedAmount&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">newStakeDatum'</span><span>
</span><span id="line-417"></span><span>              </span><span class="hs-identifier">delta</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">plet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pfield</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;delta&quot;</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-418"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">isScriptAddress</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pdata</span><span> </span><span class="hs-identifier">address</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">ownAddress</span><span>
</span><span id="line-419"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">correctOutputDatum</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-420"></span><span>                    </span><span class="hs-identifier">foldr1</span><span>
</span><span id="line-421"></span><span>                      </span><span class="hs-special">(</span><span class="hs-operator">#&amp;&amp;</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">stakeDatum</span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">newStakeDatum</span><span class="hs-operator">.</span><span class="hs-identifier">owner</span><span>
</span><span id="line-423"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stakeDatum</span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">delta</span><span class="hs-special">)</span><span> </span><span class="hs-operator">#==</span><span> </span><span class="hs-identifier">newStakeDatum</span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-424"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- We can't magically conjure GT anyway (no input to spend!)</span><span>
</span><span id="line-425"></span><span>                        </span><span class="hs-comment">-- do we need to check this, really?</span><span>
</span><span id="line-426"></span><span>                        </span><span class="hs-identifier">zero</span><span> </span><span class="hs-operator">#&lt;=</span><span> </span><span class="hs-identifier">pfromData</span><span> </span><span class="hs-identifier">newStakeDatum</span><span class="hs-operator">.</span><span class="hs-identifier">stakedAmount</span><span>
</span><span id="line-427"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-428"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">expectedValue</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">paddValue</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">continuingValue</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pdiscreteValue</span><span> </span><span class="hs-identifier">stake</span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">delta</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>              </span><span class="hs-comment">-- TODO: Same as above. This is quite inefficient now, as it does two lookups</span><span>
</span><span id="line-431"></span><span>              </span><span class="hs-comment">-- instead of a more efficient single pass,</span><span>
</span><span id="line-432"></span><span>              </span><span class="hs-comment">-- but it doesn't really matter for this. At least it's correct.</span><span>
</span><span id="line-433"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">valueCorrect</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-434"></span><span>                    </span><span class="hs-identifier">foldr1</span><span>
</span><span id="line-435"></span><span>                      </span><span class="hs-special">(</span><span class="hs-operator">#&amp;&amp;</span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">pgeqByClass'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AssetClass</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">#</span><span> </span><span class="hs-identifier">expectedValue</span><span>
</span><span id="line-437"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pgeqByClass'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">untag</span><span> </span><span class="hs-identifier">stake</span><span class="hs-operator">.</span><span class="hs-identifier">gtClassRef</span><span class="hs-special">)</span><span class="hs-cpp">
                          # value
</span><span class="hs-cpp">                          # expectedValue
</span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pgeqBySymbol</span><span class="hs-cpp">
                          # stCurrencySymbol
</span><span class="hs-cpp">                          # value
</span><span class="hs-cpp">                          # expectedValue
</span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>              </span><span class="hs-identifier">foldr1</span><span>
</span><span id="line-447"></span><span>                </span><span class="hs-special">(</span><span class="hs-operator">#&amp;&amp;</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;isScriptAddress&quot;</span><span> </span><span class="hs-identifier">isScriptAddress</span><span>
</span><span id="line-449"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;correctOutputDatum&quot;</span><span> </span><span class="hs-identifier">correctOutputDatum</span><span>
</span><span id="line-450"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ptraceIfFalse</span><span> </span><span class="hs-string">&quot;valueCorrect&quot;</span><span> </span><span class="hs-identifier">valueCorrect</span><span>
</span><span id="line-451"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">Term s (PUnit @S) -&gt; Term s POpaque
forall (s :: S) (a :: PType). Term s a -&gt; Term s POpaque
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">popaque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLifted (PUnit @S) -&gt; Term s (PUnit @S)
forall (p :: PType) (s :: S). PLift p =&gt; PLifted p -&gt; Term s p
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pconstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- | Check whether a Stake is locked. If it is locked, various actions are unavailable.</span><span>
</span><span id="line-458"></span><span class="annot"><a href="Agora.Stake.html#stakeLocked"><span class="hs-identifier hs-type">stakeLocked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679312032"><span class="annot"><a href="#local-6989586621679312032"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">S</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679312032"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agora.Stake.html#PStakeDatum"><span class="hs-identifier hs-type">PStakeDatum</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-type">:--&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span id="stakeLocked"><span class="annot"><span class="annottext">stakeLocked :: forall (s :: S). Term s (PStakeDatum :--&gt; PBool)
</span><a href="Agora.Stake.html#stakeLocked"><span class="hs-identifier hs-var hs-var">stakeLocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (s :: S). Term s (PStakeDatum :--&gt; PBool))
-&gt; Term s (PStakeDatum :--&gt; PBool)
forall (a :: PType) (s :: S).
HasCallStack =&gt;
ClosedTerm a -&gt; Term s a
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">phoistAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (s :: S). Term s (PStakeDatum :--&gt; PBool))
 -&gt; Term s (PStakeDatum :--&gt; PBool))
-&gt; (forall (s :: S). Term s (PStakeDatum :--&gt; PBool))
-&gt; Term s (PStakeDatum :--&gt; PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="annottext">(Term s PStakeDatum -&gt; Term s PBool)
-&gt; Term s (PStakeDatum :--&gt; PBool)
forall a (b :: PType) (s :: S) (c :: PType).
PLamN a b s =&gt;
(Term s c -&gt; a) -&gt; Term s (c :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">plam</span></a></span><span> </span><span class="annot"><span class="annottext">((Term s PStakeDatum -&gt; Term s PBool)
 -&gt; Term s (PStakeDatum :--&gt; PBool))
-&gt; (Term s PStakeDatum -&gt; Term s PBool)
-&gt; Term s (PStakeDatum :--&gt; PBool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/kq3z27pzg8pc38yjr84kzncicvpzhan0-ghc-9.2.1-doc/share/doc/ghc/html/libraries/base-4.16.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679309920"><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679309920"><span class="hs-identifier hs-var">stakeDatum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679309919"><span class="hs-identifier hs-type">locks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PBuiltinList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-type">PAsData</span></a></span><span> </span><span class="annot"><a href="Agora.Stake.html#PProposalLock"><span class="hs-identifier hs-type">PProposalLock</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>        </span><span id="local-6989586621679309919"><span class="annot"><span class="annottext">locks :: Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679309919"><span class="hs-identifier hs-var hs-var">locks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (name :: Symbol) (p :: PType) (s :: S) (a :: PType)
       (as :: [PLabeledType]) (n :: Nat) (b :: PType).
(PDataFields p,
 (as :: [PLabeledType]) ~ (PFields p :: [PLabeledType]),
 (n :: Nat) ~ (PLabelIndex name as :: Nat), KnownNat n,
 (a :: PType) ~ (PUnLabel (IndexList @PLabeledType n as) :: PType),
 PFromDataable a b) =&gt;
Term s (p :--&gt; b)
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-identifier hs-var">pfield</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;lockedBy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Term s (PStakeDatum :--&gt; PBuiltinList (PAsData PProposalLock))
-&gt; Term s PStakeDatum
-&gt; Term s (PBuiltinList (PAsData PProposalLock))
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s PStakeDatum
</span><a href="#local-6989586621679309920"><span class="hs-identifier hs-var">stakeDatum</span></a></span><span>
</span><span id="line-463"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock) :--&gt; PBool)
forall (list :: PType -&gt; PType) (a :: PType) {w :: S}.
PIsListLike list a =&gt;
Term w (list a :--&gt; PBool)
</span><a href="Agora.Utils.html#pnotNull"><span class="hs-identifier hs-var">pnotNull</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock) :--&gt; PBool)
-&gt; Term s (PBuiltinList (PAsData PProposalLock)) -&gt; Term s PBool
forall (s :: S) (a :: PType) (b :: PType).
Term s (a :--&gt; b) -&gt; Term s a -&gt; Term s b
</span><a href="../file:///nix/store/3c9cva5aggalyxpj19nv8vx2yhr5wlkd-plutarch-lib-plutarch-1.1.0-haddock-doc/share/doc/plutarch/html/src"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Term s (PBuiltinList (PAsData PProposalLock))
</span><a href="#local-6989586621679309919"><span class="hs-identifier hs-var">locks</span></a></span><span>
</span><span id="line-464"></span></pre></body></html>